<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>8.方法调用的底层实现 | TQK的个人博客</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/images/logo.png">
    <meta name="description" content="TQK的个人博客">
    <meta name="author" content="冰岛红茶">
    <meta name="keywords" content="个人博客 ，java ，后端">
    
    <link rel="preload" href="/assets/css/0.styles.c33d3a11.css" as="style"><link rel="preload" href="/assets/js/app.40562028.js" as="script"><link rel="preload" href="/assets/js/2.ee1c79d6.js" as="script"><link rel="preload" href="/assets/js/13.9fc99377.js" as="script"><link rel="prefetch" href="/assets/js/10.d0159570.js"><link rel="prefetch" href="/assets/js/100.c1141800.js"><link rel="prefetch" href="/assets/js/101.c06ebcd6.js"><link rel="prefetch" href="/assets/js/102.a957571f.js"><link rel="prefetch" href="/assets/js/103.302232f9.js"><link rel="prefetch" href="/assets/js/104.2bb7a855.js"><link rel="prefetch" href="/assets/js/105.a1f78854.js"><link rel="prefetch" href="/assets/js/106.cece9a20.js"><link rel="prefetch" href="/assets/js/107.b2ddcef7.js"><link rel="prefetch" href="/assets/js/108.8468ae27.js"><link rel="prefetch" href="/assets/js/109.d0d20150.js"><link rel="prefetch" href="/assets/js/11.bba69180.js"><link rel="prefetch" href="/assets/js/110.7b577585.js"><link rel="prefetch" href="/assets/js/12.48641dd5.js"><link rel="prefetch" href="/assets/js/14.49b6efcb.js"><link rel="prefetch" href="/assets/js/15.7b6f73c8.js"><link rel="prefetch" href="/assets/js/16.a93e6229.js"><link rel="prefetch" href="/assets/js/17.3ffa4046.js"><link rel="prefetch" href="/assets/js/18.a5f6d6fc.js"><link rel="prefetch" href="/assets/js/19.f8193dbb.js"><link rel="prefetch" href="/assets/js/20.9cdfd0a8.js"><link rel="prefetch" href="/assets/js/21.ddf86c6f.js"><link rel="prefetch" href="/assets/js/22.6c6b6219.js"><link rel="prefetch" href="/assets/js/23.9b4c441f.js"><link rel="prefetch" href="/assets/js/24.b33ea5b1.js"><link rel="prefetch" href="/assets/js/25.a8e2aa67.js"><link rel="prefetch" href="/assets/js/26.ec7ae29c.js"><link rel="prefetch" href="/assets/js/27.df3d0fd7.js"><link rel="prefetch" href="/assets/js/28.95261abe.js"><link rel="prefetch" href="/assets/js/29.221b3d99.js"><link rel="prefetch" href="/assets/js/3.9522a0ef.js"><link rel="prefetch" href="/assets/js/30.7e7bd9e4.js"><link rel="prefetch" href="/assets/js/31.fea2360c.js"><link rel="prefetch" href="/assets/js/32.31cb1a87.js"><link rel="prefetch" href="/assets/js/33.94d4637a.js"><link rel="prefetch" href="/assets/js/34.4cd95fce.js"><link rel="prefetch" href="/assets/js/35.f86f7f86.js"><link rel="prefetch" href="/assets/js/36.44463ac7.js"><link rel="prefetch" href="/assets/js/37.f4640783.js"><link rel="prefetch" href="/assets/js/38.177ab55d.js"><link rel="prefetch" href="/assets/js/39.fa7a43c9.js"><link rel="prefetch" href="/assets/js/4.2b9c5c06.js"><link rel="prefetch" href="/assets/js/40.87b95e5c.js"><link rel="prefetch" href="/assets/js/41.df2daf62.js"><link rel="prefetch" href="/assets/js/42.a827a6d9.js"><link rel="prefetch" href="/assets/js/43.b1d793f7.js"><link rel="prefetch" href="/assets/js/44.3acab5b0.js"><link rel="prefetch" href="/assets/js/45.e22563e3.js"><link rel="prefetch" href="/assets/js/46.e990a76e.js"><link rel="prefetch" href="/assets/js/47.b0f246c3.js"><link rel="prefetch" href="/assets/js/48.ddf21731.js"><link rel="prefetch" href="/assets/js/49.1e80dce5.js"><link rel="prefetch" href="/assets/js/5.a6ac1f73.js"><link rel="prefetch" href="/assets/js/50.2ad4440b.js"><link rel="prefetch" href="/assets/js/51.484c96fc.js"><link rel="prefetch" href="/assets/js/52.14be858a.js"><link rel="prefetch" href="/assets/js/53.9e588902.js"><link rel="prefetch" href="/assets/js/54.f00f5624.js"><link rel="prefetch" href="/assets/js/55.aba0108c.js"><link rel="prefetch" href="/assets/js/56.e12f0202.js"><link rel="prefetch" href="/assets/js/57.6d2782d9.js"><link rel="prefetch" href="/assets/js/58.5a6b95ea.js"><link rel="prefetch" href="/assets/js/59.19a31535.js"><link rel="prefetch" href="/assets/js/6.ee8ec89a.js"><link rel="prefetch" href="/assets/js/60.697c5cd6.js"><link rel="prefetch" href="/assets/js/61.cd40083a.js"><link rel="prefetch" href="/assets/js/62.37eac03e.js"><link rel="prefetch" href="/assets/js/63.098b68ca.js"><link rel="prefetch" href="/assets/js/64.294e53d1.js"><link rel="prefetch" href="/assets/js/65.9b98c6fd.js"><link rel="prefetch" href="/assets/js/66.0a1e6403.js"><link rel="prefetch" href="/assets/js/67.d6e0d52f.js"><link rel="prefetch" href="/assets/js/68.80f574ac.js"><link rel="prefetch" href="/assets/js/69.309855c4.js"><link rel="prefetch" href="/assets/js/7.b596f48c.js"><link rel="prefetch" href="/assets/js/70.de11075d.js"><link rel="prefetch" href="/assets/js/71.374ef0b9.js"><link rel="prefetch" href="/assets/js/72.ec3c133f.js"><link rel="prefetch" href="/assets/js/73.c170e382.js"><link rel="prefetch" href="/assets/js/74.d4f638b7.js"><link rel="prefetch" href="/assets/js/75.d53bc0ae.js"><link rel="prefetch" href="/assets/js/76.38ee006e.js"><link rel="prefetch" href="/assets/js/77.750a895a.js"><link rel="prefetch" href="/assets/js/78.d443d1ad.js"><link rel="prefetch" href="/assets/js/79.571712cf.js"><link rel="prefetch" href="/assets/js/8.cc989257.js"><link rel="prefetch" href="/assets/js/80.3230fce2.js"><link rel="prefetch" href="/assets/js/81.091642cc.js"><link rel="prefetch" href="/assets/js/82.fded999a.js"><link rel="prefetch" href="/assets/js/83.6cda2a81.js"><link rel="prefetch" href="/assets/js/84.722cfec9.js"><link rel="prefetch" href="/assets/js/85.0c2feea6.js"><link rel="prefetch" href="/assets/js/86.f58d9229.js"><link rel="prefetch" href="/assets/js/87.df42a702.js"><link rel="prefetch" href="/assets/js/88.6ae3ad35.js"><link rel="prefetch" href="/assets/js/89.fbdc9cff.js"><link rel="prefetch" href="/assets/js/9.8b3c2935.js"><link rel="prefetch" href="/assets/js/90.fa4e4e4e.js"><link rel="prefetch" href="/assets/js/91.fe4aede5.js"><link rel="prefetch" href="/assets/js/92.d04b2b7f.js"><link rel="prefetch" href="/assets/js/93.3b61b03a.js"><link rel="prefetch" href="/assets/js/94.5f7cdb7b.js"><link rel="prefetch" href="/assets/js/95.05754675.js"><link rel="prefetch" href="/assets/js/96.c6f73344.js"><link rel="prefetch" href="/assets/js/97.105c0afc.js"><link rel="prefetch" href="/assets/js/98.dc218b7d.js"><link rel="prefetch" href="/assets/js/99.8b0c7dc4.js">
    <link rel="stylesheet" href="/assets/css/0.styles.c33d3a11.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo.png" alt="TQK的个人博客" class="logo"> <span class="site-name can-hide">TQK的个人博客</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="入门基础" class="dropdown-title"><span class="title">入门基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="入门基础" class="mobile-dropdown-title"><span class="title">入门基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/java/" class="nav-link">
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/base/seniorJava/" class="nav-link">
  Java基础(高级)
</a></li><li class="dropdown-item"><!----> <a href="/base/data-structure/" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-item"><!----> <a href="/base/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/base/JVM/" class="nav-link router-link-active">
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/base/es6/" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/base/shell/" class="nav-link">
  Shell脚本
</a></li><li class="dropdown-item"><!----> <a href="/base/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/base/c/" class="nav-link">
  C语言
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/db/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/db/mongdb/" class="nav-link">
  Mongdb
</a></li><li class="dropdown-item"><!----> <a href="/db/oracle/" class="nav-link">
  Oracle
</a></li><li class="dropdown-item"><!----> <a href="/db/db2/" class="nav-link">
  DB2
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><span class="title">常用框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用框架" class="mobile-dropdown-title"><span class="title">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/Spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/framework/SpringMVC/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/framework/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/framework/springboot/" class="nav-link">
  Springboot
</a></li><li class="dropdown-item"><!----> <a href="/framework/dubbo/" class="nav-link">
  Dubbo
</a></li><li class="dropdown-item"><!----> <a href="/framework/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/framework/SpringCloud/" class="nav-link">
  SpringCloud-Alibaba
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/middleware/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/middleware/gateway/" class="nav-link">
  gateway
</a></li><li class="dropdown-item"><!----> <a href="/middleware/zookeeper/" class="nav-link">
  zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/middleware/zuul/" class="nav-link">
  zuul
</a></li><li class="dropdown-item"><!----> <a href="/middleware/nocas/" class="nav-link">
  nocas
</a></li><li class="dropdown-item"><!----> <a href="/middleware/seata/" class="nav-link">
  seata
</a></li><li class="dropdown-item"><!----> <a href="/middleware/MQ消息队列/" class="nav-link">
  MQ消息队列
</a></li><li class="dropdown-item"><!----> <a href="/middleware/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/middleware/kubernetes/" class="nav-link">
  kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/middleware/Elasticsearch/" class="nav-link">
  Elasticsearch
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/alibaba/" class="nav-link">
  阿里巴巴Java开发手册
</a></li><li class="dropdown-item"><!----> <a href="/other/english/" class="nav-link">
  编程英语
</a></li><li class="dropdown-item"><!----> <a href="/other/idea/" class="nav-link">
  IDEA快捷键
</a></li><li class="dropdown-item"><!----> <a href="/other/url/" class="nav-link">
  常用网站
</a></li><li class="dropdown-item"><!----> <a href="/other/jdk/" class="nav-link">
  Liunx安装jdk
</a></li><li class="dropdown-item"><!----> <a href="/other/jiqun/" class="nav-link">
  Liunx集群
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/maven/" class="nav-link">
  maven
</a></li><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/tool/jemeter/" class="nav-link">
  jemeter
</a></li><li class="dropdown-item"><!----> <a href="/tool/postman/" class="nav-link">
  postman
</a></li><li class="dropdown-item"><!----> <a href="/tool/PowerDesigner/" class="nav-link">
  PowerDesigner
</a></li><li class="dropdown-item"><!----> <a href="/tool/Jenkins/" class="nav-link">
  Jenkins
</a></li><li class="dropdown-item"><!----> <a href="/tool/Nodejs/" class="nav-link">
  Nodejs
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/zeroonbush/blog.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="入门基础" class="dropdown-title"><span class="title">入门基础</span> <span class="arrow down"></span></button> <button type="button" aria-label="入门基础" class="mobile-dropdown-title"><span class="title">入门基础</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/base/java/" class="nav-link">
  Java基础
</a></li><li class="dropdown-item"><!----> <a href="/base/seniorJava/" class="nav-link">
  Java基础(高级)
</a></li><li class="dropdown-item"><!----> <a href="/base/data-structure/" class="nav-link">
  数据结构与算法
</a></li><li class="dropdown-item"><!----> <a href="/base/design-pattern/" class="nav-link">
  设计模式
</a></li><li class="dropdown-item"><!----> <a href="/base/JVM/" class="nav-link router-link-active">
  JVM
</a></li><li class="dropdown-item"><!----> <a href="/base/es6/" class="nav-link">
  Javascript
</a></li><li class="dropdown-item"><!----> <a href="/base/shell/" class="nav-link">
  Shell脚本
</a></li><li class="dropdown-item"><!----> <a href="/base/python/" class="nav-link">
  Python
</a></li><li class="dropdown-item"><!----> <a href="/base/c/" class="nav-link">
  C语言
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="数据库" class="dropdown-title"><span class="title">数据库</span> <span class="arrow down"></span></button> <button type="button" aria-label="数据库" class="mobile-dropdown-title"><span class="title">数据库</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/db/mysql/" class="nav-link">
  Mysql
</a></li><li class="dropdown-item"><!----> <a href="/db/redis/" class="nav-link">
  Redis
</a></li><li class="dropdown-item"><!----> <a href="/db/mongdb/" class="nav-link">
  Mongdb
</a></li><li class="dropdown-item"><!----> <a href="/db/oracle/" class="nav-link">
  Oracle
</a></li><li class="dropdown-item"><!----> <a href="/db/db2/" class="nav-link">
  DB2
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="常用框架" class="dropdown-title"><span class="title">常用框架</span> <span class="arrow down"></span></button> <button type="button" aria-label="常用框架" class="mobile-dropdown-title"><span class="title">常用框架</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/framework/Spring/" class="nav-link">
  Spring
</a></li><li class="dropdown-item"><!----> <a href="/framework/SpringMVC/" class="nav-link">
  SpringMVC
</a></li><li class="dropdown-item"><!----> <a href="/framework/mybatis/" class="nav-link">
  Mybatis
</a></li><li class="dropdown-item"><!----> <a href="/framework/springboot/" class="nav-link">
  Springboot
</a></li><li class="dropdown-item"><!----> <a href="/framework/dubbo/" class="nav-link">
  Dubbo
</a></li><li class="dropdown-item"><!----> <a href="/framework/vue/" class="nav-link">
  Vue
</a></li><li class="dropdown-item"><!----> <a href="/framework/SpringCloud/" class="nav-link">
  SpringCloud-Alibaba
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="中间件" class="dropdown-title"><span class="title">中间件</span> <span class="arrow down"></span></button> <button type="button" aria-label="中间件" class="mobile-dropdown-title"><span class="title">中间件</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/middleware/nginx/" class="nav-link">
  nginx
</a></li><li class="dropdown-item"><!----> <a href="/middleware/gateway/" class="nav-link">
  gateway
</a></li><li class="dropdown-item"><!----> <a href="/middleware/zookeeper/" class="nav-link">
  zookeeper
</a></li><li class="dropdown-item"><!----> <a href="/middleware/zuul/" class="nav-link">
  zuul
</a></li><li class="dropdown-item"><!----> <a href="/middleware/nocas/" class="nav-link">
  nocas
</a></li><li class="dropdown-item"><!----> <a href="/middleware/seata/" class="nav-link">
  seata
</a></li><li class="dropdown-item"><!----> <a href="/middleware/MQ消息队列/" class="nav-link">
  MQ消息队列
</a></li><li class="dropdown-item"><!----> <a href="/middleware/docker/" class="nav-link">
  docker
</a></li><li class="dropdown-item"><!----> <a href="/middleware/kubernetes/" class="nav-link">
  kubernetes
</a></li><li class="dropdown-item"><!----> <a href="/middleware/Elasticsearch/" class="nav-link">
  Elasticsearch
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="其他" class="dropdown-title"><span class="title">其他</span> <span class="arrow down"></span></button> <button type="button" aria-label="其他" class="mobile-dropdown-title"><span class="title">其他</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/other/alibaba/" class="nav-link">
  阿里巴巴Java开发手册
</a></li><li class="dropdown-item"><!----> <a href="/other/english/" class="nav-link">
  编程英语
</a></li><li class="dropdown-item"><!----> <a href="/other/idea/" class="nav-link">
  IDEA快捷键
</a></li><li class="dropdown-item"><!----> <a href="/other/url/" class="nav-link">
  常用网站
</a></li><li class="dropdown-item"><!----> <a href="/other/jdk/" class="nav-link">
  Liunx安装jdk
</a></li><li class="dropdown-item"><!----> <a href="/other/jiqun/" class="nav-link">
  Liunx集群
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="工具" class="dropdown-title"><span class="title">工具</span> <span class="arrow down"></span></button> <button type="button" aria-label="工具" class="mobile-dropdown-title"><span class="title">工具</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/tool/maven/" class="nav-link">
  maven
</a></li><li class="dropdown-item"><!----> <a href="/tool/git/" class="nav-link">
  git
</a></li><li class="dropdown-item"><!----> <a href="/tool/jemeter/" class="nav-link">
  jemeter
</a></li><li class="dropdown-item"><!----> <a href="/tool/postman/" class="nav-link">
  postman
</a></li><li class="dropdown-item"><!----> <a href="/tool/PowerDesigner/" class="nav-link">
  PowerDesigner
</a></li><li class="dropdown-item"><!----> <a href="/tool/Jenkins/" class="nav-link">
  Jenkins
</a></li><li class="dropdown-item"><!----> <a href="/tool/Nodejs/" class="nav-link">
  Nodejs
</a></li></ul></div></div><div class="nav-item"><a href="https://github.com/zeroonbush/blog.git" target="_blank" rel="noopener noreferrer" class="nav-link external">
  github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div> <!----></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>JVM</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/base/JVM/" aria-current="page" class="sidebar-link">JVM调优</a></li><li><a href="/base/JVM/JVM基础知识-0.html" class="sidebar-link">1. JVM基础知识</a></li><li><a href="/base/JVM/深入理解JVM的内存区域-1.html" class="sidebar-link">2. 深入理解JVM的内存区域</a></li><li><a href="/base/JVM/JVM中的对象及引用-2.html" class="sidebar-link">3. JVM中的对象及引用</a></li><li><a href="/base/JVM/垃圾回收机制及算法-3.html" class="sidebar-link">4. 垃圾回收机制及算法</a></li><li><a href="/base/JVM/垃圾回收器串讲及 HostSpot 的细节实现-4.html" class="sidebar-link">5. 垃圾回收器及HostSpot的细节</a></li><li><a href="/base/JVM/Class文件结构及深入字节码指令-5.html" class="sidebar-link">6. Class文件结构及字节码指令</a></li><li><a href="/base/JVM/类加载与类加载器-6.html" class="sidebar-link">7. 类加载与类加载器</a></li><li><a href="/base/JVM/方法调用的底层实现-8.html" class="active sidebar-link">8.方法调用的底层实现</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/base/JVM/方法调用的底层实现-8.html#_8-1-方法调用的字节码指令" class="sidebar-link">8.1 方法调用的字节码指令</a></li><li class="sidebar-sub-header"><a href="/base/JVM/方法调用的底层实现-8.html#_8-2-非虚方法" class="sidebar-link">8.2 非虚方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/base/JVM/方法调用的底层实现-8.html#_8-2-1-invokestatic用来调用静态方法" class="sidebar-link">8.2.1 invokestatic用来调用静态方法</a></li><li class="sidebar-sub-header"><a href="/base/JVM/方法调用的底层实现-8.html#_8-2-2-invokespecial用于调用私有实例方法、构造器及super关键字等" class="sidebar-link">8.2.2 invokespecial用于调用私有实例方法、构造器及super关键字等</a></li></ul></li><li class="sidebar-sub-header"><a href="/base/JVM/方法调用的底层实现-8.html#_8-3-虚方法" class="sidebar-link">8.3 虚方法</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/base/JVM/方法调用的底层实现-8.html#_8-3-1-分派" class="sidebar-link">8.3.1 分派</a></li><li class="sidebar-sub-header"><a href="/base/JVM/方法调用的底层实现-8.html#_8-3-2-接口调用" class="sidebar-link">8.3.2 接口调用</a></li><li class="sidebar-sub-header"><a href="/base/JVM/方法调用的底层实现-8.html#_8-3-3-lambda表达式" class="sidebar-link">8.3.3 Lambda表达式</a></li></ul></li></ul></li><li><a href="/base/JVM/Java语法糖及实现-9.html" class="sidebar-link">9.Java语法糖及实现</a></li><li><a href="/base/JVM/GC 调优工具-a.html" class="sidebar-link">10. GC调优工具</a></li><li><a href="/base/JVM/JVM 性能调优-b.html" class="sidebar-link">11.JVM性能调优（一）</a></li><li><a href="/base/JVM/JVM 性能调优二-c.html" class="sidebar-link">12.JVM性能调优（二）</a></li><li><a href="/base/JVM/JVM 调优实战-d.html" class="sidebar-link">13.JVM调优实战</a></li><li><a href="/base/JVM/MAT分析内存泄漏-e.html" class="sidebar-link">14.MAT分析内存泄漏</a></li><li><a href="/base/JVM/直接内存与JVM源码分析-f.html" class="sidebar-link">14. 直接内存与JVM源码分析</a></li><li><a href="/base/JVM/JVM编译技术原理-g.html" class="sidebar-link">15 JVM编译技术原理</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="_8-方法调用的底层实现"><a href="#_8-方法调用的底层实现" class="header-anchor">#</a> 8.方法调用的底层实现</h1> <p><font color="blue"><strong>我们写的代码，经过编译、经过类加载的各种阶段，进入了JVM的运行时数据区。<br>
但作为程序员真正关心是代码的执行，代码的执行其实本质上是方法的执行，站在JVM的角度归根到底还是字节码的执行。<br>
main函数是JVM指令执行的起点，JVM会创建main线程来执行main函数，以触发JVM一系列指令的执行，真正地把JVM跑起来。<br>
接着在我们的代码中，就是方法调用方法的过程，所以了解方法在JVM中的调用是非常必要的</strong></font></p> <h2 id="_8-1-方法调用的字节码指令"><a href="#_8-1-方法调用的字节码指令" class="header-anchor">#</a> 8.1 方法调用的字节码指令</h2> <p><strong>关于方法的调用，Java字节码共提供了5个指令，来调用不同类型的方法</strong></p> <div class="custom-block tip"><p class="custom-block-title">方法调用字节码的指令</p> <ol><li><font color="red"><strong>invokestatic：</strong></font> 用来调用静态方法；</li> <li><font color="red"><strong>invokespecial：</strong></font> 用于调用私有实例方法、构造器及 super 关键字等；</li> <li><font color="red"><strong>invokevirtual：</strong></font> 用于调用非私有实例方法，比如 public 和 protected，大多数方法调用属于这一种；</li> <li><font color="red"><strong>invokeinterface：</strong></font> 和上面这条指令类似，不过作用于接口类；</li> <li><font color="red"><strong>invokedynamic：</strong></font> 用于调用动态方法。</li></ol></div> <h2 id="_8-2-非虚方法"><a href="#_8-2-非虚方法" class="header-anchor">#</a> 8.2 非虚方法</h2> <p>如果方法在编译期就确定了具体的调用版本，这个版本在运行时是不可变的，这样的方法称为<font color="red"><strong>非虚方法</strong></font></p> <p>只要能被<font color="red"><strong>invokestatic</strong></font>和<font color="red"><strong>invokespecial</strong></font>指令调用的方法，都可以在解析阶段中确定唯一的调用版本，Java语言里符合这个条件的方法共有<font color="blue"><strong>静态方法、私有方法、实例构造器、父类方法</strong></font>4种，再加上被 <strong>final修饰的方法(尽管它使用 invokevirtual 指令调用)</strong>，这5种方法调用会在类加载的时候就可以把符号引用解析为该方法的直接引用。不需要在运行时再去完成</p> <h3 id="_8-2-1-invokestatic用来调用静态方法"><a href="#_8-2-1-invokestatic用来调用静态方法" class="header-anchor">#</a> 8.2.1 invokestatic用来调用静态方法</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 非虚方法的调用
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticResolution</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello java&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StaticResolution<span class="token punctuation">.</span>Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><a data-fancybox="" title="非虚方法的调用" href="./image/invokestatic.jpg"><img src="/assets/img/invokestatic.20452d53.jpg" alt="非虚方法的调用"></a></p> <p>这个方法调用在编译期间就明确以常量池项的形式固化在字节码指令的参数之中了</p> <p><a data-fancybox="" title="非虚方法的调用" href="./image/invokestatic1.jpg"><img src="/assets/img/invokestatic1.81916677.jpg" alt="非虚方法的调用"></a></p> <h3 id="_8-2-2-invokespecial用于调用私有实例方法、构造器及super关键字等"><a href="#_8-2-2-invokespecial用于调用私有实例方法、构造器及super关键字等" class="header-anchor">#</a> 8.2.2 invokespecial用于调用私有实例方法、构造器及super关键字等</h3> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 非虚方法的调用
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticResolution</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token class-name">Hello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello java&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">StaticResolution</span> staticResolution <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticResolution</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p><a data-fancybox="" title="非虚方法的调用" href="./image/invokespecial.jpg"><img src="/assets/img/invokespecial.b90401f7.jpg" alt="非虚方法的调用"></a></p> <h2 id="_8-3-虚方法"><a href="#_8-3-虚方法" class="header-anchor">#</a> 8.3 虚方法</h2> <p>与非虚方法相反，不是非虚方法的方法就是虚方法<br>
主要包括以下字节码中的两类<br>
▶ invokevirtual 用于调用非私有实例方法，比如 public 和 protected，大多数方法调用属于这一种（排除掉被 final 修饰的方法）<br>
▶ invokeinterface 和上面这条指令类似，不过作用于接口类</p> <p><strong>为什么叫做虚方法呢？</strong>
就是方法在运行时是可变的。很多时候JVM需要根据调用者的动态类型，来确定调用的目标方法，这就是动态绑定的过程；
相对比，invokestatic 指令加上 invokespecial 指令，就属于静态绑定过程。
因为 invokeinterface 指令跟 invokevirtual 类似，只是作用与接口，所以我们只要熟悉 invokevirtual 即可。</p> <h3 id="_8-3-1-分派"><a href="#_8-3-1-分派" class="header-anchor">#</a> 8.3.1 分派</h3> <p>要了解虚方法我们必须了解以下基础： Java 是一门面向对象的程序语言，因为 Java 具备面向对象的 3个基本特征:继承、封装和多态。</p> <p>分派调用过程将会揭示多态性特征的一些最基本的体现，如“重载”和“重写”在Java虚拟机之中是如何实现的</p> <h4 id="_8-3-1-1-静态分派"><a href="#_8-3-1-1-静态分派" class="header-anchor">#</a> 8.3.1.1 静态分派</h4> <p>多见于方法的重载。（重载：一个类中允许同时存在一个以上的同名方法，这些方法的参数个数或者类型不同）</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 静态分派--方法的重载--编译阶段
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">StaticDispatch</span><span class="token punctuation">{</span>

	<span class="token keyword">static</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Human</span><span class="token punctuation">{</span>
		<span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">sayhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Man</span> <span class="token keyword">extends</span> <span class="token class-name">Human</span><span class="token punctuation">{</span>
		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">void</span> <span class="token function">sayhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello,Man！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Woman</span> <span class="token keyword">extends</span> <span class="token class-name">Human</span><span class="token punctuation">{</span>
		<span class="token annotation punctuation">@Override</span>
		<span class="token keyword">void</span> <span class="token function">sayhello</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
			<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello,Woman！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token punctuation">}</span>
	<span class="token punctuation">}</span>

	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token class-name">Human</span> guy<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello,guy！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token class-name">Man</span> guy<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello,gentleman！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">sayHello</span><span class="token punctuation">(</span><span class="token class-name">Woman</span> guy<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hello,lady！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
	<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span>args<span class="token punctuation">)</span><span class="token punctuation">{</span>
		<span class="token class-name">StaticDispatch</span> sr <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">StaticDispatch</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Human</span> man <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Man</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
		<span class="token class-name">Human</span> woman <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Woman</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

		sr<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span>man<span class="token punctuation">)</span><span class="token punctuation">;</span>
		sr<span class="token punctuation">.</span><span class="token function">sayHello</span><span class="token punctuation">(</span>woman<span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p><a data-fancybox="" title="静态分派" href="./image/staticpai.jpg"><img src="/assets/img/staticpai.2345c5e0.jpg" alt="静态分派"></a></p> <p>“Human”称为变量的静态类型（Static Type），或者叫做的外观类型（Apparent Type），后面的“Man”则称为变量的实际类型（Actual Type）。</p> <p>静态类型和实际类型在程序中都可以发生一些变化，区别是静态类型的变化仅仅在使用时发生，变量本身的静态类型不会被改变，并且最终的静态类型是在编译期可知的；而实际类型变化的结果在运行期才可确定，编译器在编译程序的时候并不知道一个对象的实际类型是什么。</p> <p>代码中定义了两个静态类型相同但实际类型不同的变量，但<font color="red">虚拟机（准确地说是编译器）在重载时是通过参数的<strong>静态类型</strong>而不是<strong>实际类型</strong>作为判定依据的</font>。并且静态类型是编译期可知的。 因此在编译阶段Javac 编译器会根据参数的静态类型决定使用哪个重载版本，所以选择了 sayHello（Human） 作为调用目标。所有依赖静态类型来定位方法执行版本的分派动作称为静态分派。</p> <p>静态分派的典型应用是方法重载。<strong>静态分派发生在编译阶段</strong>，因此确定静态分派的动作实际上不是由虚拟机来执行的。 所以代码运行结果如下：
<a data-fancybox="" title="静态分派" href="./image/staticpai1.jpg"><img src="/assets/img/staticpai1.a09f6ae0.jpg" alt="静态分派"></a></p> <h4 id="_8-3-1-2-动态分派"><a href="#_8-3-1-2-动态分派" class="header-anchor">#</a> 8.3.1.2 动态分派</h4> <p>多见于方法的重写。（重写：在子类中将父类的成员方法的名称保留，重新编写成员方法的实现内容，更改方法的访问权限，修改返 回类型的为父类返回类型的子类。）</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 动态分派（多态）
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">DynamicDispatch</span> <span class="token punctuation">{</span>

    <span class="token keyword">static</span> <span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">Virus</span><span class="token punctuation">{</span> <span class="token comment">//病毒</span>
        <span class="token keyword">protected</span> <span class="token keyword">abstract</span> <span class="token keyword">void</span> <span class="token function">ill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//生病</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">Cold</span> <span class="token keyword">extends</span> <span class="token class-name">Virus</span><span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">ill</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;感冒了，好不舒服！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">CoronaVirus</span> <span class="token keyword">extends</span> <span class="token class-name">Virus</span><span class="token punctuation">{</span><span class="token comment">//冠状病毒</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token keyword">protected</span> <span class="token keyword">void</span> <span class="token function">ill</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;粘膜感染，空气传播，请带好口罩！&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>

        <span class="token class-name">Virus</span> clod<span class="token operator">=</span><span class="token keyword">new</span> <span class="token class-name">Cold</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//感冒了</span>
        clod<span class="token punctuation">.</span><span class="token function">ill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hashcode:&quot;</span><span class="token operator">+</span>clod<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        clod <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">CoronaVirus</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//（多态）</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;hashcode:&quot;</span><span class="token operator">+</span>clod<span class="token punctuation">.</span><span class="token function">hashCode</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        clod<span class="token punctuation">.</span><span class="token function">ill</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br></div></div><p>重写也是使用 invokevirtual 指令，只是这个时候具备多态性。</p> <div class="custom-block tip"><p class="custom-block-title">invokevirtual 指令有多态查找的机制，该指令运行时，解析过程如下：</p> <ol><li>找到操作数栈顶的第一个元素所指向的对象实际类型，记做 c；</li> <li>如果在类型 c 中找到与常量中的描述符和简单名称都相符的方法，则进行访问权限校验，如果通过则返回这个方法直接引用，查找过程结束，不通过则返回 java.lang.IllegalAccessError；</li> <li>否则，按照继承关系从下往上依次对 c 的各个父类进行第二步的搜索和验证过程；</li> <li>如果始终没找到合适的方法，则抛出 java.lang.AbstractMethodError 异常，这就是 Java 语言中方法重写的本质。</li></ol></div> <p>另外一点，这个时候我如果结合之前课程中讲过虚拟机栈中的内容，我就知道动态链接是干嘛的：<br>
invokevirtual 可以知道方法 call()的符号引用转换是在运行时期完成的，在方法调用的时候。
部分符号引用在运行期间转化为直接引用,这种转化就是动态链接。栈帧执行对内存区域的影响</p> <p><strong>方法表</strong></p> <p>动态分派会执行非常频繁的动作，JVM 运行时会频繁的、反复的去搜索元数据，所以 JVM 使用了一种优化手段，<strong>这个就是在方法区中建立一个虚方法表使用虚方法表索引来替代元数据查找以提高性能</strong> <a data-fancybox="" title="方法表" href="./image/methodtable.jpg"><img src="/assets/img/methodtable.32845fc6.jpg" alt="方法表"></a></p> <p>在实现上，最常用的手段就是为类在方法区中建立一个虚方法表。虚方法表中存放着各个方法的实际入口地址。如果某个方法在子类中没有被重写，那子类的虚方法表里面的地址入口和父类相同方法的地址入口是一致的，都指向父类的实现入口。如果子类中重写了这个方法，子类方法表中的地址将会 替换为指向子类实现版本的入口地址。PPT 图中，Son 重写了来自Father的全部方法，因此 Son 的方法表没有指向 Father 类型数据的箭头。但是 Son 和 Father 都没有重写来自 Object 的方法，所以它们的方法表中所有从 Object 继承来的方法都指向了 Object</p> <h3 id="_8-3-2-接口调用"><a href="#_8-3-2-接口调用" class="header-anchor">#</a> 8.3.2 接口调用</h3> <p><strong>invokeinterface 作用于接口类</strong></p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 接口
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">interface</span> <span class="token class-name">I</span> <span class="token punctuation">{</span>
    <span class="token keyword">default</span> <span class="token keyword">void</span> <span class="token function">infM</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">{</span>

    <span class="token punctuation">}</span>
    <span class="token keyword">void</span> <span class="token function">inf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
<span class="token comment">/**
 * 接口的调用字节码查看
 **/</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Invoke</span> <span class="token keyword">implements</span> <span class="token class-name">I</span> <span class="token punctuation">{</span>
    <span class="token annotation punctuation">@Override</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">inf</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Exception</span> <span class="token punctuation">{</span>
        <span class="token class-name">Invoke</span> invoke <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Invoke</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token class-name">I</span><span class="token punctuation">)</span> invoke<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">inf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br></div></div><p><a data-fancybox="" title="invokeinterface" href="./image/invokeinterface.jpg"><img src="/assets/img/invokeinterface.6aac1fae.jpg" alt="invokeinterface"></a></p> <h3 id="_8-3-3-lambda表达式"><a href="#_8-3-3-lambda表达式" class="header-anchor">#</a> 8.3.3 Lambda表达式</h3> <h4 id="_8-3-3-1-invokedynamic"><a href="#_8-3-3-1-invokedynamic" class="header-anchor">#</a> 8.3.3.1 invokedynamic</h4> <p>这个字节码是比较复杂。和反射类似，它用于一些动态的调用场景，但它和反射有着本质的不同，效率也比反射要高得多</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LambdaDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">Runnable</span> runnable<span class="token operator">=</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">-&gt;</span><span class="token punctuation">{</span>
            <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;say hello &quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        runnable<span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><a data-fancybox="" title="invokedynamic" href="./image/invokedynamic.jpg"><img src="/assets/img/invokedynamic.c3ab296c.jpg" alt="invokedynamic"></a></p> <h4 id="_8-3-3-2-方法句柄-methodhandle"><a href="#_8-3-3-2-方法句柄-methodhandle" class="header-anchor">#</a> 8.3.3.2 方法句柄（MethodHandle）</h4> <p><a data-fancybox="" title="invokedynamic" href="https://docs.oracle.com/javase/7/docs/api/java/lang/invoke/MethodHandles.html">官方文档解释：https://docs.oracle.com/javase/7/docs/api/java/lang/invoke/MethodHandles.html</a></p> <p>invokedynamic 指令的底层，是使用方法句柄（MethodHandle）来实现的。
方法句柄是一个能够被执行的引用，它可以指向静态方法和实例方法，以及虚构的get和set方法，从以下案例中可以看到MethodHandle提供的一些方法。
<a data-fancybox="" title="MethodHandle" href="./image/MethodHandle.jpg"><img src="/assets/img/MethodHandle.9cfa492e.jpg" alt="MethodHandle"></a></p> <p>MethodHandle 是什么？简单的说就是方法句柄，通过这个句柄可以调用相应的方法。</p> <div class="custom-block tip"><p class="custom-block-title">用MethodHandle调用方法的流程</p> <ol><li>创建MethodType,获取指定方法的签名（出参和入参）</li> <li>在Lookup中查找MethodType的方法句柄MethodHandle</li> <li>传入方法参数通过MethodHandle调用方法</li></ol></div> <h5 id="_8-3-3-2-1-methodtype"><a href="#_8-3-3-2-1-methodtype" class="header-anchor">#</a> 8.3.3.2.1 MethodType</h5> <p>MethodType 表示一个方法类型的对象，每个 MethodHandle 都有一个 MethodType 实例，MethodType 用来指明方法的返回类型和参数类型。其有多个工厂方法的重载。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code>        <span class="token comment">//方法类型表示接受的参数和返回类型（第一个参数是返回参数）</span>
        <span class="token class-name">MethodType</span> methodType<span class="token operator">=</span><span class="token class-name">MethodType</span><span class="token punctuation">.</span><span class="token function">methodType</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>


        STATIC <span class="token class-name">METHODTYPE</span> <span class="token function">METHODTYPE</span><span class="token punctuation">(</span>CLASS<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> RTYPE<span class="token punctuation">)</span> 
        STATIC <span class="token class-name">METHODTYPE</span> <span class="token function">METHODTYPE</span><span class="token punctuation">(</span>CLASS<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> RTYPE<span class="token punctuation">,</span> CLASS<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> PTYPE0<span class="token punctuation">)</span> 
        STATIC <span class="token class-name">METHODTYPE</span> <span class="token function">METHODTYPE</span><span class="token punctuation">(</span>CLASS<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> RTYPE<span class="token punctuation">,</span> CLASS<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> PTYPES<span class="token punctuation">)</span> 
        STATIC <span class="token class-name">METHODTYPE</span> <span class="token function">METHODTYPE</span><span class="token punctuation">(</span>CLASS<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> RTYPE<span class="token punctuation">,</span> CLASS<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> PTYPE0<span class="token punctuation">,</span> CLASS<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> PTYPES<span class="token punctuation">)</span> 
        STATIC <span class="token class-name">METHODTYPE</span> <span class="token function">METHODTYPE</span><span class="token punctuation">(</span>CLASS<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> RTYPE<span class="token punctuation">,</span> LIST<span class="token generics"><span class="token punctuation">&lt;</span>CLASS<span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span><span class="token punctuation">&gt;</span></span> PTYPES<span class="token punctuation">)</span> 
        STATIC <span class="token class-name">METHODTYPE</span> <span class="token function">METHODTYPE</span><span class="token punctuation">(</span>CLASS<span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span> RTYPE<span class="token punctuation">,</span> <span class="token class-name">METHODTYPE</span> PTYPES<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h5 id="_8-3-3-2-2-lookup"><a href="#_8-3-3-2-2-lookup" class="header-anchor">#</a> 8.3.3.2.2 Lookup</h5> <p>MethodHandle.Lookup 可以通过相应的 findxxx 方法得到相应的 MethodHandle，相当于 MethodHandle 的工厂方法。</p> <p>查找对象上的工厂方法对应于方法、构造函数和字段的所有主要用例。 findStatic相当于得到的是一个static方法的句柄（类似于invokestatic的作用），findVirtual 找的是普通方法（类似于 invokevirtual的作用）</p> <h5 id="_8-3-3-2-3-invoke"><a href="#_8-3-3-2-3-invoke" class="header-anchor">#</a> 8.3.3.2.3 invoke</h5> <p>其中需要注意的是 invoke 和 invokeExact,前者在调用的时候可以进行返回值和参数的类型转换工作，而后者是精确匹配的。 所以一般在使用是，往往 invoke 使用比 invokeExact 要多，因为 invokeExact 如果类型不匹配，则会抛错。</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 * 方法句柄 MethodHandle
 *
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">MethodHandleDemo</span> <span class="token punctuation">{</span>
    <span class="token keyword">static</span>  <span class="token keyword">class</span>  <span class="token class-name">Bike</span>  <span class="token punctuation">{</span>
        <span class="token class-name">String</span>  <span class="token function">sound</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
            <span class="token keyword">return</span>  <span class="token string">&quot;ding  ding ding&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span>  <span class="token keyword">class</span>  <span class="token class-name">Animal</span>  <span class="token punctuation">{</span>
        <span class="token class-name">String</span>  <span class="token function">sound</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
            <span class="token keyword">return</span>  <span class="token string">&quot;wow  wow wow&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span>  <span class="token keyword">class</span>  <span class="token class-name">Man</span>  <span class="token keyword">extends</span>  <span class="token class-name">Animal</span>  <span class="token punctuation">{</span>
        <span class="token annotation punctuation">@Override</span>
        <span class="token class-name">String</span>  <span class="token function">sound</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token punctuation">{</span>
            <span class="token keyword">return</span>  <span class="token string">&quot;窝 室 嫩 叠&quot;</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">sound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Bike</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;sound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">sound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Animal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;sound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token function">sound</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">Man</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token string">&quot;sound&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">static</span>  <span class="token class-name">String</span> <span class="token function">sound</span><span class="token punctuation">(</span><span class="token class-name">Object</span> object<span class="token punctuation">,</span><span class="token class-name">String</span> methodName<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">Throwable</span> <span class="token punctuation">{</span>
        <span class="token comment">//方法句柄--工厂方法Factory</span>
        <span class="token class-name">MethodHandles<span class="token punctuation">.</span>Lookup</span> lookup<span class="token operator">=</span> <span class="token class-name">MethodHandles</span><span class="token punctuation">.</span><span class="token function">lookup</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">//        lookup.</span>
        <span class="token comment">//方法类型表示接受的参数和返回类型（第一个参数是返回参数）</span>
        <span class="token class-name">MethodType</span> methodType<span class="token operator">=</span><span class="token class-name">MethodType</span><span class="token punctuation">.</span><span class="token function">methodType</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">//拿到具体的MethodHandle(findVirtual相当于字节码)</span>
        <span class="token class-name">MethodHandle</span> methodHandle<span class="token operator">=</span>lookup<span class="token punctuation">.</span><span class="token function">findVirtual</span><span class="token punctuation">(</span>object<span class="token punctuation">.</span><span class="token function">getClass</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>methodName<span class="token punctuation">,</span>methodType<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> msg<span class="token operator">=</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">)</span> methodHandle<span class="token punctuation">.</span><span class="token function">invoke</span><span class="token punctuation">(</span>object<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span>  msg<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br></div></div><h5 id="_8-3-3-2-4-lambda表达式的捕获与非捕获"><a href="#_8-3-3-2-4-lambda表达式的捕获与非捕获" class="header-anchor">#</a> 8.3.3.2.4 Lambda表达式的捕获与非捕获</h5> <p>当 Lambda 表达式访问一个定义在 Lambda 表达式体外的非静态变量或者对象时，这个 Lambda 表达式称为“捕获的”</p> <p>那么“非捕获”的 Lambda 表达式来就是 Lambda 表达式没有访问一个定义在 Lambda 表达式体外的非静态变量或者对象</p> <div class="language-java line-numbers-mode"><pre class="language-java"><code><span class="token comment">/**
 *当 Lambda 表达式访问一个定义在 Lambda 表达式体外的非静态变量或者对象时，这个 Lambda 表达式称为“捕获的”
 *当 Lambda 表达式没有访问一个定义在 Lambda 表达式体外的非静态变量或者对象,那么这个表达式是非捕获的Lambda表达式
 */</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">LambdaCapture</span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">repeatMessage</span><span class="token punctuation">(</span><span class="token string">&quot;捕获&quot;</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">repeatMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">repeatMessage</span><span class="token punctuation">(</span><span class="token class-name">String</span> text<span class="token punctuation">,</span> <span class="token keyword">int</span> count<span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//捕获型</span>

        <span class="token class-name">Runnable</span> r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">int</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> count<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>text<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">repeatMessage</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token comment">//非捕获型</span>
        <span class="token class-name">Runnable</span> r <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;窝 嫩 叠!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
        <span class="token keyword">new</span> <span class="token class-name">Thread</span><span class="token punctuation">(</span>r<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><p>Lambda 表达式是否是捕获的和性能悄然相关。一个非捕获的 lambda 通常比捕获的更高效，非捕获的 lambda 只需要计算一次. 然后每次使用到它都会返 回一个唯一的实例。
而捕获的lambda表达式每次使用时都需要重新计算一次，而且从目前实现来看，它很像实例化一个匿名内部类的实例。 lambda最差的情况性能内部类一样，好的情况肯定比内部类性能高。</p> <p>Oracle 公司的性能比较的文档，详细而全面的比较了lambda表达式和匿名函数之间的性能差别。 lambda 开发组也有一篇 PPT 其中也讲到了 lambda 的性能(包括 capture 和非 capture 的情况)。 lambda 最差的情况性能内部类一样， 好的情况肯定比内部 类性能高。</p> <p>https://www.oracle.com/technetwork/java/jvmls2013kuksen-2014088.pdf</p> <p>http://nerds-central.blogspot.tw/2013/03/java-8-lambdas-they-are-fast-very-fast.html</p> <h5 id="_8-3-3-2-5-总结"><a href="#_8-3-3-2-5-总结" class="header-anchor">#</a> 8.3.3.2.5 总结</h5> <p>Lambda 语言实际上是通过方法句柄来完成的，大致这么实现
<strong>JVM 编译的时候使用 invokedynamic 实现 Lambda 表达式，invokedynamic 的是使用 MethodHandle 实现的，所以 JVM 会根据你编写的 Lambda 表达式的代码，编译出一套可以去调用 MethodHandle 的字节码代 码，参考实例类：MethodHandleDemo</strong></p> <p>句柄类型（MethodType）是我们对方法的具体描述，配合方法名称，能够定位到一类函数。访问方法句柄和调用原来的指令基本一致，但它的调用异常， 包括一些权限检查，在运行时才能被发现。 案例中，我们完成了动态语言的特性，通过方法名称和传入的对象主体，进行不同的调用，而 Bike 和 Man 类，可以没有任何关系。 可以看到 Lambda 语言实际上是通过方法句柄来完成的，在调用链上自然也多了一些调用步骤，那么在性能上，是否就意味着 Lambda 性能低呢？对于大部分“非捕获”的 Lambda 表达式来说，JIT 编译器的逃逸分析能够优化这部分差异，性能和传统方式无异；但对于“捕获型”的表达式来说，则需要通过方法句柄，不断地生成适配器，性能自然就低了很多（不过和便捷性相比，一丁点性能损失是可接受的）。 invokedynamic 指令，它实际上是通过方法句柄来实现的。和我们关系最大的就是 Lambda 语法，我们了解原理，可以忽略那些对 Lambda 性能高低的 争论，同时还是要尽量写一些“非捕获”的 Lambda 表达式。</p></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/base/JVM/类加载与类加载器-6.html" class="prev">
        7. 类加载与类加载器
      </a></span> <span class="next"><a href="/base/JVM/Java语法糖及实现-9.html">
        9.Java语法糖及实现
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"><!----></div></div>
    <script src="/assets/js/app.40562028.js" defer></script><script src="/assets/js/2.ee1c79d6.js" defer></script><script src="/assets/js/13.9fc99377.js" defer></script>
  </body>
</html>
