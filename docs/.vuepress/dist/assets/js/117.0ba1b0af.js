(window.webpackJsonp=window.webpackJsonp||[]).push([[117],{1480:function(t,s,a){"use strict";a.r(s);var n=a(26),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"_3-feign性能调优"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-feign性能调优"}},[t._v("#")]),t._v(" 3. Feign性能调优")]),t._v(" "),n("h2",{attrs:{id:"_3-1-gzip-压缩"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-gzip-压缩"}},[t._v("#")]),t._v(" 3.1 Gzip 压缩")]),t._v(" "),n("p",[n("strong",[t._v("gzip 介绍")]),t._v("：gzip 是一种数据格式，采用 deflate 算法压缩数据；gzip 是一种流行的文件压缩算法，应用十分广泛，尤其是在 Linux 平台。")]),t._v(" "),n("p",[n("strong",[t._v("gzip 能力")]),t._v("：当 Gzip 压缩一个纯文本文件时，效果是非常明显的，大约可以减少 70％ 以上的文件大小。")]),t._v(" "),n("p",[n("strong",[t._v("gzip 作用")]),t._v("：网络数据经过压缩后实际上降低了网络传输的字节数，最明显的好处就是可以加快网页加载的速度。")]),t._v(" "),n("p",[t._v("网页加载速度加快的好处不言而喻，除了节省流量，改善用户的浏览体验外，另一个潜在的好处是 Gzip 与搜索引擎的抓取工具有着更好的关系。例如 Google 就可以通过直接读取 gzip 文件来比普通手工抓取更快地检索网页。")]),t._v(" "),n("h3",{attrs:{id:"http协议关于压缩传输的规定"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#http协议关于压缩传输的规定"}},[t._v("#")]),t._v(" HTTP协议关于压缩传输的规定")]),t._v(" "),n("ol",[n("li",[n("p",[t._v("客户端向服务器请求中带有： "),n("strong",[t._v("Accept-Encoding:gzip ， deflate 字段")]),t._v("，向服务器表示客户端支持的压缩格式\n（gzip 或者 deflate），如果不发送该消息头，服务端默认是不会压缩的。")])]),t._v(" "),n("li",[n("p",[t._v("服务端在收到请求之后，如果发现请求头中含有 Accept-Encoding 字段，并且支持该类型压缩，就会对响应\n报文压缩之后返回给客户端，并且携带 C"),n("strong",[t._v("ontent-Encoding:gzip")]),t._v(" 消息头，表示响应报文是根据该格式进行压\n缩的。")])]),t._v(" "),n("li",[n("p",[t._v("客户端接收到请求之后，先判断是否有 "),n("strong",[t._v("Content-Encoding 消息头")]),t._v("，如果有，按该格式解压报文。否则按正常\n报文处理。")])])]),t._v(" "),n("h3",{attrs:{id:"_3-1-1-gzip压缩案例局部"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-1-gzip压缩案例局部"}},[t._v("#")]),t._v(" 3.1.1 Gzip压缩案例局部")]),t._v(" "),n("p",[t._v("只配置 Consumer 通过 Feign 到 Provider 的请求与相应的 Gzip 压缩。")]),t._v(" "),n("h4",{attrs:{id:"服务消费者-application-yml"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#服务消费者-application-yml"}},[t._v("#")]),t._v(" 服务消费者 application.yml")]),t._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Feign gzip 压缩")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("feign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("compression")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置压缩支持的 MIME TYPE")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mime-types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" application/json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("application/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/plain\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置压缩数据大小的最小阈值，默认2048")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min-request-size")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求是否开启 gzip 压缩")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("response")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 响应是否开启 gzip 压缩")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br")])]),n("h3",{attrs:{id:"_3-1-2-gzip压缩案例全局"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-1-2-gzip压缩案例全局"}},[t._v("#")]),t._v(" 3.1.2 Gzip压缩案例全局")]),t._v(" "),n("p",[t._v("对客户端浏览器的请求以及 Consumer 对 Provider 的请求与响应都实现 Gzip 压缩。")]),t._v(" "),n("h4",{attrs:{id:"服务消费者-application-yml-2"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#服务消费者-application-yml-2"}},[t._v("#")]),t._v(" 服务消费者 application.yml")]),t._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 端口")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("compression")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启压缩")]),t._v("\n   enabled"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置压缩支持的 MIME TYPE")]),t._v("\n   mime"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" application/json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("application/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/plain\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br")])]),n("p",[n("a",{attrs:{"data-fancybox":"",title:" Feign",href:"./image/Feign03.jpg"}},[n("img",{attrs:{src:a(835),alt:"Feign"}})])]),t._v(" "),n("h2",{attrs:{id:"_3-2-http-连接池"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-http-连接池"}},[t._v("#")]),t._v(" 3.2 HTTP 连接池")]),t._v(" "),n("h3",{attrs:{id:"_3-2-1-为什么要使用http-连接池"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-1-为什么要使用http-连接池"}},[t._v("#")]),t._v(" 3.2.1 为什么要使用HTTP 连接池")]),t._v(" "),n("ol",[n("li",[t._v("两台服务器建立 HTTP 连接的过程是很复杂的一个过程，涉及到多个数据包的交换，很耗时间。")]),t._v(" "),n("li",[t._v("HTTP 连接需要的 3 次握手 4 次挥手开销很大，这一开销对于大量的比较小的 HTTP 消息来说更大。")])]),t._v(" "),n("h3",{attrs:{id:"_3-2-2-解决方案"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-2-解决方案"}},[t._v("#")]),t._v(" 3.2.2 解决方案")]),t._v(" "),n("p",[t._v("采用 HTTP 连接池，可以节约大量的 3 次握手 4 次挥手，这样能大大提升吞吐量。")]),t._v(" "),n("p",[t._v("Feign 的 HTTP 客户端支持 3 种框架： HttpURLConnection 、 HttpClient 、 OkHttp ；默认是HttpURLConnection 。")]),t._v(" "),n("p",[t._v("可以通过查看源码\n"),n("strong",[t._v("org.springframework.cloud.openfeign.ribbon.FeignRibbonClientAutoConfiguration.java")]),t._v("得知。")]),t._v(" "),n("p",[t._v("传统的 HttpURLConnection 是 JDK 自带的，并不支持连接池，如果要实现连接池的机制，还需要自己来管理\n连接对象。对于网络请求这种底层相对复杂的操作，如果有可用的其他方案，没有必要自己去管理连接对象。")]),t._v(" "),n("p",[n("strong",[t._v("HttpClient")]),t._v(" 相比传统 JDK 自带的 HttpURLConnection，它封装了访问 HTTP 的请求头，参数，内容体，响应等\n等；\n它不仅使客户端发送 HTTP 请求变得容易，而且也方便了开发人员测试接口（基于 HTTP 协议的），既提\n高了开发的效率，又提高了代码的健壮性；另外高并发大量的请求网络的时候，也是用“连接池”提升吞吐量。")]),t._v(" "),n("h3",{attrs:{id:"_3-2-3-feign的http客户端修改"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-3-feign的http客户端修改"}},[t._v("#")]),t._v(" 3.2.3  Feign的http客户端修改")]),t._v(" "),n("p",[n("strong",[t._v("将 Feign 的 Http 客户端工具修改为 HttpClient。")])]),t._v(" "),n("h4",{attrs:{id:"添加依赖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#添加依赖"}},[t._v("#")]),t._v(" 添加依赖")]),t._v(" "),n("p",[t._v("修改 Consumer 项目，添加两个依赖，因为本文中使用的 Spring CLoud 版本已经默认集成了 apache\nhttpclient 依赖，所以只需要添加一个依赖即可。")]),t._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- 当前版本已经默认集成了 apache httpclient 依赖 --\x3e")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("org.apache.httpcomponents"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("httpclient"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("4.5.11"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("\x3c!-- feign apache httpclient 依赖 --\x3e")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("io.github.openfeign"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("feign-httpclient"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("<")]),t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("10.7.4"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("version")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("</")]),t._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(">")])]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br")])]),n("h4",{attrs:{id:"配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置文件"}},[t._v("#")]),t._v(" 配置文件")]),t._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("feign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("httpclient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启 httpclient")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("p",[n("strong",[t._v("如果使用 HttpClient 作为 Feign 的客户端工")]),t._v("具。那么在定义接口上的注解是需要注意的，如果传递的参数\n是一个自定义的对象（对象会使用 JSON 格式来专递），需要配置参数类型，例如：")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v(" "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("value "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/single/pojo"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" consumes "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("MediaType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("APPLICATION_JSON_VALUE"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" 。\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br")])]),n("p",[t._v("本文中使用的 Spring CLoud 版本，已无需手动配置。并且使用了 HttpClient 客户端以后，我们还可以通过 GET 请求传递对象参数。")]),t._v(" "),n("h3",{attrs:{id:"_3-2-4-测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-4-测试"}},[t._v("#")]),t._v(" 3.2.4 测试")]),t._v(" "),n("p",[t._v("访问： http://localhost:9090/product/pojo?id=6&productName=耳机&productNum=1&productPrice=288")]),t._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:" Feign",href:"./image/Feign04.jpg"}},[n("img",{attrs:{src:a(836),alt:"Feign"}})])]),t._v(" "),n("h2",{attrs:{id:"_3-3-日志查看"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-日志查看"}},[t._v("#")]),t._v(" 3.3 日志查看")]),t._v(" "),n("p",[t._v("浏览器发起的请求我们可以借助 F12 Devtools 中的 Network 来查看请求和响应信息。对于微服务中每个接口\n我们又该如何查看 URL，状态码和耗时信息？我们可以使用配置日志的方式进行查看。")]),t._v(" "),n("h3",{attrs:{id:"_3-3-2-全局配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-2-全局配置"}},[t._v("#")]),t._v(" 3.3.2 全局配置")]),t._v(" "),n("p",[t._v("Consumer 项目启动类中注入 Feign 的 Logger 对象。")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     *    NONE：不记录任何信息，默认值\n     *     BASIC：记录请求方法、请求 URL、状态码和用时\n     *     HEADERS：在 BASIC 基础上再记录一些常用信息\n     *     FULL：记录请求和相应的所有信息\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@Bean")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Logger"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Level")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("getLog")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Logger"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("Level")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("FULL"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br")])]),n("h3",{attrs:{id:"_3-3-3-局部配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-3-局部配置"}},[t._v("#")]),t._v(" 3.3.3 局部配置")]),t._v(" "),n("p",[t._v("Consumer 项目 application.yml 中指定服务开启状态查看。")]),t._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("feign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   config"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n     service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("provider")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 需要调用的服务名称")]),t._v("\n       loggerLevel"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" FULL\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br")])]),n("h3",{attrs:{id:"_3-3-4-测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-3-4-测试"}},[t._v("#")]),t._v(" 3.3.4 测试")]),t._v(" "),n("p",[t._v("访问：http://localhost:9090/order/1 核心日志信息如下：")]),t._v(" "),n("div",{staticClass:"language-log line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[t._v('2021-12-04 19:26:59.912 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 >> GET /product/5 HTTP/1.1\n2021-12-04 19:26:59.912 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 >> Accept-Encoding: gzip\n2021-12-04 19:26:59.912 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 >> Accept-Encoding: deflate\n2021-12-04 19:26:59.912 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 >> Accept: */*\n2021-12-04 19:26:59.912 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 >> Content-Length: 0\n2021-12-04 19:26:59.912 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 >> Host: 192.168.0.105:7071\n2021-12-04 19:26:59.912 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 >> Connection: Keep-Alive\n2021-12-04 19:26:59.912 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 >> User-Agent: Apache-HttpClient/4.5.11 (Java/1.8.0_144)\n2021-12-04 19:26:59.913 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 >> "GET /product/5 HTTP/1.1[\\r][\\n]"\n2021-12-04 19:26:59.913 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 >> "Accept-Encoding: gzip[\\r][\\n]"\n2021-12-04 19:26:59.913 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 >> "Accept-Encoding: deflate[\\r][\\n]"\n2021-12-04 19:26:59.913 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 >> "Accept: */*[\\r][\\n]"\n2021-12-04 19:26:59.913 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 >> "Content-Length: 0[\\r][\\n]"\n2021-12-04 19:26:59.913 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 >> "Host: 192.168.0.105:7071[\\r][\\n]"\n2021-12-04 19:26:59.913 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 >> "Connection: Keep-Alive[\\r][\\n]"\n2021-12-04 19:26:59.913 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 >> "User-Agent: Apache-HttpClient/4.5.11 (Java/1.8.0_144)[\\r][\\n]"\n2021-12-04 19:26:59.913 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 >> "[\\r][\\n]"\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 << "HTTP/1.1 200 [\\r][\\n]"\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 << "Content-Type: application/json[\\r][\\n]"\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 << "Transfer-Encoding: chunked[\\r][\\n]"\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 << "Date: Sat, 04 Dec 2021 11:26:59 GMT[\\r][\\n]"\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 << "Keep-Alive: timeout=60[\\r][\\n]"\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 << "Connection: keep-alive[\\r][\\n]"\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 << "[\\r][\\n]"\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 << "44[\\r][\\n]"\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.wire                     : http-outgoing-0 << "{"id":5,"productName":"[0xe5][0x86][0xb0][0xe7][0xae][0xb1]","productNum":1,"productPrice":2666.0}[\\r][\\n]"\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 << HTTP/1.1 200 \n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 << Content-Type: application/json\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 << Transfer-Encoding: chunked\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 << Date: Sat, 04 Dec 2021 11:26:59 GMT\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 << Keep-Alive: timeout=60\n2021-12-04 19:26:59.916 DEBUG 9020 --- [nio-9090-exec-1] org.apache.http.headers                  : http-outgoing-0 << Connection: keep-alive\n')])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br")])]),n("h2",{attrs:{id:"_3-4-请求超时"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-请求超时"}},[t._v("#")]),t._v(" 3.4 请求超时")]),t._v(" "),n("p",[t._v("Feign 的负载均衡底层用的就是 Ribbon，所以这里的请求超时配置其实就是配置 Ribbon。")]),t._v(" "),n("p",[t._v("分布式项目中，服务压力比较大的情况下，可能处理服务的过程需要花费一定的时间，而"),n("strong",[t._v("默认情况下请求超时的配置是 1s")]),t._v(" 所以我们需要调整该配置延长请求超时时间。")]),t._v(" "),n("h3",{attrs:{id:"_3-4-1-全局配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-1-全局配置"}},[t._v("#")]),t._v(" 3.4.1 全局配置")]),t._v(" "),n("p",[t._v("Consumer 项目中配置请求超时的处理。")]),t._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ribbon")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ConnectTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5000")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求连接的超时时间 默认的时间为 1 秒")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ReadTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 5000    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求处理的超时时间")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br")])]),n("h3",{attrs:{id:"_3-4-2-局部配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-2-局部配置"}},[t._v("#")]),t._v(" 3.4.2 局部配置")]),t._v(" "),n("p",[t._v("一般我们会根据服务的压力大小配置不同的服务超时处理，使用局部配置。")]),t._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# service-provider 是需要调用的服务名称")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-provider")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ribbon")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n   OkToRetryOnAllOperations"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" true  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对所有请求都进行重试")]),t._v("\n   MaxAutoRetries"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 2               "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对当前实例的重试次数")]),t._v("\n   MaxAutoRetriesNextServer"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 0     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 切换实例的重试次数")]),t._v("\n   ConnectTimeout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 3000            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求连接的超时时间")]),t._v("\n   ReadTimeout"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" 3000               "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求处理的超时时间")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br")])]),n("h3",{attrs:{id:"_3-4-3-测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-4-3-测试"}},[t._v("#")]),t._v(" 3.4.3 测试")]),t._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[t._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("/**\n     * 根据主键查询商品\n     *\n     * @param id\n     * @return\n     */")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@GetMapping")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"/{id}"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("public")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Product")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("selectProductById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[t._v("@PathVariable")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[t._v('"id"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Integer")]),t._v(" id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//todo 模拟业务超时")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("try")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Thread")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2000L")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("catch")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("InterruptedException")]),t._v(" e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n            e"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("printStackTrace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" productService"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("selectProductById")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br")])]),n("p",[n("a",{attrs:{"data-fancybox":"",title:" Feign",href:"./image/Feign05.jpg"}},[n("img",{attrs:{src:a(837),alt:"Feign"}})])]),t._v(" "),n("h2",{attrs:{id:"_3-5-消费者完整配置文件"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_3-5-消费者完整配置文件"}},[t._v("#")]),t._v(" 3.5 消费者完整配置文件")]),t._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("9090")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 端口")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("compression")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否开启压缩")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置压缩支持的 MIME TYPE")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mime-types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" application/json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("application/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/plain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("application/xhtml+xml\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("application")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("-")]),t._v("Consumer\n\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("eureka")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("register-with-eureka")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("false")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 是否将自己注册到注册中心，默认为 true")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("registry-fetch-interval-seconds")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("10")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 表示 Eureka Client 间隔多久去服务器拉取注册信息，默认为30 秒")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("defaultZone")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("12345tqk@localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8762/eureka/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("//root"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("12345tqk@localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("8763/eureka/\n      \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Feign gzip 压缩")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("feign")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("compression")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("request")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置压缩支持的 MIME TYPE")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("mime-types")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" application/json"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("application/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/html"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/xml"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("text/plain"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("application/xhtml+xml\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 配置压缩数据大小的最小阈值，默认2048")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("min-request-size")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("256")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求是否开启 gzip 压缩")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("response")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 响应是否开启 gzip 压缩")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#配置feign使用httpclient")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("httpclient")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 开启 httpclient")]),t._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# Consumer 项目 application.yml 中指定服务开启状态查看")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("client")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-provider")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 需要调用的服务名称")]),t._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("loggerLevel")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" FULL\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#ribbon:")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  ConnectTimeout: 5000 # 请求连接的超时时间 默认的时间为 1 秒")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("#  ReadTimeout: 5000    # 请求处理的超时时间")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 负载均衡策略")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# service-provider 为调用的服务的名称")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("service-provider")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ribbon")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("NFLoadBalancerRuleClassName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" com.netflix.loadbalancer.RandomRule\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("OkToRetryOnAllOperations")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[t._v("true")]),t._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对所有请求都进行重试")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MaxAutoRetries")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),t._v("               "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 对当前实例的重试次数")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("MaxAutoRetriesNextServer")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v("     "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 切换实例的重试次数")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ConnectTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求连接的超时时间")]),t._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[t._v("ReadTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3000")]),t._v("               "),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# 请求处理的超时时间")]),t._v("\n")])]),t._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[t._v("1")]),n("br"),n("span",{staticClass:"line-number"},[t._v("2")]),n("br"),n("span",{staticClass:"line-number"},[t._v("3")]),n("br"),n("span",{staticClass:"line-number"},[t._v("4")]),n("br"),n("span",{staticClass:"line-number"},[t._v("5")]),n("br"),n("span",{staticClass:"line-number"},[t._v("6")]),n("br"),n("span",{staticClass:"line-number"},[t._v("7")]),n("br"),n("span",{staticClass:"line-number"},[t._v("8")]),n("br"),n("span",{staticClass:"line-number"},[t._v("9")]),n("br"),n("span",{staticClass:"line-number"},[t._v("10")]),n("br"),n("span",{staticClass:"line-number"},[t._v("11")]),n("br"),n("span",{staticClass:"line-number"},[t._v("12")]),n("br"),n("span",{staticClass:"line-number"},[t._v("13")]),n("br"),n("span",{staticClass:"line-number"},[t._v("14")]),n("br"),n("span",{staticClass:"line-number"},[t._v("15")]),n("br"),n("span",{staticClass:"line-number"},[t._v("16")]),n("br"),n("span",{staticClass:"line-number"},[t._v("17")]),n("br"),n("span",{staticClass:"line-number"},[t._v("18")]),n("br"),n("span",{staticClass:"line-number"},[t._v("19")]),n("br"),n("span",{staticClass:"line-number"},[t._v("20")]),n("br"),n("span",{staticClass:"line-number"},[t._v("21")]),n("br"),n("span",{staticClass:"line-number"},[t._v("22")]),n("br"),n("span",{staticClass:"line-number"},[t._v("23")]),n("br"),n("span",{staticClass:"line-number"},[t._v("24")]),n("br"),n("span",{staticClass:"line-number"},[t._v("25")]),n("br"),n("span",{staticClass:"line-number"},[t._v("26")]),n("br"),n("span",{staticClass:"line-number"},[t._v("27")]),n("br"),n("span",{staticClass:"line-number"},[t._v("28")]),n("br"),n("span",{staticClass:"line-number"},[t._v("29")]),n("br"),n("span",{staticClass:"line-number"},[t._v("30")]),n("br"),n("span",{staticClass:"line-number"},[t._v("31")]),n("br"),n("span",{staticClass:"line-number"},[t._v("32")]),n("br"),n("span",{staticClass:"line-number"},[t._v("33")]),n("br"),n("span",{staticClass:"line-number"},[t._v("34")]),n("br"),n("span",{staticClass:"line-number"},[t._v("35")]),n("br"),n("span",{staticClass:"line-number"},[t._v("36")]),n("br"),n("span",{staticClass:"line-number"},[t._v("37")]),n("br"),n("span",{staticClass:"line-number"},[t._v("38")]),n("br"),n("span",{staticClass:"line-number"},[t._v("39")]),n("br"),n("span",{staticClass:"line-number"},[t._v("40")]),n("br"),n("span",{staticClass:"line-number"},[t._v("41")]),n("br"),n("span",{staticClass:"line-number"},[t._v("42")]),n("br"),n("span",{staticClass:"line-number"},[t._v("43")]),n("br"),n("span",{staticClass:"line-number"},[t._v("44")]),n("br"),n("span",{staticClass:"line-number"},[t._v("45")]),n("br"),n("span",{staticClass:"line-number"},[t._v("46")]),n("br"),n("span",{staticClass:"line-number"},[t._v("47")]),n("br"),n("span",{staticClass:"line-number"},[t._v("48")]),n("br"),n("span",{staticClass:"line-number"},[t._v("49")]),n("br"),n("span",{staticClass:"line-number"},[t._v("50")]),n("br"),n("span",{staticClass:"line-number"},[t._v("51")]),n("br"),n("span",{staticClass:"line-number"},[t._v("52")]),n("br"),n("span",{staticClass:"line-number"},[t._v("53")]),n("br"),n("span",{staticClass:"line-number"},[t._v("54")]),n("br"),n("span",{staticClass:"line-number"},[t._v("55")]),n("br"),n("span",{staticClass:"line-number"},[t._v("56")]),n("br"),n("span",{staticClass:"line-number"},[t._v("57")]),n("br"),n("span",{staticClass:"line-number"},[t._v("58")]),n("br"),n("span",{staticClass:"line-number"},[t._v("59")]),n("br")])])])}),[],!1,null,null,null);s.default=e.exports},835:function(t,s,a){t.exports=a.p+"assets/img/Feign03.d5307a46.jpg"},836:function(t,s,a){t.exports=a.p+"assets/img/Feign04.2bf6ac79.jpg"},837:function(t,s,a){t.exports=a.p+"assets/img/Feign05.dcaf6d3b.jpg"}}]);