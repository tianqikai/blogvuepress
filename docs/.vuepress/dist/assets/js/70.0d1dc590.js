(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{1049:function(s,a,n){s.exports=n.p+"assets/img/maven01.69c5e32e.jpg"},1050:function(s,a,n){s.exports=n.p+"assets/img/maven02.77c846ed.jpg"},1051:function(s,a,n){s.exports=n.p+"assets/img/aliyuncangku01.ebe0cbed.jpg"},1052:function(s,a,n){s.exports=n.p+"assets/img/image-20201121223516789.588761b0.png"},1053:function(s,a,n){s.exports=n.p+"assets/img/aliyuncangku02.3577f594.jpg"},1054:function(s,a,n){s.exports=n.p+"assets/img/aliyuncangku03.7f2ba055.jpg"},1589:function(s,a,n){"use strict";n.r(a);var t=n(26),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_16-k8s容器交付"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-k8s容器交付"}},[s._v("#")]),s._v(" 16. K8s容器交付")]),s._v(" "),t("p",[s._v("如何在k8s集群中部署Java项目")]),s._v(" "),t("h2",{attrs:{id:"_16-1-容器交付流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-1-容器交付流程"}},[s._v("#")]),s._v(" 16.1 容器交付流程")]),s._v(" "),t("ul",[t("li",[s._v("开发代码阶段\n"),t("ul",[t("li",[s._v("编写代码")]),s._v(" "),t("li",[s._v("编写Dockerfile【打镜像做准备】")])])]),s._v(" "),t("li",[s._v("持续交付/集成\n"),t("ul",[t("li",[s._v("代码编译打包")]),s._v(" "),t("li",[s._v("制作镜像")]),s._v(" "),t("li",[s._v("上传镜像仓库")])])]),s._v(" "),t("li",[s._v("应用部署\n"),t("ul",[t("li",[s._v("环境准备")]),s._v(" "),t("li",[s._v("Pod")]),s._v(" "),t("li",[s._v("Service")]),s._v(" "),t("li",[s._v("Ingress")])])]),s._v(" "),t("li",[s._v("运维\n"),t("ul",[t("li",[s._v("监控")]),s._v(" "),t("li",[s._v("故障排查")]),s._v(" "),t("li",[s._v("应用升级")])])])]),s._v(" "),t("h2",{attrs:{id:"_16-2-k8s部署java项目流程"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-2-k8s部署java项目流程"}},[s._v("#")]),s._v(" 16.2 k8s部署Java项目流程")]),s._v(" "),t("ul",[t("li",[s._v("制作镜像【Dockerfile】")]),s._v(" "),t("li",[s._v("上传到镜像仓库【Dockerhub、阿里云、网易】")]),s._v(" "),t("li",[s._v("控制器部署镜像【Deployment】")]),s._v(" "),t("li",[s._v("对外暴露应用【Service、Ingress】")]),s._v(" "),t("li",[s._v("运维【监控、升级】")])]),s._v(" "),t("h2",{attrs:{id:"_16-3-k8s部署java项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-3-k8s部署java项目"}},[s._v("#")]),s._v(" 16.3 k8s部署Java项目")]),s._v(" "),t("h3",{attrs:{id:"_16-3-1-准备java项目"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-3-1-准备java项目"}},[s._v("#")]),s._v(" 16.3.1 准备Java项目")]),s._v(" "),t("p",[s._v("第一步，准备java项目，把java进行打包【jar包或者war包】")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("maven命令")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("打包")]),s._v("：mvn package")]),s._v(" "),t("li",[t("strong",[s._v("编译")]),s._v("：mvn compile")]),s._v(" "),t("li",[t("strong",[s._v("清空")]),s._v("：mvn clean（清除编译后目录，默认是target目录）")]),s._v(" "),t("li",[t("strong",[s._v("运行测试")]),s._v("：mvn test")]),s._v(" "),t("li",[t("strong",[s._v("安装jar包到本地仓库中")]),s._v("：mvn install")]),s._v(" "),t("li",[t("strong",[s._v("跳过测试")]),s._v("：mvn xxx -DskipTests")])])]),s._v(" "),t("h3",{attrs:{id:"_16-3-2-依赖环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-3-2-依赖环境"}},[s._v("#")]),s._v(" 16.3.2 依赖环境")]),s._v(" "),t("p",[s._v("在打包java项目的时候，我们首先需要两个环境")]),s._v(" "),t("ul",[t("li",[s._v("java环境【JDK】")]),s._v(" "),t("li",[s._v("maven环境")])]),s._v(" "),t("p",[s._v("然后把java项目打包成jar包")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 项目目录下执行该命令")]),s._v("\nmvn clean "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 或者")]),s._v("\nmvn package\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[s._v("在 target 目录下，我们会发现编译生成的 class 文件")])]),s._v(" "),t("p",[t("img",{attrs:{src:n(1049),alt:"maven01.jpg"}})]),s._v(" "),t("h3",{attrs:{id:"_16-3-3-编写dockerfile文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-3-3-编写dockerfile文件"}},[s._v("#")]),s._v(" 16.3.3 编写Dockerfile文件")]),s._v(" "),t("p",[s._v("Dockerfile 内容如下所示")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("FROM openjdk:8-jdk-alpine\nVOLUME /tmp\nADD ./target/demojenkins.jar demojenkins.jar\nENTRYPOINT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/demojenkins.jar"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"&"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_16-3-4-制作镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-3-4-制作镜像"}},[s._v("#")]),s._v(" 16.3.4 制作镜像")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("在我们创建好Dockerfile文件后，我们就可以制作镜像了")])]),s._v(" "),t("li",[t("p",[s._v("我们首先将我们的项目，放到我们的服务器上")])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 mydocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# pwd")]),s._v("\n/root/mydocker\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 mydocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -lrt")]),s._v("\n总用量 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192400")]),s._v("\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("179439263")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("月   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2019")]),s._v(" jdk-8u211-linux-x64.rpm\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17566601")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":09 demojenkins.jar\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(":29 Dockerfile\n-rw-r--r-- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("452")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(":01 tqkdemo1.yaml\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("ul",[t("li",[s._v("然后执行下面命令打包镜像")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker build -t tqk-demo:latest "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("等待一段后，即可制作完成我们的镜像")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 mydocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker build -t tqk-demo:latest .")]),s._v("\nSending build context to Docker daemon    197MB\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/4 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" FROM openjdk:8-jdk-alpine\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" a3562aa0b991\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("/4 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" VOLUME /tmp\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 8927f70ce46e\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("/4 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ADD ./demojenkins.jar demojenkins.jar\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 9490c96665a9\nStep "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("/4 "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),s._v(" ENTRYPOINT "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"java"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"-jar"')]),s._v(","),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/demojenkins.jar"')]),s._v(", "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"&"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Using cache\n ---"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" 66f324da7999\nSuccessfully built 66f324da7999\nSuccessfully tagged tqk-demo:latest\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#---最后通过下面命令，即可查看我们的镜像了----------------------------")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 mydocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker images")]),s._v("\nREPOSITORY                                                        TAG                 IMAGE ID            CREATED             SIZE\ntqk-demo                                                          latest              66f324da7999        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" minutes ago      122MB\n\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),s._v(" "),t("h3",{attrs:{id:"_16-3-5-启动镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-3-5-启动镜像"}},[s._v("#")]),s._v(" 16.3.5 启动镜像")]),s._v(" "),t("ul",[t("li",[s._v("在我们制作完成镜像后，我们就可以启动我们的镜像了")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("docker run -d -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8111")]),s._v(":8111 tqk-demo:latest -t\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("启动完成后，我们通过浏览器进行访问，即可看到我们的java程序")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("http://192.168.222.10:8111/user\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[t("img",{attrs:{src:n(1050),alt:"maven02.jpg"}})]),s._v(" "),t("h3",{attrs:{id:"_16-3-6-推送镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-3-6-推送镜像"}},[s._v("#")]),s._v(" 16.3.6 推送镜像")]),s._v(" "),t("ul",[t("li",[s._v("下面我们需要将我们制作好的镜像，上传到镜像服务器中【阿里云、DockerHub】")])]),s._v(" "),t("p",[s._v("首先我们需要到 阿里云 "),t("a",{attrs:{href:"https://cr.console.aliyun.com/cn-hangzhou/instances/repositories",target:"_blank",rel:"noopener noreferrer"}},[s._v("容器镜像服务"),t("OutboundLink")],1),s._v("，然后开始创建镜像仓库")]),s._v(" "),t("p",[t("img",{attrs:{src:n(1051),alt:"aliyuncangku01"}})]),s._v(" "),t("ul",[t("li",[s._v("然后选择本地仓库")])]),s._v(" "),t("p",[t("img",{attrs:{src:n(1052),alt:"image-20201121223516789"}})]),s._v(" "),t("ul",[t("li",[s._v("我们点击我们刚刚创建的镜像仓库，就能看到以下的信息")])]),s._v(" "),t("p",[t("img",{attrs:{src:n(1053),alt:"aliyuncangku02"}})]),s._v(" "),t("h4",{attrs:{id:"登录镜像服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#登录镜像服务器"}},[s._v("#")]),s._v(" 登录镜像服务器")]),s._v(" "),t("p",[t("font",{attrs:{color:"red"}},[s._v("注意自己注册的城市--registry.cn-hangzhou.aliyuncs.com")])],1),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 mydocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker images")]),s._v("\nREPOSITORY                                                        TAG                 IMAGE ID            CREATED             SIZE\ntqk-demo                                                          latest              66f324da7999        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v(" minutes ago      122MB\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#### 登录镜像服务器")]),s._v("\n$ docker login --username"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("田起凯 registry.cn-hangzhou.aliyuncs.com\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#### 镜像添加版本号")]),s._v("\n$ docker tag "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ImageId"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" registry.cn-hangzhou.aliyuncs.com/tqk-space/tqk-demo:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像版本号"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#### 推送镜像")]),s._v("\n$ docker push registry.cn-hangzhou.aliyuncs.com/tqk-space/tqk-demo:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("镜像版本号"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 举例")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#### 登录镜像服务器")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 mydocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker login --username=田起凯 registry.cn-hangzhou.aliyuncs.com")]),s._v("\nPassword: \nWARNING"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v(" Your password will be stored unencrypted "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /root/.docker/config.json.\nConfigure a credential helper to remove this warning. See\nhttps://docs.docker.com/engine/reference/commandline/login/"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#credentials-store")]),s._v("\n\nLogin Succeeded\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#### 镜像添加版本号")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 mydocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker tag 66f324da7999 registry.cn-hangzhou.aliyuncs.com/tqk-space/tqk-demo:1.0.0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#### 推送镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 mydocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker push registry.cn-hangzhou.aliyuncs.com/tqk-space/tqk-demo:1.0.0")]),s._v("\nThe push refers to repository "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("registry.cn-hangzhou.aliyuncs.com/tqk-space/tqk-demo"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n468e6bbec318: Pushed \nceaf9e1ebef5: Pushed \n9b9b7f3d56a0: Pushed \nf1b5933fe4b5: Pushed \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0: digest: sha256:45915e83f95f3277cc416e7ad931e9b2a8ded14fa1d17ccebebac71c1d16bb6f size: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1159")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br")])]),t("ul",[t("li",[s._v("操作完成后")])]),s._v(" "),t("p",[t("img",{attrs:{src:n(1054),alt:"aliyuncangku03"}})]),s._v(" "),t("h3",{attrs:{id:"_16-3-7-控制器部署镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-3-7-控制器部署镜像"}},[s._v("#")]),s._v(" 16.3.7 控制器部署镜像")]),s._v(" "),t("p",[s._v("在我们推送镜像到服务器后，就可以通过控制器部署镜像了")]),s._v(" "),t("p",[s._v("首先我们需要根据刚刚的镜像，导出yaml")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 导出yaml")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 mydocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl create deployment  tqkdemo1 --image=registry.cn-hangzhou.aliyuncs.com/tqk-space/tqk-demo:1.0.0 --dry-run -o yaml > tqkdemo1.yaml")]),s._v("\nW1220 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(":49:20.300858   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("58026")]),s._v(" helpers.go:535"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" --dry-run is deprecated and can be replaced with --dry-run"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("client.\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[s._v("导出后的 tqkdemo1.yaml 如下所示")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("apiVersion: apps/v1\nkind: Deployment\nmetadata:\n  creationTimestamp: null\n  labels:\n    app: tqkdemo1\n  name: tqkdemo1\nspec:\n  replicas: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  selector:\n    matchLabels:\n      app: tqkdemo1\n  strategy: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  template:\n    metadata:\n      creationTimestamp: null\n      labels:\n        app: tqkdemo1\n    spec:\n      containers:\n      - image: registry.cn-hangzhou.aliyuncs.com/tqk-space/tqk-demo:1.0.0\n        name: tqk-demo\n        resources: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\nstatus: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("ul",[t("li",[s._v("然后通过下面命令，通过yaml创建我们的deployment")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 mydocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f tqkdemo1.yaml")]),s._v("\ndeployment.apps/tqkdemo1 created\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看 pods")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 mydocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods")]),s._v("\nNAME                          READY   STATUS    RESTARTS   AGE\nnginx-dep1-58b7bf955f-gz67j   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4h30m\nnginx-dep1-58b7bf955f-nfmfk   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4h30m\nnginx-dep1-58b7bf955f-s2xdh   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          4h30m\nnginx-f89759699-c24zc         "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          6h32m\ntqkdemo1-d4bcf9475-k9w6m      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          44s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),s._v(" "),t("ul",[t("li",[s._v("或者我们可以进行扩容，多创建几个副本")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl scale deployment tqkdemo1 --replicas"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),s._v(" "),t("ul",[t("li",[s._v("然后我们还需要对外暴露端口【通过service 或者 Ingress】")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对外暴露端口")]),s._v("\nkubectl expose deployment tqkdemo1 --port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8111")]),s._v("  --target-port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8111")]),s._v(" --type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodePort\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看对外端口号")]),s._v("\nkubectl get svc\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 mydocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl expose deployment tqkdemo1 --port=8111  --target-port=8111 --type=NodePort")]),s._v("\nservice/tqkdemo1 exposed\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 mydocker"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc")]),s._v("\nNAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("          AGE\nkubernetes   ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".0.1       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP          7h13m\nnginx        NodePort    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".101.161   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":30974/TCP     6h36m\ntqkdemo1     NodePort    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.1")]),s._v(".203.178   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8111")]),s._v(":31654/TCP   7s\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),s._v(" "),t("ul",[t("li",[s._v("然后通过下面的地址访问")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对内访问")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# curl http://10.1.203.178:8111/user")]),s._v("\nhello\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 对外访问")]),s._v("\nhttp://192.168.222.10:31654/user\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h3",{attrs:{id:"_16-3-8-运维"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_16-3-8-运维"}},[s._v("#")]),s._v(" 16.3.8 运维")]),s._v(" "),t("p",[s._v("....")])])}),[],!1,null,null,null);a.default=e.exports}}]);