(window.webpackJsonp=window.webpackJsonp||[]).push([[151],{1467:function(s,a,t){"use strict";t.r(a);var n=t(26),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"_2-consul环境搭建"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-consul环境搭建"}},[s._v("#")]),s._v(" 2. Consul环境搭建")]),s._v(" "),n("p",[n("strong",[s._v("注意：搭建是注意网络访问关系，是否在一个网段，网络是否联通")])]),s._v(" "),n("h2",{attrs:{id:"_2-1-单机版-开发使用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-单机版-开发使用"}},[s._v("#")]),s._v(" 2.1 单机版--开发使用")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 consul 目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/consul \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压至 consul 目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" consul_1.7.0_linux_amd64.zip -d /usr/local/consul/ \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 consul 数据目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/consul/data\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("nohup")]),s._v(" /usr/local/consul/consul agent -dev -client"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[s._v("访问管理后台：http://122.51.156.245:8500/ 看到下图意味着我们的 Consul 服务启动成功了")]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"Consul 单机版",href:"./image/consul04.jpg"}},[n("img",{attrs:{src:t(808),alt:"Consul 单机版"}})])]),s._v(" "),n("h2",{attrs:{id:"_2-2-集群版-非docker版"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-集群版-非docker版"}},[s._v("#")]),s._v(" 2.2 集群版-非docker版")]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"Consul 角色",href:"./image/consul03.jpg"}},[n("img",{attrs:{src:t(809),alt:"Consul 角色"}})])]),s._v(" "),n("p",[s._v("上图是一个简单的 Consul Cluster 架构，Consul Cluster 有 Server 和 Client 两种角色。不管是 Server 还是\nClient，统称为 Agent，Consul Client 是相对无状态的，只负责转发 RPC 到 Server 资源开销很少。Server 是一个有\n一组扩展功能的代理，这些功能包括参与 Raft 选举，维护集群状态，响应 RPC 查询，与其他数据中心交互 WAN\nGossip 和转发查询给 leader 或者远程数据中心。")]),s._v(" "),n("p",[s._v("每个数据中心，Client 和 Server 是混合的。一般建议有 3~5 台 Server。这是基于有故障情况下的可用性和性能\n之间的权衡结果，因为越多的机器加入达成共识越慢，Server 之间会选举出一个 Leader。然而并不限制 Client 的数\n量，一般建议一个服务对应一个 Client，它们可以很容易的扩展到数千或者数万台 。在开发时我们绑定一组服务注\n册中心中的客户端即可。")]),s._v(" "),n("h3",{attrs:{id:"_2-2-1-上传安装包"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-上传安装包"}},[s._v("#")]),s._v(" 2.2.1 上传安装包")]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 consul 目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/consul \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 解压至 consul 目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("unzip")]),s._v(" consul_1.7.0_linux_amd64.zip -d /usr/local/consul/ \n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建 consul 数据目录")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /usr/local/consul/data\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("h3",{attrs:{id:"_2-2-2-服务启动"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-服务启动"}},[s._v("#")]),s._v(" 2.2.2 服务启动")]),s._v(" "),n("p",[n("strong",[s._v("提前必须在一个网段中，公网搭建，网络不通")])]),s._v(" "),n("div",{staticClass:"language-sh line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-sh"}},[n("code",[s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 以 server 服务模式运行三台注册中心。")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node-01 1.117.13.88")]),s._v("\n/usr/local/consul/consul agent -server -bind"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.8 -client"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 -ui -bootstrap-expect"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" -data-dir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/consul/data/ -node"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("server-01\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node-02 101.43.21.33")]),s._v("\n/usr/local/consul/consul agent -server -bind"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.1 -client"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 -ui -bootstrap-expect"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" -data-dir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/consul/data/ -node"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("server-02\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# node-03 122.51.156.245")]),s._v("\n/usr/local/consul/consul agent -server -bind"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.18")]),s._v(".0.1 -client"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 -ui -bootstrap-expect"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" -data-dir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/consul/data/ -node"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("server-03\n\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#注册中心客户端 一台为例")]),s._v("\nconsul agent -client"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0 -bind"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".10.1 -data-dir"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("/usr/local/consul/data/  -node"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("client-01\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 加入集群")]),s._v("\n./consul "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.8\n./consul "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.8\n./consul "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.17")]),s._v(".0.8\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("参数含义如下：")]),s._v(" "),n("ol",[n("li",[s._v("-server ：以服务端身份启动（注册中心）")]),s._v(" "),n("li",[s._v("-bind ：表示绑定到哪个 ip")]),s._v(" "),n("li",[s._v("-client ：指定客户端访问的 ip，0.0.0.0 表示不限客户端 ip")]),s._v(" "),n("li",[s._v("-ui ：开启 web 界面访问")]),s._v(" "),n("li",[s._v("-bootstrap-expect=3 ：表示 server 集群最低节点数为 3，低于这个值将工作不正常（注：类似 ZooKeeper\n一样，通常集群数为奇数方便选举，Consul 采用的是 Raft 算法）")]),s._v(" "),n("li",[s._v("-data-dir ：表示指定数据的存放目录（该目录必须存在，需提前创建好）")]),s._v(" "),n("li",[s._v("-node ：表示节点在 web ui 中显示的名称")])])])])}),[],!1,null,null,null);a.default=e.exports},808:function(s,a,t){s.exports=t.p+"assets/img/consul04.71b77d77.jpg"},809:function(s,a,t){s.exports=t.p+"assets/img/consul03.af660491.jpg"}}]);