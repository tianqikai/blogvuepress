(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{1137:function(s,a,t){s.exports=t.p+"assets/img/image-20201119082047766.9b79ad6c.png"},1138:function(s,a,t){s.exports=t.p+"assets/img/image-20201119083444454.4350e4d0.png"},1139:function(s,a,t){s.exports=t.p+"assets/img/image-20201119083514247.79951023.png"},1140:function(s,a,t){s.exports=t.p+"assets/img/image-20201119095847548.bfb67e97.png"},1141:function(s,a,t){s.exports=t.p+"assets/img/image-20201119101753419.6d742c9f.png"},1142:function(s,a,t){s.exports=t.p+"assets/img/image-20201119101843498.1d9ec6ed.png"},1143:function(s,a,t){s.exports=t.p+"assets/img/image-20201119101957777.749a3fbd.png"},1144:function(s,a,t){s.exports=t.p+"assets/img/image-20201119102332786.4bb73703.png"},1145:function(s,a,t){s.exports=t.p+"assets/img/image-20201119102448226.63f6b92a.png"},1580:function(s,a,t){"use strict";t.r(a);var n=t(26),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"_13-k8s持久化存储"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-k8s持久化存储"}},[s._v("#")]),s._v(" 13. K8s持久化存储")]),s._v(" "),n("h2",{attrs:{id:"_13-1-前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-1-前言"}},[s._v("#")]),s._v(" 13.1 前言")]),s._v(" "),n("p",[s._v("之前我们有提到数据卷："),n("code",[s._v("emptydir")]),s._v(" ，是本地存储，pod重启，数据就不存在了，需要对数据持久化存储")]),s._v(" "),n("p",[s._v("对于数据持久化存储【pod重启，数据还存在】，有两种方式")]),s._v(" "),n("ul",[n("li",[s._v("nfs：网络存储【通过一台服务器来存储】")])]),s._v(" "),n("h2",{attrs:{id:"_13-2-安装步骤"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-安装步骤"}},[s._v("#")]),s._v(" 13.2 安装步骤")]),s._v(" "),n("h3",{attrs:{id:"_13-2-1-持久化服务器安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-1-持久化服务器安装"}},[s._v("#")]),s._v(" 13.2.1 持久化服务器安装")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("找一台新的服务器nfs服务端，安装nfs")])]),s._v(" "),n("li",[n("p",[s._v("设置挂载路径")])]),s._v(" "),n("li",[n("p",[s._v("使用命令安装nfs")])])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y nfs-utils\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("首先创建存放数据的目录")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /data/nfs\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("设置挂载路径")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/exports\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加如下内容")]),s._v("\n/data/nfs *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,no_root_squash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h4",{attrs:{id:"启动nfs服务端"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动nfs服务端"}},[s._v("#")]),s._v(" 启动nfs服务端")]),s._v(" "),n("p",[s._v("下面我们回到"),n("strong",[s._v("nfs服务端")]),s._v("，启动我们的nfs服务")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动服务")]),s._v("\nsystemctl start rpcbind "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" rpcbind\nsystemctl start nfs "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" systemctl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" nfs\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ------实际操作")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl status nfs")]),s._v("\n● nfs-server.service - NFS server and services\n   Loaded: loaded "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("/usr/lib/systemd/system/nfs-server.service"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" enabled"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" vendor preset: disabled"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  Drop-In: /run/systemd/generator/nfs-server.service.d\n           └─order-with-mounts.conf\n   Active: active "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exited"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" since 一 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-12-20 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":04:25 CST"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" 1min 46s ago\n Main PID: "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("7419")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("code"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("exited, "),n("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("status")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("/SUCCESS"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n   CGroup: /system.slice/nfs-server.service\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("月 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":04:25 localhost.localdomain systemd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Starting NFS server and services"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("月 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":04:25 localhost.localdomain systemd"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Started NFS server and services.\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("p",[n("img",{attrs:{src:t(1137),alt:"image-20201119082047766"}})]),s._v(" "),n("p",[s._v("执行完成后，即部署完我们的持久化服务器")]),s._v(" "),n("h3",{attrs:{id:"_13-2-2-node节点上操作"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-2-node节点上操作"}},[s._v("#")]),s._v(" 13.2.2 Node节点上操作")]),s._v(" "),n("p",[s._v("然后需要在k8s集群"),n("strong",[s._v("node节点上安装nfs")]),s._v("，这里需要在 "),n("strong",[s._v("node1 和 node2节点")]),s._v("上安装")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y nfs-utils\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"执行完成后-会自动帮我们挂载上"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#执行完成后-会自动帮我们挂载上"}},[s._v("#")]),s._v(" 执行完成后，会自动帮我们挂载上")]),s._v(" "),n("ul",[n("li",[s._v("每个node查询NFS服务器,检查是否挂载成功")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("showmount -e nfs-ip\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ---------------------")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# showmount -e 192.168.222.6")]),s._v("\nExport list "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.6:\n/data/nfs *\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"_13-2-3-k8s集群部署应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-3-k8s集群部署应用"}},[s._v("#")]),s._v(" 13.2.3 K8s集群部署应用")]),s._v(" "),n("ul",[n("li",[s._v("最后我们在k8s集群"),n("strong",[s._v("master")]),s._v("上部署应用，使用nfs持久化存储")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个pv文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("pv")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("pv")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("ul",[n("li",[s._v("然后创建一个yaml文件  "),n("code",[s._v("nfs-nginx.yaml")])])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[s._v("cat "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("/root/pv/nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nginx.yaml<<EOF\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dep1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wwwroot\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/share/nginx/html\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wwwroot\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nfs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.222.6\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /data/nfs\nEOF\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br")])]),n("p",[n("img",{attrs:{src:t(348),alt:"image-20201119082317625"}})]),s._v(" "),n("p",[s._v("通过这个方式，就挂载到了刚刚我们的nfs数据节点下的 /data/nfs 目录")]),s._v(" "),n("p",[s._v("最后就变成了：  /usr/share/nginx/html    ->  192.168.44.134/data/nfs   内容是对应的")]),s._v(" "),n("ul",[n("li",[s._v("我们通过这个 yaml文件，创建一个pod")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl apply -f nfs-nginx.yaml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("ul",[n("li",[s._v("创建完成后，我们也可以查看日志")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl describe pod nginx-dep1\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-log line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('  Type    Reason     Age        From               Message\n  ----    ------     ----       ----               -------\n  Normal  Scheduled  <unknown>  default-scheduler  Successfully assigned default/nginx-dep1-dbd9d8594-4mgns to node1\n  Normal  Pulling    23s        kubelet, node1     Pulling image "nginx"\n  Normal  Pulled     6s         kubelet, node1     Successfully pulled image "nginx"\n  Normal  Created    6s         kubelet, node1     Created container nginx\n  Normal  Started    6s         kubelet, node1     Started container nginx\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("img",{attrs:{src:t(1138),alt:"image-20201119083444454"}})]),s._v(" "),n("p",[s._v("可以看到，我们的pod已经成功创建出来了，同时下图也是出于Running状态")]),s._v(" "),n("p",[n("img",{attrs:{src:t(1139),alt:"image-20201119083514247"}})]),s._v(" "),n("h3",{attrs:{id:"_13-2-4-测试"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-2-4-测试"}},[s._v("#")]),s._v(" 13.2.4 测试")]),s._v(" "),n("p",[s._v("下面我们就可以进行测试了，比如现在nfs服务节点上添加数据，然后在看数据是否存在 pod中")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 进入pod中查看")]),s._v("\nkubectl "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it nginx-dep1-dbd9d8594-4mgns "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n\nroot@nginx-dep1-dbd9d8594-4mgns:/"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /usr/share/nginx/html")]),s._v("\nroot@nginx-dep1-dbd9d8594-4mgns:/usr/share/nginx/html"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls -lrt")]),s._v("\ntotal "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nfs服务器上创建一个文件index.html 再次查看")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [root@localhost nfs]# pwd")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# /data/nfs")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# [root@localhost nfs]# vi index.html")]),s._v("\n\nroot@nginx-dep1-dbd9d8594-4mgns:/usr/share/nginx/html"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ls")]),s._v("\nindex.html\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("p",[n("img",{attrs:{src:t(1140),alt:"image-20201119095847548"}})]),s._v(" "),n("h2",{attrs:{id:"_13-3-pv和pvc"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-3-pv和pvc"}},[s._v("#")]),s._v(" 13.3 PV和PVC")]),s._v(" "),n("p",[s._v("对于上述的方式，我们都知道，我们的ip 和端口是直接放在我们的容器上的，这样管理起来可能不方便")]),s._v(" "),n("p",[n("img",{attrs:{src:t(348),alt:"image-20201119082317625"}})]),s._v(" "),n("p",[s._v("所以这里就需要用到 pv  和 pvc的概念了，方便我们配置和管理我们的 ip 地址等元信息")]),s._v(" "),n("p",[n("strong",[s._v("PV：持久化存储，对存储的资源进行抽象，对外提供可以调用的地方[生产者]")])]),s._v(" "),n("p",[n("strong",[s._v("PVC：用于调用，不需要关心内部实现细节[消费者]")])]),s._v(" "),n("hr"),s._v(" "),n("p",[s._v("PV 和 PVC 使得 K8S 集群具备了存储的逻辑抽象能力。使得在配置Pod的逻辑里可以忽略对实际后台存储\n技术的配置，而把这项配置的工作交给PV的配置者，即集群的管理者。")]),s._v(" "),n("p",[s._v("存储的PV和PVC的这种关系，跟计算的Node和Pod的关系是非常类似的；"),n("strong",[s._v("PV和Node是资源的提供者")]),s._v("，根据集群的基础设施变化而变\n化，由K8s集群管理员配置；")]),s._v(" "),n("p",[s._v("而PVC和Pod是资源的使用者，根据业务服务的需求变化而变化，由K8s集群的使用者即服务的管理员来配置。")]),s._v(" "),n("h3",{attrs:{id:"_13-3-1-实现流程"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-3-1-实现流程"}},[s._v("#")]),s._v(" 13.3.1 实现流程")]),s._v(" "),n("ul",[n("li",[s._v("PVC绑定PV")]),s._v(" "),n("li",[s._v("定义PVC")]),s._v(" "),n("li",[s._v("定义PV【数据卷定义，指定数据存储服务器的ip、路径、容量和匹配模式】")])]),s._v(" "),n("h3",{attrs:{id:"_13-3-2-举例"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-3-2-举例"}},[s._v("#")]),s._v(" 13.3.2 举例")]),s._v(" "),n("ul",[n("li",[n("p",[s._v("创建一个 pvc.yaml\n"),n("img",{attrs:{src:t(1141),alt:"image-20201119101753419"}})])]),s._v(" "),n("li",[n("p",[s._v("第一部分是定义一个 deployment，做一个部署")])]),s._v(" "),n("li",[n("p",[s._v("副本数：3")])]),s._v(" "),n("li",[n("p",[s._v("挂载路径")])]),s._v(" "),n("li",[n("p",[s._v("调用：是通过pvc的模式")])]),s._v(" "),n("li",[n("p",[s._v("然后定义pvc")])])]),s._v(" "),n("p",[n("img",{attrs:{src:t(1142),alt:"image-20201119101843498"}})]),s._v(" "),n("ul",[n("li",[s._v("完整pvc.yaml文件")])]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("dep1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nginx\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wwwroot\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /usr/share/nginx/html\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("ports")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containerPort")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" wwwroot\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("persistentVolumeClaim")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("claimName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pvc\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("---")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolumeClaim\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pvc\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteMany  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#访问类型也和pv对应，不然绑定失败")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("requests")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5Gi "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#请求大小，必须小于 pv")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("hr"),s._v(" "),n("ul",[n("li",[s._v("然后在创建一个 "),n("code",[s._v("pv.yaml")])])]),s._v(" "),n("p",[n("img",{attrs:{src:t(1143),alt:"image-20201119101957777"}})]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PersistentVolume\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" my"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pv\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("capacity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("storage")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 5Gi\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("accessModes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" ReadWriteMany\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nfs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /data/nfs\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.222.6\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("ul",[n("li",[s._v("然后就可以创建pod了")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 pv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl delete  -f nfs-nginx.yaml")]),s._v("\ndeployment.apps "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"nginx-dep1"')]),s._v(" deleted\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 pv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f pvc.yaml")]),s._v("\ndeployment.apps/nginx-dep1 created\npersistentvolumeclaim/my-pvc created\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@master1 pv"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl apply -f pv.yaml")]),s._v("\npersistentvolume/my-pv created\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("然后我们就可以通过下面命令，查看我们的 pv  和 pvc之间的绑定关系")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl get pv, pvc\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("img",{attrs:{src:t(1144),alt:"image-20201119102332786"}})]),s._v(" "),n("p",[s._v("到这里为止，我们就完成了我们 pv 和 pvc的绑定操作，通过之前的方式，进入pod中查看内容")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubect "),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it nginx-dep1 "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("然后查看  /usr/share/nginx.html")]),s._v(" "),n("p",[n("img",{attrs:{src:t(1145),alt:"image-20201119102448226"}})]),s._v(" "),n("p",[s._v("也同样能看到刚刚的内容，其实这种操作和之前我们的nfs是一样的，只是多了一层pvc绑定pv的操作")]),s._v(" "),n("h2",{attrs:{id:"_13-4-安装部署问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-4-安装部署问题"}},[s._v("#")]),s._v(" 13.4 安装部署问题")]),s._v(" "),n("h3",{attrs:{id:"_13-4-1-在客户端尝试查询nfs服务器可挂载目录不通"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_13-4-1-在客户端尝试查询nfs服务器可挂载目录不通"}},[s._v("#")]),s._v(" 13.4.1 在客户端尝试查询NFS服务器可挂载目录不通")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# showmount -e 192.168.222.6")]),s._v("\nclnt_create: RPC: Port mapper failure - Unable to receive: errno "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("113")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("No route to "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# showmount -e 192.168.222.6")]),s._v("\nrpc "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mount")]),s._v(" export: RPC: Unable to receive"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" errno "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" No route to "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("host")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# showmount -e 192.168.222.6")]),s._v("\nExport list "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.6:\n/data/nfs *\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("ul",[n("li",[s._v("得到错误提示为")])]),s._v(" "),n("blockquote",[n("p",[s._v("clnt_create: RPC: Port mapper failure - Unable to receive: errno 113 (No route to host)")])]),s._v(" "),n("ul",[n("li",[s._v("寻思是服务器防火墙导致的使用")])]),s._v(" "),n("blockquote",[n("p",[s._v("firewall-cmd --get-service | grep -E (nfs|rpc)")])]),s._v(" "),n("ul",[n("li",[s._v("查询发现有相关服务nfs和rpc-bind 故在防火墙对服务予以放行")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("firewall-cmd --add-service"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nfs\nfirewall-cmd --add-service"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("rpc-bind\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ul",[n("li",[s._v("在客户端再次尝试showmount命令得到不一样的错误提示")])]),s._v(" "),n("blockquote",[n("p",[s._v("rpc mount export: RPC: Unable to receive; errno = No route to host")])]),s._v(" "),n("p",[s._v('网上搜了下关键字"RPC: Unable to receive firewalld"\n发现有文章描述NFS服务依赖服务有')]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("portmap\nnfsd\nmountd\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("再使用firewall-cmd --get-service查询到预设服务中有mountd\n在防火墙对其放行")]),s._v(" "),n("blockquote",[n("p",[s._v("firewall-cmd --add-service=mountd")])]),s._v(" "),n("h4",{attrs:{id:"或者直接关闭防火墙"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#或者直接关闭防火墙"}},[s._v("#")]),s._v(" 或者直接关闭防火墙")]),s._v(" "),n("div",{staticClass:"language- line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("systemctl stop firewalld\nsystemctl disable firewalld\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("————————————————————————————————————————————————————————————")])])}),[],!1,null,null,null);a.default=e.exports},348:function(s,a,t){s.exports=t.p+"assets/img/image-20201119082317625.c43fc74e.png"}}]);