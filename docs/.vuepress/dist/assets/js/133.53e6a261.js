(window.webpackJsonp=window.webpackJsonp||[]).push([[133],{1180:function(s,a,t){s.exports=t.p+"assets/img/image-20201123095552088.78b39227.png"},1181:function(s,a){s.exports="data:image/png;base64,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"},1182:function(s,a,t){s.exports=t.p+"assets/img/image-20201123104358758.a86378cd.png"},1604:function(s,a,t){"use strict";t.r(a);var n=t(26),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"kubernetes配置默认存储类"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#kubernetes配置默认存储类"}},[s._v("#")]),s._v(" Kubernetes配置默认存储类")]),s._v(" "),n("h2",{attrs:{id:"前言"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),n("p",[s._v("今天在配置Kubesphere的时候，出现了下面的错误")]),s._v(" "),n("p",[n("img",{attrs:{src:t(1180),alt:"image-20201123095552088"}})]),s._v(" "),n("p",[s._v("经过排查，发现是这个原因")]),s._v(" "),n("p",[n("img",{attrs:{src:t(1181),alt:"image-20201123095637801"}})]),s._v(" "),n("p",[s._v("我通过下面命令，查看Kubernetes集群中的默认存储类")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl get storageclass\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("发现空空如也，所以问题应该就出现在这里了~，下面我们给k8s集群安装上默认的存储类")]),s._v(" "),n("h2",{attrs:{id:"安装nfs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#安装nfs"}},[s._v("#")]),s._v(" 安装nfs")]),s._v(" "),n("p",[s._v("我们使用的是nfs来作为k8s的存储类")]),s._v(" "),n("p",[s._v("首先找一台新的服务器，作为nfs服务端，然后进行 nfs的安装 【服务器：192.168.177.141】")]),s._v(" "),n("p",[s._v("然后使用命令安装nfs")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y nfs-utils\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("首先创建存放数据的目录")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p /data/k8s\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("设置挂载路径")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 打开文件")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/exports\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加如下内容")]),s._v("\n/data/k8s *"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rw,no_root_squash"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("h2",{attrs:{id:"node节点上安装"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#node节点上安装"}},[s._v("#")]),s._v(" node节点上安装")]),s._v(" "),n("p",[s._v("然后需要在k8s集群node节点上安装nfs，这里需要在 node1 和 node2节点上安装")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("yum "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y nfs-utils\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("执行完成后，会自动帮我们挂载上")]),s._v(" "),n("h2",{attrs:{id:"启动nfs"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#启动nfs"}},[s._v("#")]),s._v(" 启动nfs")]),s._v(" "),n("p",[s._v("在node节点上配置完成后，我们就接着到刚刚nfs服务器，启动我们的nfs")]),s._v(" "),n("div",{staticClass:"language-bahs line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("systemctl start nfs\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h2",{attrs:{id:"配置storageclass"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置storageclass"}},[s._v("#")]),s._v(" 配置StorageClass")]),s._v(" "),n("p",[s._v("要使用StorageClass，我们就得安装对应的自动配置程序，比如上面我们使用的是nfs，那么我们就需要使用到一个 nfs-client 的自动配置程序，我们也叫它 Provisioner，这个程序使用我们已经配置的nfs服务器，来自动创建持久卷，也就是自动帮我们创建PV")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("自动创建的 PV 以"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${namespace}")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${pvcName}")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${pvName}")]),s._v("这样的命名格式创建在 NFS 服务器上的共享数据目录中\n而当这个 PV 被回收后会以archieved-"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${namespace}")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${pvcName}")]),s._v("-"),n("span",{pre:!0,attrs:{class:"token variable"}},[s._v("${pvName}")]),s._v("这样的命名格式存在 NFS 服务器上。\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("当然在部署nfs-client之前，我们需要先成功安装上 nfs 服务器，上面已经安装好了，服务地址是192.168.177.141，共享数据目录是/data/k8s/，然后接下来我们部署 nfs-client 即可，我们也可以直接参考 "),n("a",{attrs:{href:"https://github.com/kubernetes-incubator/external-storage/tree/master/nfs-client",target:"_blank",rel:"noopener noreferrer"}},[s._v("nfs-client 文档"),n("OutboundLink")],1),s._v("，进行安装即可。")]),s._v(" "),n("h3",{attrs:{id:"配置deployment"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#配置deployment"}},[s._v("#")]),s._v(" 配置Deployment")]),s._v(" "),n("p",[s._v("首先配置 Deployment，将里面的对应的参数替换成我们自己的 nfs 配置（nfs-client.yaml）")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Deployment\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" apps/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("replicas")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("selector")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("matchLabels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("strategy")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Recreate\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("template")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("labels")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("app")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spec")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("serviceAccountName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("containers")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("image")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" quay.io/external_storage/nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("provisioner"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("latest\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumeMounts")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("root\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("mountPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /persistentvolumes\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("env")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" PROVISIONER_NAME\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" fuseim.pri/ifs\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NFS_SERVER\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.177.141\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" NFS_PATH\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("value")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /data/k8s\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("volumes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("client"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("root\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("nfs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 192.168.177.141\n            "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("path")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" /data/k8s\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br")])]),n("h3",{attrs:{id:"替换配置"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#替换配置"}},[s._v("#")]),s._v(" 替换配置")]),s._v(" "),n("p",[s._v("将环境变量 NFS_SERVER 和 NFS_PATH 替换，当然也包括下面的 nfs 配置，我们可以看到我们这里使用了一个名为 nfs-client-provisioner 的serviceAccount，所以我们也需要创建一个 sa，然后绑定上对应的权限：（nfs-client-sa.yaml）")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("apiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: nfs-client-provisioner\n\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: nfs-client-provisioner-runner\nrules:\n  - apiGroups: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    resources: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"persistentvolumes"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    verbs: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"delete"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  - apiGroups: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    resources: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"persistentvolumeclaims"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    verbs: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"update"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  - apiGroups: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"storage.k8s.io"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    resources: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"storageclasses"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    verbs: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  - apiGroups: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    resources: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"events"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    verbs: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"update"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"patch"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  - apiGroups: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    resources: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"endpoints"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n    verbs: "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"create"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"delete"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"patch"')]),s._v(", "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"update"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: run-nfs-client-provisioner\nsubjects:\n  - kind: ServiceAccount\n    name: nfs-client-provisioner\n    namespace: default\nroleRef:\n  kind: ClusterRole\n  name: nfs-client-provisioner-runner\n  apiGroup: rbac.authorization.k8s.io\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br")])]),n("p",[s._v("我们这里新建的一个名为 nfs-client-provisioner 的ServiceAccount，然后绑定了一个名为 nfs-client-provisioner-runner 的ClusterRole，而该ClusterRole声明了一些权限，其中就包括对persistentvolumes的增、删、改、查等权限，所以我们可以利用该ServiceAccount来自动创建 PV。")]),s._v(" "),n("h3",{attrs:{id:"创建storageclass对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建storageclass对象"}},[s._v("#")]),s._v(" 创建StorageClass对象")]),s._v(" "),n("p",[s._v("nfs-client 的 Deployment 声明完成后，我们就可以来创建一个StorageClass对象了：（nfs-client-class.yaml）")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" storage.k8s.io/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StorageClass\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" course"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("storage\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("provisioner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" fuseim.pri/ifs "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or choose another name, must match deployment's env PROVISIONER_NAME'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("我们声明了一个名为 course-nfs-storage 的StorageClass对象，注意下面的provisioner对应的值一定要和上面的Deployment下面的 PROVISIONER_NAME 这个环境变量的值一样")]),s._v(" "),n("div",{staticClass:"language-yaml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yaml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" storage.k8s.io/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" StorageClass\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" course"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("nfs"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("storage\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("provisioner")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" fuseim.pri/ifs "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# or choose another name, must match deployment's env PROVISIONER_NAME'")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("h3",{attrs:{id:"创建资源对象"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#创建资源对象"}},[s._v("#")]),s._v(" 创建资源对象")]),s._v(" "),n("p",[s._v("在我们准备好上述的配置文件后，我们就可以开始创建我们的资源对象了")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl create -f nfs-client.yaml\nkubectl create -f nfs-client-sa.yaml\nkubectl create -f nfs-client-class.yaml\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("创建完成后，使用下面命令来查看资源状态")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl get pods\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看存储类")]),s._v("\nkubectl get storageclass\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[n("img",{attrs:{src:t(1182),alt:"image-20201123104358758"}})]),s._v(" "),n("p",[s._v("我们可以设置这个 course-nfs-storage 的 StorageClass 为 Kubernetes 的默认存储后端，我们可以用 kubectl patch 命令来更新")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl patch storageclass course-nfs-storage -p "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"metadata": {"annotations":{"storageclass.kubernetes.io/is-default-class":"true"}}}\'')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[s._v("执行完命令后，我们默认存储类就配置成功了~")])])}),[],!1,null,null,null);a.default=e.exports}}]);