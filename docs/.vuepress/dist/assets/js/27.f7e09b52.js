(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{1155:function(s,a,t){s.exports=t.p+"assets/img/image-20201118092356107.061545a9.png"},1156:function(s,a,t){s.exports=t.p+"assets/img/image-20201118093949893.80792b01.png"},1157:function(s,a){s.exports="data:image/png;base64,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"},1158:function(s,a,t){s.exports=t.p+"assets/img/image-20201118094851338.0c9aea3b.png"},1159:function(s,a,t){s.exports=t.p+"assets/img/image-20201118095141786.b29d3a13.png"},1160:function(s,a,t){s.exports=t.p+"assets/img/image-20201118095248052.2ae70505.png"},1161:function(s,a,t){s.exports=t.p+"assets/img/image-20201118095357067.2c0773f2.png"},1162:function(s,a,t){s.exports=t.p+"assets/img/image-20201118095541427.1818c8c0.png"},1163:function(s,a,t){s.exports=t.p+"assets/img/image-20201118095627954.daa72396.png"},1164:function(s,a,t){s.exports=t.p+"assets/img/image-20201118100051043.4ecfa612.png"},1584:function(s,a,t){"use strict";t.r(a);var n=t(26),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,n=s._self._c||a;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"_10-k8s集群安全机制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-k8s集群安全机制"}},[s._v("#")]),s._v(" 10. K8s集群安全机制")]),s._v(" "),n("h2",{attrs:{id:"_10-1-概述"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-概述"}},[s._v("#")]),s._v(" 10.1 概述")]),s._v(" "),n("p",[s._v("当我们访问K8S集群时，需要经过三个步骤完成具体操作")]),s._v(" "),n("ul",[n("li",[s._v("认证")]),s._v(" "),n("li",[s._v("鉴权【授权】")]),s._v(" "),n("li",[s._v("准入控制")])]),s._v(" "),n("p",[s._v("进行访问的时候，都需要经过 apiserver， apiserver做统一协调，比如门卫")]),s._v(" "),n("ul",[n("li",[s._v("访问过程中，需要证书、token、或者用户名和密码")]),s._v(" "),n("li",[s._v("如果访问pod需要serviceAccount")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(1155),alt:"image-20201118092356107"}})]),s._v(" "),n("h3",{attrs:{id:"_10-1-1认证"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-1认证"}},[s._v("#")]),s._v(" 10.1.1认证")]),s._v(" "),n("p",[s._v("对外不暴露8080端口，只能内部访问，对外使用的端口6443")]),s._v(" "),n("p",[s._v("客户端身份认证常用方式")]),s._v(" "),n("ul",[n("li",[s._v("https证书认证，基于ca证书")]),s._v(" "),n("li",[s._v("http token认证，通过token来识别用户")]),s._v(" "),n("li",[s._v("http基本认证，用户名 + 密码认证")])]),s._v(" "),n("h3",{attrs:{id:"_10-1-2-鉴权"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-2-鉴权"}},[s._v("#")]),s._v(" 10.1.2 鉴权")]),s._v(" "),n("p",[s._v("基于RBAC进行鉴权操作")]),s._v(" "),n("p",[s._v("基于角色访问控制")]),s._v(" "),n("h3",{attrs:{id:"_10-1-3-准入控制"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-1-3-准入控制"}},[s._v("#")]),s._v(" 10.1.3 准入控制")]),s._v(" "),n("p",[s._v("就是准入控制器的列表，如果列表有请求内容就通过，没有的话 就拒绝")]),s._v(" "),n("h2",{attrs:{id:"_10-2-rbac介绍"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-2-rbac介绍"}},[s._v("#")]),s._v(" 10.2 RBAC介绍")]),s._v(" "),n("p",[s._v("基于角色的访问控制，为某个角色设置访问内容，然后用户分配该角色后，就拥有该角色的访问权限")]),s._v(" "),n("p",[n("img",{attrs:{src:t(1156),alt:"image-20201118093949893"}})]),s._v(" "),n("p",[s._v("k8s中有默认的几个角色")]),s._v(" "),n("ul",[n("li",[s._v("role：特定命名空间访问权限")]),s._v(" "),n("li",[s._v("ClusterRole：所有命名空间的访问权限")])]),s._v(" "),n("p",[s._v("角色绑定")]),s._v(" "),n("ul",[n("li",[s._v("roleBinding：角色绑定到主体")]),s._v(" "),n("li",[s._v("ClusterRoleBinding：集群角色绑定到主体")])]),s._v(" "),n("p",[s._v("主体")]),s._v(" "),n("ul",[n("li",[s._v("user：用户")]),s._v(" "),n("li",[s._v("group：用户组")]),s._v(" "),n("li",[s._v("serviceAccount：服务账号")])]),s._v(" "),n("h2",{attrs:{id:"_10-3-rbac实现鉴权"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-rbac实现鉴权"}},[s._v("#")]),s._v(" 10.3 RBAC实现鉴权")]),s._v(" "),n("ul",[n("li",[s._v("创建命名空间")])]),s._v(" "),n("h3",{attrs:{id:"_10-3-1-创建命名空间"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-1-创建命名空间"}},[s._v("#")]),s._v(" 10.3.1 创建命名空间")]),s._v(" "),n("p",[s._v("我们可以首先查看已经存在的命名空间")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl get namespace\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("img",{attrs:{src:t(1157),alt:"image-20201118094516426"}})]),s._v(" "),n("p",[s._v("然后我们创建一个自己的命名空间  roledemo")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl create ns roledemo\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_10-3-2-命名空间创建pod"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-2-命名空间创建pod"}},[s._v("#")]),s._v(" 10.3.2 命名空间创建Pod")]),s._v(" "),n("p",[s._v("为什么要创建命名空间？因为如果不创建命名空间的话，默认是在default下")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("kubectl run nginx --image"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx -n roledemo\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("h3",{attrs:{id:"_10-3-3-创建角色"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-3-创建角色"}},[s._v("#")]),s._v(" 10.3.3 创建角色")]),s._v(" "),n("ul",[n("li",[s._v("我们通过 rbac-role.yaml进行创建")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(1158),alt:"image-20201118094851338"}})]),s._v(" "),n("hr"),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Role\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" roledemo\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("reader\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("rules")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroups")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('""')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v('# "" indicates the core API group')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("resources")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"pods"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("verbs")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"get"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"watch"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"list"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("font",{attrs:{color:"red"}},[s._v("注意：这个角色只对pod 有 get、list权限")])],1),s._v(" "),n("ul",[n("li",[s._v("然后通过 yaml创建我们的role")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建")]),s._v("\nkubectl apply -f rbac-role.yaml\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\nkubectl get role -n roledemo\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("img",{attrs:{src:t(1159),alt:"image-20201118095141786"}})]),s._v(" "),n("h3",{attrs:{id:"_10-3-4-创建角色绑定"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-4-创建角色绑定"}},[s._v("#")]),s._v(" 10.3.4 创建角色绑定")]),s._v(" "),n("ul",[n("li",[s._v("我们还是通过 role-rolebinding.yaml 的方式，来创建我们的角色绑定")])]),s._v(" "),n("p",[n("img",{attrs:{src:t(1160),alt:"image-20201118095248052"}})]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RoleBinding\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiVersion")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io/v1\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("metadata")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" read"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("pods\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("namespace")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" roledemo\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("subjects")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" User\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" lucy "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Name is case sensitive")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("roleRef")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" Role "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#this must be Role or ClusterRole")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pod"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("reader "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# this must match the name of the Role or ClusterRole you wish to bind to")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("apiGroup")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" rbac.authorization.k8s.io\n\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("ul",[n("li",[s._v("然后创建我们的角色绑定")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建角色绑定")]),s._v("\nkubectl apply -f role-rolebinding.yaml\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看角色绑定")]),s._v("\nkubectl get role, rolebinding -n roledemo\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8smaster ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get role,rolebinding -n roledemo")]),s._v("\nNAME                                        CREATED AT\nrole.rbac.authorization.k8s.io/pod-reader   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("-12-18T01:00:08Z\n\nNAME                                              ROLE              AGE\nrolebinding.rbac.authorization.k8s.io/read-pods   Role/pod-reader   52s\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[n("img",{attrs:{src:t(1161),alt:"image-20201118095357067"}})]),s._v(" "),n("h3",{attrs:{id:"_10-3-5-使用证书识别身份"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-5-使用证书识别身份"}},[s._v("#")]),s._v(" 10.3.5 使用证书识别身份")]),s._v(" "),n("ul",[n("li",[s._v("我们首先得有一个 rbac-user.sh 证书脚本")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" lucy-csr.json "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n{\n  "CN": "lucy",\n  "hosts": [],\n  "key": {\n    "algo": "rsa",\n    "size": 2048\n  },\n  "names": [\n    {\n      "C": "CN",\n      "L": "BeiJing",\n      "ST": "BeiJing"\n    }\n  ]\n}\nEOF')]),s._v("\n\ncfssl gencert -ca"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca.pem -ca-key"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca-key.pem -config"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca-config.json -profile"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes lucy-csr.json "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson -bare lucy\n\nkubectl config set-cluster kubernetes "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --certificate-authority"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("ca.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --embed-certs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --server"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://192.168.222.3:6443 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("lucy-kubeconfig\n\nkubectl config set-credentials lucy "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --client-key"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("lucy-key.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --client-certificate"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("lucy.pem "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --embed-certs"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("lucy-kubeconfig\n\nkubectl config set-context default "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --cluster"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("kubernetes "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --user"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("lucy "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n  --kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("lucy-kubeconfig\n\nkubectl config use-context default --kubeconfig"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("lucy-kubeconfig\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br")])]),n("p",[n("img",{attrs:{src:t(1162),alt:"image-20201118095541427"}})]),s._v(" "),n("p",[n("img",{attrs:{src:t(1163),alt:"image-20201118095627954"}})]),s._v(" "),n("ul",[n("li",[n("p",[s._v("这里包含了很多证书文件，在TSL目录下，需要复制过来")])]),s._v(" "),n("li",[n("p",[s._v("通过下面命令执行我们的脚本")])])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("./rbac-user.sh\n\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8smaster ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# sh ./rabc-user.sh ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/12/18 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":44:40 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" generate received request\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/12/18 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":44:40 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" received CSR\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/12/18 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":44:40 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" generating key: rsa-2048\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/12/18 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":44:40 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" encoded CSR\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/12/18 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":44:40 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("INFO"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" signed certificate with serial number "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("529125001104742287716320459724556362696326314889")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("/12/18 "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":44:40 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WARNING"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" This certificate lacks a "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"hosts"')]),s._v(" field. This makes it unsuitable "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v("\nwebsites. For "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" information see the Baseline Requirements "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" the Issuance and Management\nof Publicly-Trusted Certificates, v.1.1.6, from the CA/Browser Forum "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("https://cabforum.org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nspecifically, section "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.2")]),s._v(".3 "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Information Requirements"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".\nCluster "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),s._v(" set.\nUser "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lucy"')]),s._v(" set.\nContext "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),s._v(" modified.\nSwitched to context "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"default"')]),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br")])]),n("ul",[n("li",[s._v("最后我们进行测试")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用get命令查看 pod 【有权限】")]),s._v("\nkubectl get pods -n roledemo\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 用get命令查看svc 【没权限】")]),s._v("\nkubectl get svc -n roledmeo\n\n\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8smaster ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n roledemo")]),s._v("\nNAME    READY   STATUS    RESTARTS   AGE\nnginx   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          107m\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8smaster ~"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get svc -n roledemo")]),s._v("\nNo resources found "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" roledemo namespace.\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br")])]),n("p",[n("img",{attrs:{src:t(1164),alt:"image-20201118100051043"}})]),s._v(" "),n("h3",{attrs:{id:"_10-3-6-遇见的问题"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_10-3-6-遇见的问题"}},[s._v("#")]),s._v(" 10.3.6 遇见的问题")]),s._v(" "),n("div",{staticClass:"language-log line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v('[root@k8smaster ~]# ./rbac-user.sh\n-bash: ./rbac-user.sh: 没有那个文件或目录\n[root@k8smaster ~]# sh ./rabc-user.sh \n./rabc-user.sh:行19: cfssl: 未找到命令\n./rabc-user.sh:行19: cfssljson: 未找到命令\nerror: could not read certificate-authority data from ca.pem: open ca.pem: no such file or directory\nerror: error reading client-certificate data from lucy.pem: open lucy.pem: no such file or directory\nContext "default" created.\nSwitched to context "default".\n')])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("ul",[n("li",[s._v("安装cfssl证书生成工具\nwget https://pkg.cfssl.org/R1.2/cfssl_linux-amd64")])]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://pkg.cfssl.org/R1.2/cfssl_linux-amd64\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://pkg.cfssl.org/R1.2/cfssljson_linux-amd64\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" https://pkg.cfssl.org/R1.2/cfssl-certinfo_linux-amd64\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("chmod")]),s._v(" +x cfssl_linux-amd64 cfssljson_linux-amd64 cfssl-certinfo_linux-amd64\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" cfssl_linux-amd64 /usr/local/bin/cfssl\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" cfssljson_linux-amd64 /usr/local/bin/cfssljson\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("mv")]),s._v(" cfssl-certinfo_linux-amd64 /usr/bin/cfssl-certinfo\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])]),n("ul",[n("li",[s._v("生成ca证书和私钥")])]),s._v(" "),n("p",[n("strong",[s._v("lucy-csr.json")])]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"CN"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"lucy"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"hosts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"key"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"algo"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"rsa"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"size"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2048")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"names"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"C"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"CN"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"L"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"ST"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"BeiJing"')]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("cfssl gencert -initca lucy-csr.json "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" cfssljson -bare ca - \n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-log line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-text"}},[n("code",[s._v("-rw-r--r--  1 root root  177 12月 18 10:44 lucy-csr.json\n-rw-r--r--  1 root root 1294 12月 18 10:44 lucy.pem\n-rw-------  1 root root 1679 12月 18 10:44 lucy-key.pem\n-rw-r--r--  1 root root  952 12月 18 10:44 lucy.csr\n-rw-------  1 root root 5981 12月 18 10:44 lucy-kubeconfig\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[n("strong",[s._v("ca.csr ca.pem(ca公钥) ca-key.pem(ca私钥,妥善保管)")])])])}),[],!1,null,null,null);a.default=e.exports}}]);