(window.webpackJsonp=window.webpackJsonp||[]).push([[152],{1471:function(s,a,e){"use strict";e.r(a);var t=e(26),r=Object(t.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_1-redis基础知识"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-redis基础知识"}},[s._v("#")]),s._v(" 1. Redis基础知识")]),s._v(" "),t("h2",{attrs:{id:"_1-1-redis简介"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-redis简介"}},[s._v("#")]),s._v(" 1.1 Redis简介")]),s._v(" "),t("h3",{attrs:{id:"_1-1-1-redis特点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-1-redis特点"}},[s._v("#")]),s._v(" 1.1.1 Redis特点")]),s._v(" "),t("ol",[t("li",[s._v("Redis读取的速度是110000次/s，写的速度是81000次/s")]),s._v(" "),t("li",[s._v("原子 。Redis的所有操作都是原子性的，同时Redis还支持对"),t("strong",[s._v("几个操作全并后的原子性执行")]),s._v("。")]),s._v(" "),t("li",[s._v("支持多种数据结构：string（字符串）；list（列表）；hash（哈希），set（集合）；zset(有序集合)")]),s._v(" "),t("li",[s._v("持久化：发生断电或机器故障，数据可能会丢失，持久化到硬盘")]),s._v(" "),t("li",[s._v("主从复制（集群）：实现多个相同数据的 redis 副本")]),s._v(" "),t("li",[s._v("支持过期时间，支持事务，消息订阅。")]),s._v(" "),t("li",[s._v("高可用和分布式：哨兵机制实现高可用，保证 redis 节点故障发现和自动转移")])]),s._v(" "),t("h3",{attrs:{id:"_1-1-2-redis的应用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-2-redis的应用场景"}},[s._v("#")]),s._v(" 1.1.2 Redis的应用场景")]),s._v(" "),t("ol",[t("li",[t("p",[t("strong",[s._v("数据缓存（提高访问性能）")]),s._v(" \n将一些数据在短时间之内不会发生变化，而且它们还要被频繁访问，为了提高用户的请求速度和降低网站的负载，降低数据库的读写次数，就把这些数据放到缓存中。\n"),t("strong",[s._v("合理使用缓存加快数据访问速度，降低后端数据源压力")])])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("会话缓存")]),s._v("\n（session cache，保存web会话信息）")])]),s._v(" "),t("li",[t("p",[t("strong",[s._v("排行榜")]),s._v("\n（NGINX+lua+redis计数器进行IP自动封禁）\n：按照热度排名，按照发布时间排行，主要用到列表和有序集合")])]),s._v(" "),t("li",[t("p",[s._v("计数器\n视频网站播放数，网站浏览数，使用 redis 计数")])]),s._v(" "),t("li",[t("p",[s._v("消息队列：发布和订阅\n"),t("strong",[s._v("（构建实时消息系统，聊天，群聊）")])])])]),s._v(" "),t("h2",{attrs:{id:"_1-2-redis数据类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-redis数据类型"}},[s._v("#")]),s._v(" 1.2 Redis数据类型")]),s._v(" "),t("p",[s._v("使用Redis进行应用设计和开发的一个核心概念是数据类型。与关系数据库不同，在Redis中不存在需要我们担心的表，在使用Redis进行应用设计和开发时，我们首先应该考虑的是Redis原生支持的哪种数据类型阳适合我们的应该场景，此外，我们无法像在关系数据库中那样，使用sql来操作Redis中的数据，相反，我们需要直接使用API发送数据反对应的命令，来操作想要操作的数据")]),s._v(" "),t("h3",{attrs:{id:"_1-2-1-字符串类型map-string-string"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-1-字符串类型map-string-string"}},[s._v("#")]),s._v(" 1.2.1 字符串类型Map <String,String>")]),s._v(" "),t("p",[s._v("字符串类型是编程语言和应用程序中最常见和最有用的数据类型，也是Redis的基本数据类型之一，事实上，Redis中所有键都必须是字符串。")]),s._v(" "),t("h3",{attrs:{id:"_1-2-2-list数据类型map-string-list-object"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-2-list数据类型map-string-list-object"}},[s._v("#")]),s._v(" 1.2.2 list数据类型Map<String,List<Object>>")]),s._v(" "),t("p",[s._v("列表是应用我只是应该程序开发中非常有用的数据类型之一，列表能存在一组对象，因此它也可以被用于栈或者队列，在Redis中，与键相关的联的值可以是字符串组成的列表，Redis中的列表更像是数据结构中的双向链表。")]),s._v(" "),t("h3",{attrs:{id:"_1-2-3-hash数据类型map-string-map-object-object"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-3-hash数据类型map-string-map-object-object"}},[s._v("#")]),s._v(" 1.2.3 hash数据类型Map<String,Map<Object,Object>>")]),s._v(" "),t("p",[s._v("哈希表示字段和值之间的映射关系，与JAVA中的Map类似，Redis数据集本身就可以看做一个哈希，其中字符串类型的键关联到如字符串和列表之类的数据对象，而Reidis的数据对象也可以再次使用哈希，其字段和值必须 是字符串。")]),s._v(" "),t("h3",{attrs:{id:"_1-2-4-set数据类型map-string-set-object-object"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-4-set数据类型map-string-set-object-object"}},[s._v("#")]),s._v(" 1.2.4 set数据类型Map<String,Set<Object,Object>>")]),s._v(" "),t("p",[s._v("集合类型是由唯一，无序对象组成的集合(collection).它经常用于测试某个成员是集合中，重复项删除和集合运算（求并，交，差集），Redis的值对象可以是字符串集合。")]),s._v(" "),t("h3",{attrs:{id:"_1-2-5-zset-sortset-数据类型"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-5-zset-sortset-数据类型"}},[s._v("#")]),s._v(" 1.2.5 zset(sortset)数据类型")]),s._v(" "),t("p",[s._v("有序集合是一个类似于set但是更复杂的数据类型,单词sorted意为着这种集合中的每个元素都有一个可用于排序的权重，并且我们可以按顺序从集合中得到元素在某些需要一个保持数据有序的场景中，使用这种原生的序的特性是很方便的。")]),s._v(" "),t("h2",{attrs:{id:"_1-3-重要的指令使用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-重要的指令使用"}},[s._v("#")]),s._v(" 1.3 重要的指令使用")]),s._v(" "),t("h3",{attrs:{id:"_1-3-1-全局命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-1-全局命令"}},[s._v("#")]),s._v(" 1.3.1 全局命令")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("语法")]),s._v(" "),t("ol",[t("li",[s._v("**查看所有键：keys *** set school enjoy set hello world")]),s._v(" "),t("li",[t("strong",[s._v("键总数 dbsize")]),s._v(" //2 个键，如果存在大量键，线上禁止使用此指令")]),s._v(" "),t("li",[t("strong",[s._v("检查键是否存在：exists key")]),s._v(" //存在返回 1，不存在返回 0")]),s._v(" "),t("li",[t("strong",[s._v("删除键：del key")]),s._v(" //del hello school, 返回删除键个数，删除不存在键返回 0")]),s._v(" "),t("li",[t("strong",[s._v("键过期：expire key seconds")]),s._v(" //set name test expire name 10 //10 秒过期 "),t("strong",[s._v("ttl name 查看剩余的过期时间")])]),s._v(" "),t("li",[t("strong",[s._v("键的数据结构类型：type key")]),s._v(" //type hello //返回 string,键不存在返回 none")])])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("root@c2411dac6aa2:/data"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis-cli -h 127.0.0.1 -p 6379")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" keys *\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tqk"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" dbsize\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" exists tqk\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" tt mandao\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" exists tqk tt\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" name "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("test")]),s._v("\nOK\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" expire name "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" ttl name\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" ttl name\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" ttl name\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" ttl name\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" tt\nstring\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("h3",{attrs:{id:"_1-3-2-string类型相关命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-2-string类型相关命令"}},[s._v("#")]),s._v(" 1.3.2 string类型相关命令")]),s._v(" "),t("p",[s._v("字符串类型：实际上可以是字符串（包括 XML JSON），还有数字（整形 浮点 数），二进制（图片 音频 视频），最大不能超过 512MB")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("语法")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("set key value")]),s._v("  :set name cxx")]),s._v(" "),t("li",[t("strong",[s._v("get name")])]),s._v(" "),t("li",[s._v("getrange name 0 -1 字符串分段   0 -1是全部   0 -2  ==n-1 :截取字符串：set name helloworld ; getrange name 2 4//返回 llo")]),s._v(" "),t("li",[s._v("getset name new_cxx 设置值，返回旧值")]),s._v(" "),t("li",[t("strong",[s._v("mset key1 key2 批量设置")])]),s._v(" "),t("li",[t("strong",[s._v("mget key1 key2 批量获取")])]),s._v(" "),t("li",[t("strong",[s._v("setnx key value 不存在就插入")]),s._v("（not exists）不存在键 name 时，返回 1 设置成功；存在的话失败 0")]),s._v(" "),t("li",[s._v("setrange key index value 从index开始替换value")]),s._v(" "),t("li",[s._v("incr age 递增")]),s._v(" "),t("li",[s._v("incrby age 10 递增")]),s._v(" "),t("li",[s._v("decr age 递减")]),s._v(" "),t("li",[s._v("decrby age 10 递减")]),s._v(" "),t("li",[s._v("incrbyfloat 增减浮点数")]),s._v(" "),t("li",[s._v("append 追加指令：set name hello; append name world //追加后成 helloworld")]),s._v(" "),t("li",[s._v("strlen 字符串长度：set hello “世界”；strlen hello//结果 6，每个中文占 3 个字节")]),s._v(" "),t("li",[s._v("内部编码：int:8 字节长整理//set age 100; "),t("strong",[s._v("object encoding age")]),s._v(" //返回 int embstr:小于等于 39 字节串 set name bejin; object encodeing name//embstr raw:大于 39 字节的字符串 set a fsdfwerwerweffffffffffdfs//返回 raw")])])]),s._v(" "),t("h3",{attrs:{id:"_1-3-3-哈希-hash"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-3-哈希-hash"}},[s._v("#")]),s._v(" 1.3.3 哈希 hash")]),s._v(" "),t("p",[t("strong",[s._v("是一个 string 类型的 field 和 value 的映射表，hash 特适合用于存储对象。")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("语法命令")]),s._v(" "),t("ol",[t("li",[s._v("hset key field value 设值：hset user:1 name james //成功返回 1，失败返回 0")]),s._v(" "),t("li",[s._v("取值：hget user:1 name //返回 james")]),s._v(" "),t("li",[s._v("删值：hdel user:1 age //返回删除的个数")]),s._v(" "),t("li",[s._v("计算个数：hset user:1 name james; hset user:1 age 23;\nhlen user:1 //返回 2，user:1 有两个属性值")]),s._v(" "),t("li",[s._v("批量设值：hmset user:2 name james age 23 sex boy //返回 OK")]),s._v(" "),t("li",[s._v("批量取值：hmget user:2 name age sex //返回三行：james 23 boy")]),s._v(" "),t("li",[s._v("判断 field 是否存在：hexists user:2 name //若存在返回 1，不存在返回 0")]),s._v(" "),t("li",[s._v("获取所有 field: hkeys user:2 // 返回 name age sex 三个 field")]),s._v(" "),t("li",[s._v("获取 user:2 所有 value：hvals user:2 // 返回 james 23 boy")]),s._v(" "),t("li",[s._v("获取 user:2 所有 field 与 value：hgetall user:2 //name age sex james 23 boy 值")]),s._v(" "),t("li",[s._v("增加 1：hincrby user:2 age 1 //age+1 hincrbyfloat user:2 age 2 //浮点型加 2")])])]),s._v(" "),t("h3",{attrs:{id:"_1-3-4-列表-list"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-4-列表-list"}},[s._v("#")]),s._v(" 1.3.4 列表<list>")]),s._v(" "),t("p",[s._v("用来存储多个有序的字符串，一个列表最多可存 2 的 32 次方减 1 个元素\n因为有序，可以通过索引下标获取元素或某个范围内元素列表，列表元素可以重复")]),s._v(" "),t("h4",{attrs:{id:"_1-3-4-1-语法命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-4-1-语法命令"}},[s._v("#")]),s._v(" 1.3.4.1 语法命令")]),s._v(" "),t("p",[t("a",{attrs:{"data-fancybox":"",title:"list",href:"./image/redis02.jpg"}},[t("img",{attrs:{src:e(782),alt:"list"}})])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("添加命令：")]),s._v(" "),t("p",[s._v("rpush james c b a //从右向左插入 cba, 返回值 3\nlrange james 0 -1 //从左到右获取列表所有元素 返回 c b a\nlpush key c b a //从左向右插入 cba\nlinsert james before b teacher //在 b 之前插入 teacher, after 为之后，使 用 lrange james 0 -1 查看：c teacher b a")])]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("查找命令：")]),s._v(" "),t("p",[s._v("lrange key start end //索引下标特点：从左到右为 0 到 N-1\nlindex james -1 //返回最右末尾 a，-2 返回 b\nllen james //返回当前列表长度\nlpop james //把最左边的第一个元素 c 删除\nrpop james //把最右边的元素 a 删除\nlrem key count value//删除指定元素 如：lpush test b b b b b j x z //键 test 放入 z x j b b b b b\nlrange test 0 -1 //查询结果为 z x j b b b b b\nlrem test 4 b //从左右开始删除 b 的元素,删除 4 个， 若 lrem test 8 b, 删除 8 个 b, 但只有 5 个全部删除\nlrange test 0 -1 //删除后的结果为 b j x z lrem test 0 b //检索所有 b 全部删除 j x z lpush user b b b b b j x z //键 user 从左到右放入 z x j b b b b b ltrim user 1 3 //只保留从第 2 到第 4 的元素，其它全删\nlrange user 0 -1 //查询结果为 x j b, 其它已全被删掉\nlpush user01 z y x //键 user01 从左到右放入 x y z\nlset user01 2 java // 把第 3 个元素 z 替换成 java\nlrange user01 0 -1 //查询结果为 x y java")])]),s._v(" "),t("h4",{attrs:{id:"_1-3-4-2-应用场景设计-cachelisthashapplicationtest-用例"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-4-2-应用场景设计-cachelisthashapplicationtest-用例"}},[s._v("#")]),s._v(" 1.3.4.2 应用场景设计： cacheListHashApplicationTest 用例")]),s._v(" "),t("ol",[t("li",[s._v("每个用户有多个订单 key 为 order:1 order:2 order:3, 结合 hmset")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("hmset order:1 orderId "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" money "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("36.6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-01-01 \nhmset order:2 orderId "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" money "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38.6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-01-01 \nhmset order:3 orderId "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" money "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("39.6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v("-01-01 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("把订单信息的 key 放到队列")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("lpush user:1:order order:1 order:2 order:3 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("每新产生一个订单，\nhmset order:4 orderId 4 money 40.6 time 2018-01-01\n追加一个 order:4 放入队列第一个位置\nlpush user:1:order order:4")]),s._v(" "),t("li",[s._v("当需要查询用户订单记录时：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("lrange user:1:order 0 -1\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("div",{staticClass:"language-java line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-java"}},[t("code",[t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("List")]),s._v(" orderKeys "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" lrange user"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v("order "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//查询 user:1 的所有订单 key 值 ")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Order")]),s._v(" order"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" orderKeys"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n    hmget order"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" orderId monkey time \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h3",{attrs:{id:"_1-3-5-集合-set"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-5-集合-set"}},[s._v("#")]),s._v(" 1.3.5 集合<SET>")]),s._v(" "),t("p",[t("strong",[s._v("用户标签，社交，查询有共同兴趣爱好的人")])]),s._v(" "),t("h4",{attrs:{id:"_1-3-5-1-命令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-5-1-命令"}},[s._v("#")]),s._v(" 1.3.5.1 命令")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("命令：")]),s._v(" "),t("ol",[t("li",[s._v("exists user //检查 user 键值是否存在")]),s._v(" "),t("li",[s._v("sadd user a b c//向 user 插入 3 个元素，返回 3")]),s._v(" "),t("li",[s._v("sadd user a b //若再加入相同的元素，则重复无效，返回 0")]),s._v(" "),t("li",[s._v("smembers user //获取 user 的所有元素,返回结果无序")]),s._v(" "),t("li",[s._v("srem user a //返回 1，删除 a 元素")]),s._v(" "),t("li",[s._v("scard user //返回 2，计算元素个数")]),s._v(" "),t("li",[s._v("sismember user a //判断元素是否在集合存在，存在返回 1，不存在 0")]),s._v(" "),t("li",[s._v("srandmember user 2 //随机返回 2 个元素，2 为元素个数")]),s._v(" "),t("li",[s._v("spop user 2 //随机返回 2 个元素 a b,并将 a b 从集合中删除")]),s._v(" "),t("li",[s._v("smembers user //此时已没有 a b, 只有 c")])]),s._v(" "),t("p",[s._v("集合的交集：")]),s._v(" "),t("ol",[t("li",[s._v("sadd user:1 zhangsan 24 girl")]),s._v(" "),t("li",[s._v("sadd user:2 james 24 boy//初始化两个集合")]),s._v(" "),t("li",[s._v("sinter user:1 user:2 //求两集合交集， 此时返回 24")]),s._v(" "),t("li",[s._v("sadd user:3 wang 24 girl //新增第三个元素")]),s._v(" "),t("li",[s._v("sinter user:1 user:2 user:3 //求三个集合的交集，此时返回 24")])]),s._v(" "),t("p",[s._v("集合的并集（集合合并去重）：")]),s._v(" "),t("ol",[t("li",[s._v("sunion user:1 user:2 user:3 //三集合合并(并集)，去重 24")]),s._v(" "),t("li",[s._v("sdiff user:1 user:2//1 和 2 差集,(zhangsan 24 girl)-(james 24 boy)=zhangsan girl 将交集(jj)、并集(bj)、差集(cj)的结果保存：")]),s._v(" "),t("li",[s._v("sinterstore user_jj user:1 user:2 //将 user:1 user:2 的交集保存到")]),s._v(" "),t("li",[s._v("user_jj sunionstore user_bj user:1 user:2 //将 user:1 user:2 的(并)合集保存")]),s._v(" "),t("li",[s._v("user_bj sdiffstore user_cj user:1 user:2 //将 user:1-user:2 的差集保存")]),s._v(" "),t("li",[s._v("user_cj smemebers user_cj // 返回 zhangsan girl")])])]),s._v(" "),t("h4",{attrs:{id:"_1-3-5-2-使用场景"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-5-2-使用场景"}},[s._v("#")]),s._v(" 1.3.5.2 使用场景：")]),s._v(" "),t("p",[t("strong",[s._v("标签，社交，查询有共同兴趣爱好的人,智能推荐")])]),s._v(" "),t("ol",[t("li",[s._v("使用方式： 给用户添加标签：")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("sadd user:1:fav basball fball pq \nsadd user:2:fav basball fball\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("计算出共同感兴趣的人：")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("sinter user:1:fav user:2:fav\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("新增用户加标签")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("sadd user:3:fav basball fball pq \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("hr"),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" sadd user:1:fav basball fball pq \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" sadd user:2:fav basball fball\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" sinter user:1:fav user:2:fav\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"fball"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"basball"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" sadd user:3:fav basball\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("integer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:637"),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("9")]),s._v(">")]),s._v(" sinter user:1:fav user:2:fav user:3:fav\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"basball"')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"_1-3-6-有序集合"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-6-有序集合"}},[s._v("#")]),s._v(" 1.3.6 有序集合:")]),s._v(" "),t("p",[t("strong",[s._v("常用于排行榜，如视频网站需要对用户上传视频做排行榜，或点赞数")]),s._v("\n与集合有联系，不能有重复的成员")]),s._v(" "),t("h4",{attrs:{id:"_1-3-6-1-命令语法"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-6-1-命令语法"}},[s._v("#")]),s._v(" 1.3.6.1 命令语法")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("命令语法")]),s._v(" "),t("ol",[t("li",[t("strong",[s._v("zadd key score member [score member......]")]),t("br"),s._v("\nzadd user:zan 200 james //james 的点赞数 1, 返回操作成功的条数 1"),t("br"),s._v("\nzadd user:zan 200 james 120 mike 100 lee// 返回 3")])]),s._v(" "),t("p",[s._v("zadd test:1 nx 100 james //键 test:1 必须不存在，主用于添加")]),s._v(" "),t("p",[s._v("zadd test:1 xx incr 200 james //键 test:1 必须存在，主用于修改,此时为 300")]),s._v(" "),t("p",[s._v("zadd test:1 xx ch incr -299 james //返回操作结果 1，300-299=1")]),s._v(" "),t("p",[s._v("zrange test:1 0 -1 withscores //查看点赞（分数）与成员名")]),s._v(" "),t("p",[s._v("zcard test:1 //计算成员个数， 返回 1")])]),s._v(" "),t("h4",{attrs:{id:"查点赞数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#查点赞数"}},[s._v("#")]),s._v(" 查点赞数")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("zadd test:2 nx 100 james //新增一个集合 \nzscore test:2 james //查看 james 的点赞数（分数），返回 100\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"排名"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#排名"}},[s._v("#")]),s._v(" 排名：")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("zadd user:3 200 james 120 mike 100 lee//先插入数据 \nzrange user:3 0 -1 withscores //查看分数与成员\n\n\nzrank user:3 james //返回名次：第 3 名返回 2，从 0 开始到 2，共 3 名 \nzrevrank user:3 james //返回 0， 反排序，点赞数越高，排名越前\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h4",{attrs:{id:"删除成员"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除成员"}},[s._v("#")]),s._v(" 删除成员")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("zrem user:3 jame mike //返回成功删除 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" 个成员，还剩 lee\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h4",{attrs:{id:"增加分数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#增加分数"}},[s._v("#")]),s._v(" 增加分数：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("zincrby user:3 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" lee //成员 lee 的分数加 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" \nzadd user:3 xx incr "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" lee //和上面效果一样\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"返回指定排名范围的分数与成员"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#返回指定排名范围的分数与成员"}},[s._v("#")]),s._v(" 返回指定排名范围的分数与成员")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("zadd user:4 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" james "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v(" mike "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" lee//先插入数据 \nzrange user:4 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" -1 withscores //返回结果如下图\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"返回指定分数范围的成员"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#返回指定分数范围的成员"}},[s._v("#")]),s._v(" 返回指定分数范围的成员")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("zrangebyscore user:4 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" withscores //返回 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v(" lee ,200 James, 由低到高 \nzrevrangebyscore user:4 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v(" withscores //返回 200james 120lee,由高到低 \n\nzrangebyscore user:4 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v(" +inf withscores//110 到无限大，120mike 200james \nzrevrangebyscore user:4 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v(" -inf withscores//无限小到 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v("，返回 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" lee \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h4",{attrs:{id:"返回指定分数范围的成员个数"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#返回指定分数范围的成员个数"}},[s._v("#")]),s._v(" 返回指定分数范围的成员个数：")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("zcount user:4 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" //返回 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("，由 mike120 和 james200 两条数据 删除指定排名内的升序元素： \nzremrangebyrank user:4 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" //分数升序排列，删除第 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" 个与第 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" 个，只剩 james \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h4",{attrs:{id:"删除指定分数范围的成员"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#删除指定分数范围的成员"}},[s._v("#")]),s._v(" 删除指定分数范围的成员")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("zadd user:5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v(" james "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("120")]),s._v(" mike "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" lee//先插入测试数据 \nzremrangebyscore user:5 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" //删除分数在 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" 与 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("300")]),s._v(" 范围的成员 \nzremrangebyscore user:5 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),s._v(" +inf //删除分数大于 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("不包括 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("100")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(",还剩 lee\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h4",{attrs:{id:"使用场景-排行榜系统-如视频网站需要对用户上传的视频做排行榜"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用场景-排行榜系统-如视频网站需要对用户上传的视频做排行榜"}},[s._v("#")]),s._v(" 使用场景： 排行榜系统，如视频网站需要对用户上传的视频做排行榜")]),s._v(" "),t("ol",[t("li",[s._v("点赞数：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("zadd user:1:20180106 3 mike //mike 获得 3 个赞\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"2"}},[t("li",[s._v("再获一赞：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("zincrby user:1:20180106 1 mike //在 3 的基础上加 1 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("用户作弊，将用户从排行榜删掉：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("zrem user:1:20180106 mike \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("展示赞数最多的 5 个用户：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("zadd user:4:20160101 9 jack 10 jj 11 dd 3 james 4 lee 6 mark 7 kate \nzrevrangebylex user:4:20160101 + - limit 0 5 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("查看用户赞数与排名：")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("zscore user:1:20180106 mike   \nzrank user:1:20180106 mike\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h2",{attrs:{id:"_1-5-redis-持久化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-redis-持久化"}},[s._v("#")]),s._v(" 1.5 Redis 持久化")]),s._v(" "),t("p",[s._v("redis 支持 RDB 和 AOF 两种持久化机制，持久化可以避免因进程退出而造成数据丢失；")]),s._v(" "),t("h3",{attrs:{id:"_1-5-1-rdb-持久化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-1-rdb-持久化"}},[s._v("#")]),s._v(" 1.5.1 RDB 持久化")]),s._v(" "),t("p",[s._v("RDB 持久化把当前进程数据生成快照（.rdb）文件保存到硬盘的过程，有手动触发 和自动触发手动触发有 save 和 bgsave 两命令")]),s._v(" "),t("p",[s._v("save 命令：阻塞当前 Redis，直到 RDB 持久化过程完成为止，若内存实例比较大会造成长时间阻塞，"),t("strong",[s._v("线上环境不建议用它")]),s._v("\nbgsave 命令：redis 进程执行 fork 操作创建子线程，由子线程完成持久化，阻塞时间很短（微秒级），是 save 的优化,")]),s._v(" "),t("p",[s._v("在执行 redis-cli shutdown 关闭 redis 服务时，如果没有开启 AOF 持久化，自动执行 bgsave; 显然 bgsave 是对 save 的优化。")]),s._v(" "),t("p",[t("a",{attrs:{"data-fancybox":"",title:"bgsave",href:"./image/bgsave.jpg"}},[t("img",{attrs:{src:e(783),alt:"bgsave"}})])]),s._v(" "),t("h3",{attrs:{id:"_1-5-2-aof-持久化"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-2-aof-持久化"}},[s._v("#")]),s._v(" 1.5.2 AOF 持久化")]),s._v(" "),t("p",[s._v("具体学习见云笔记 "),t("strong",[s._v("Redis学习文档")])])])}),[],!1,null,null,null);a.default=r.exports},782:function(s,a,e){s.exports=e.p+"assets/img/redis02.f28848c8.jpg"},783:function(s,a,e){s.exports=e.p+"assets/img/bgsave.2024e5c4.jpg"}}]);