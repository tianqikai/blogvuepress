(window.webpackJsonp=window.webpackJsonp||[]).push([[93],{1449:function(s,a,t){"use strict";t.r(a);var r=t(26),e=Object(r.a)({},(function(){var s=this,a=s.$createElement,r=s._self._c||a;return r("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[r("h1",{attrs:{id:"_2-mysql搭建主从集群"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-mysql搭建主从集群"}},[s._v("#")]),s._v(" 2. Mysql搭建主从集群")]),s._v(" "),r("h2",{attrs:{id:"_2-1-配置master主服务器"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-配置master主服务器"}},[s._v("#")]),s._v(" 2.1 配置master主服务器")]),s._v(" "),r("h3",{attrs:{id:"_2-1-1-启动master数据库"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1-启动master数据库"}},[s._v("#")]),s._v(" 2.1.1 启动Master数据库")]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[s._v("docker run --name mysql3310 -p "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3310")]),s._v(":3306 --privileged"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -ti -e "),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("12345")]),s._v("@tqk -e "),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_DATABASE")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("enjoy -e "),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_USER")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("user -e "),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_PASSWORD")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pass -v /home/mysql/docker-data/3310/conf:/etc/mysql/conf.d -v /home/mysql/docker-data/3310/data/:/var/lib/mysql -v /home/mysql/docker-data/3310/logs/:/var/log/mysql -d mysql:5.7\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h3",{attrs:{id:"_2-1-2-修改my-cnf"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-修改my-cnf"}},[s._v("#")]),s._v(" 2.1.2 修改my.cnf")]),s._v(" "),r("p",[s._v("首先，配置主节点的mysql配置文件： vi /home/mysql/docker-data/3310/conf/my.cnf")]),s._v(" "),r("p",[s._v("这一步需要对master进行配置，主要是需要"),r("strong",[s._v("打开binlog日志，以及指定severId")])]),s._v(" "),r("p",[s._v("我们打开MySQL主服务的my.cnf文件，在文件中一行server-id以及一个关闭域名解析的配置。")]),s._v(" "),r("p",[s._v("然后"),r("strong",[s._v("重启服务")])]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[s._v("server-id"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3310")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启复制功能")]),s._v("\nlog-bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql-bin\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自增长字段每次递增的量，其默认值是 1")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("auto_increment_increment")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自增长字段从那个数开始")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("auto_increment_offset")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 忽略大小写")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("lower_case_table_names")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#binlog-do-db=mstest      //要同步的mstest数据库,要同步多个数据库")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#binlog-ignore-db=mysql  //要忽略的数据库")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("p",[s._v("::: tip配置说明：")]),s._v(" "),r("ol",[r("li",[r("p",[r("strong",[s._v("server-id")]),s._v("：服务节点的唯一标识。需要给集群中的每个服务分配一个单独的ID。")])]),s._v(" "),r("li",[r("p",[r("strong",[s._v("log_bin")]),s._v("：打开Binlog日志记录，并指定文件名。")])]),s._v(" "),r("li",[r("p",[r("strong",[s._v("log_bin-index")]),s._v("：Binlog日志文件\n:::")])])]),s._v(" "),r("h3",{attrs:{id:"_2-1-3-重启mysql服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-重启mysql服务"}},[s._v("#")]),s._v(" 2.1.3 重启MySQL服务")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以直接重启docker")]),s._v("\n docker restart mysql3310\n "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#service mysqld restart")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("h3",{attrs:{id:"_2-1-3-分配replication-slave的权限。"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-3-分配replication-slave的权限。"}},[s._v("#")]),s._v(" 2.1.3 分配replication slave的权限。")]),s._v(" "),r("p",[r("strong",[s._v("在实际生产环境中，通常不会直接使用root用户，而会创建一个拥有全部权限的用户来负责主从同步")])]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#登录主数据库 ，创建 repluser用户")]),s._v("\nmysql -u root -p \nGRANT REPLICATION SLAVE,FILE,REPLICATION CLIENT ON *.* TO "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repluser'")]),s._v("@"),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" IDENTIFIED BY "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'12345@tqk'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 刷新配置")]),s._v("\nFLUSH PRIVILEGES"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br")])]),r("hr"),s._v(" "),r("h3",{attrs:{id:"_2-1-4-重启mysql服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-重启mysql服务"}},[s._v("#")]),s._v(" 2.1.4 重启MySQL服务")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 可以直接重启docker")]),s._v("\n docker restart mysql3310\n "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#service mysqld restart")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br")])]),r("p",[s._v("这个指令结果中的File和Position记录的是当前日志的binlog文件以及文件中的索引。")]),s._v(" "),r("p",[s._v("而后面的Binlog_Do_DB和Binlog_Ignore_DB这两个字段是表示需要记录binlog\n文件的库以及不需要记录binlog文件的库。目前我们没有进行配置，就表示是针对\n全库记录日志。这两个字段如何进行配置，会在后面进行介绍。")]),s._v(" "),r("h4",{attrs:{id:"在master上查看master的二进制日志"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#在master上查看master的二进制日志"}},[s._v("#")]),s._v(" 在master上查看master的二进制日志")]),s._v(" "),r("div",{staticClass:"language-sql line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v("  master "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v("  master "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------+----------+--------------+------------------+-------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("File")]),s._v("             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Position "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Binlog_Do_DB "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Binlog_Ignore_DB "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Executed_Gtid_Set "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------+----------+--------------+------------------+-------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("bin"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("000001")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("154")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("------------------+----------+--------------+------------------+-------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("row")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看进程信息")]),s._v("\n\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" PROCESSLIST"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+------+---------------------+------+-------------+------+---------------------------------------------------------------+------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("User")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Host                "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" db   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Command     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Time")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" State                                                         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Info             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+------+---------------------+------+-------------+------+---------------------------------------------------------------+------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" localhost           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Sleep       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4664")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                                                               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("49.232")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".21")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v(".151")]),s._v(":"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("48028")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Binlog "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Dump")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4686")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Master has sent "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("all")]),s._v(" binlog "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" slave"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" waiting "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" more updates "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v("             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" localhost           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("NULL")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Query       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("starting")]),s._v("                                                      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("SHOW")]),s._v(" PROCESSLIST "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("----+------+---------------------+------+-------------+------+---------------------------------------------------------------+------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br")])]),r("hr"),s._v(" "),r("p",[s._v("开启binlog后，数据库中的所有操作都会被记录到datadir当中，以一组轮询文件的方式循环记录。而指令查到的File和Position就是当前日志的文件和位置。而在后面配置从服务时，就需要通过这个"),r("strong",[s._v("File和Position")]),s._v("通知从服务从哪个地方开始记录binLog。")]),s._v(" "),r("h2",{attrs:{id:"_2-2-配置slave从服务"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-配置slave从服务"}},[s._v("#")]),s._v(" 2.2  配置slave从服务")]),s._v(" "),r("h3",{attrs:{id:"_2-2-1-启动slave数据库"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-启动slave数据库"}},[s._v("#")]),s._v(" 2.2.1 启动slave数据库")]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[s._v("docker run --name mysql3311 -p "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3311")]),s._v(":3306 --privileged"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true -ti -e "),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("12345")]),s._v("@tqk -e "),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_DATABASE")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("enjoy -e "),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_USER")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("user -e "),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_PASSWORD")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("pass -v /home/mysql/docker-data/3311/conf:/etc/mysql/conf.d -v /home/mysql/docker-data/3311/data/:/var/lib/mysql -v /home/mysql/docker-data/3311/logs/:/var/log/mysql -d mysql:5.7\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h3",{attrs:{id:"_2-2-2-修改my-cnf"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-修改my-cnf"}},[s._v("#")]),s._v(" 2.2.2 修改my.cnf")]),s._v(" "),r("p",[s._v("首先，配置主节点的mysql配置文件： vi /home/mysql/docker-data/3311/conf/my.cnf")]),s._v(" "),r("p",[s._v("这一步需要对master进行配置，主要是需要"),r("strong",[s._v("打开binlog日志，以及指定severId")])]),s._v(" "),r("p",[s._v("我们打开MySQL主服务的my.cnf文件，在文件中一行server-id以及一个关闭域名解析的配置。")]),s._v(" "),r("p",[s._v("然后"),r("strong",[s._v("重启服务")])]),s._v(" "),r("div",{staticClass:"language-shell line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-shell"}},[r("code",[s._v("server-id"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3311")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#开启复制功能")]),s._v("\nlog-bin"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("mysql-bin\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自增长字段每次递增的量，其默认值是 1")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("auto_increment_increment")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 自增长字段从那个数开始")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("auto_increment_offset")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 忽略大小写")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("lower_case_table_names")]),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#binlog-do-db=mstest      //要同步的mstest数据库,要同步多个数据库")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#binlog-ignore-db=mysql  //要忽略的数据库")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("h3",{attrs:{id:"_2-2-3-slave中设置master的信息"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-slave中设置master的信息"}},[s._v("#")]),s._v(" 2.2.3 slave中设置master的信息")]),s._v(" "),r("div",{staticClass:"language-sql line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[s._v("root"),r("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@9814176ed025")]),s._v(":"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("/")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# mysql -uroot -p12345@tqk")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--切换到mysql")]),s._v("\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("use")]),s._v(" mysql"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nReading "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" information "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" completion "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("of")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("and")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("column")]),s._v(" names\nYou can turn "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("off")]),s._v(" this feature "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" get a quicker startup "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("A\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Database")]),s._v(" changed\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--change master to master_host='49.232.21.151',master_port=3310,master_user='repluser',master_password='12345@tqk',master_log_file='mysql-bin.000001',master_log_pos=154;")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--如果不生效，查看master_log_pos位置是否正确")]),s._v("\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" change master "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("to")]),s._v(" master_host"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'49.232.21.151'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_port"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("3310")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_user"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'repluser'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_password"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'12345@tqk'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_file"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'mysql-bin.000001'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("master_log_pos"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("154")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("warnings")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.05")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br")])]),r("h3",{attrs:{id:"_2-2-4-开启slave-启动sql和io线程"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-开启slave-启动sql和io线程"}},[s._v("#")]),s._v(" 2.2.4 开启slave，启动SQL和IO线程")]),s._v(" "),r("div",{staticClass:"language-sql line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("h3",{attrs:{id:"_2-1-4-查看slave的状态"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-4-查看slave的状态"}},[s._v("#")]),s._v(" 2.1.4 查看slave的状态")]),s._v(" "),r("div",{staticClass:"language-sql line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" slave "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v("\\G\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br")])]),r("p",[r("a",{attrs:{"data-fancybox":"",title:"mysql",href:"./image/mysql37.jpg"}},[r("img",{attrs:{src:t(766),alt:"mysql"}})])]),s._v(" "),r("h3",{attrs:{id:"_2-2-5-查看进程信息"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-5-查看进程信息"}},[s._v("#")]),s._v(" 2.2.5 查看进程信息")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[s._v("SHOW PROCESSLIST"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" SHOW PROCESSLIST"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n+----+-------------+----------------------+------------+---------+------+--------------------------------------------------------+------------------+\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Id "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" User        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Host                 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" db         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Command "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Time "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" State                                                  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Info             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----+-------------+----------------------+------------+---------+------+--------------------------------------------------------+------------------+\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("113.124")]),s._v(".224.79:30264 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Sleep   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("5672")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                                                        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" localhost            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Sleep   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4453")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                                                        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" system user "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Connect "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4456")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Waiting "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" master to send event                       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" system user "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Connect "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4434")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Slave has "),r("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("read")]),s._v(" all relay log"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" waiting "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token function"}},[s._v("more")]),s._v(" updates "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("113.124")]),s._v(".224.79:31775 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" tqktest001 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Sleep   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4413")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                                                        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("113.124")]),s._v(".224.79:32377 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" tqktest001 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Sleep   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4413")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("                                                        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" root        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" localhost            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" NULL       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Query   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" starting                                               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" SHOW PROCESSLIST "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n+----+-------------+----------------------+------------+---------+------+--------------------------------------------------------+------------------+\n\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br")])]),r("p",[r("a",{attrs:{"data-fancybox":"",title:"mysql",href:"./image/mysql38.jpg"}},[r("img",{attrs:{src:t(767),alt:"mysql"}})])]),s._v(" "),r("h2",{attrs:{id:"_2-3-主从测试"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-主从测试"}},[s._v("#")]),s._v(" 2.3 主从测试")]),s._v(" "),r("div",{staticClass:"language-sql line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--主数据库创建tqktest001")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("create")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("database")]),s._v(" tqktest001"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("databases")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Database")]),s._v("           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" information_schema "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" enjoy              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" performance_schema "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" syncdemo           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sys                "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" tqktest            "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" tqktest001         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br")])]),r("h4",{attrs:{id:"从服务器查看"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#从服务器查看"}},[s._v("#")]),s._v(" 从服务器查看")]),s._v(" "),r("div",{staticClass:"language-sql line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[s._v("mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("databases")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Database")]),s._v("           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" information_schema "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" enjoy              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" mysql              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" performance_schema "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" syncdemo           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" sys                "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" tqktest001         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br")])]),r("h2",{attrs:{id:"_2-3-全库同步与部分同步"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-全库同步与部分同步"}},[s._v("#")]),s._v(" 2.3 全库同步与部分同步")]),s._v(" "),r("p",[s._v("之前提到，我们目前配置的主从同步是针对全库配置的，而实际环境中，一般并\n不需要针对全库做备份，而只需要对一些特别重要的库或者表来进行同步。那如何\n针对库和表做同步配置呢？")]),s._v(" "),r("p",[s._v("首先在"),r("strong",[s._v("Master端")]),s._v("：在my.cnf中，可以通过以下这些属性指定需要针对哪些库或者哪些表记录binlog")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#需要同步的二进制数据库名")]),s._v("\nbinlog-do-db"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tqk001\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#只保留7天的二进制日志，以防磁盘被日志占满(可选)")]),s._v("\nexpire-logs-days  "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#不备份的数据库")]),s._v("\nbinlog-ignore-db"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tqk002\nbinlog-ignore-db"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("tqk003\nbinlog-ignore-db"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("sys\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("p",[s._v("然后"),r("strong",[s._v("在Slave端")]),s._v("：在my.cnf中，需要配置备份库与主服务的库的对应关系。")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果salve库名称与master库名相同，使用本配置")]),s._v("\nreplicate-do-db "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" tqk001 \n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果master库名[mastdemo]与salve库名[mastdemo01]不同，使用以下配置[需要做映射]")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#replicate-rewrite-db = tqk001 -> tqk001history")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#如果不是要全部同步[默认全部同步]，则指定需要同步的表")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# replicate-wild-do-table=tqk001.user")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# replicate-wild-do-table=tqk001.order")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br")])]),r("p",[s._v("配置完成了之后重启，在show master status指令中，就可以看到Binlog_Do_DB和Binlog_Ignore_DB两个参数的作用了")]),s._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code")]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"})]),r("h2",{attrs:{id:"_2-4-集群扩容"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-集群扩容"}},[s._v("#")]),s._v(" 2.4 集群扩容")]),s._v(" "),r("p",[s._v("我们现在已经搭建成功了一主一从的MySQL集群架构，那要扩展到一主多从的集群架构，其实就比较简单了，只需要增加一个binlog复制就行了。")]),s._v(" "),r("p",[s._v("​但是如果我们的集群是已经运行过一段时间，这时候如果要扩展新的从节点就有一个问题，之前的数据没办法从binlog来恢复了。这时候在扩展新的slave节点时，就需要增加一个数据复制的操作。")]),s._v(" "),r("p",[s._v("MySQL的数据备份恢复操作相对比较简单，可以通过SQL语句直接来完成。具体操作可以使用mysql的bin目录下的mysqldump工具")]),s._v(" "),r("div",{staticClass:"language-sql line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--1、进入mysql查看数据库")]),s._v("\nmysql "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uroot "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p123456"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("databases")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--2、备份相应数据库")]),s._v("\nmysqldump "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uroot "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p12345"),r("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@tqk")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--databases consult mall > back.sql")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--这里需要注意，如果是热备份，这里需要在dump数据之前进行锁表操作，避免dump数据的时候出现插入操作导致数据不一致的情况。")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--3、master锁表")]),s._v("\nflush "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("table")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("with")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("read")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("lock")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--4、slave导入数据")]),s._v("\nmysql "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("uroot "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v("p12345"),r("span",{pre:!0,attrs:{class:"token variable"}},[s._v("@tqk")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" back"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("sql")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--5、master解锁")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("unlock")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("tables")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br")])]),r("h3",{attrs:{id:"_2-4-1-新加一个从库"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-1-新加一个从库"}},[s._v("#")]),s._v(" 2.4.1 新加一个从库")]),s._v(" "),r("p",[r("strong",[s._v("重复 2.2 的步骤即可")])]),s._v(" "),r("h2",{attrs:{id:"_2-5-半同步复制"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-半同步复制"}},[s._v("#")]),s._v(" 2.5 半同步复制")]),s._v(" "),r("p",[s._v("到现在为止，我们已经可以搭建MySQL的主从集群，互主集群，但是我们这个集群有一个隐患，就是有可能会丢数据。这是为什么呢？这要从MySQL主从数据复制分析起。")]),s._v(" "),r("p",[s._v("​MySQL主从集群默认采用的是一种异步复制的机制。主服务在执行用户提交的事务后，写入binlog日志，然后就给客户端返回一个成功的响应了。而binlog会由一个dump线程异步发送给Slave从服务。")]),s._v(" "),r("p",[r("a",{attrs:{"data-fancybox":"",title:"mysql",href:"./image/mysql39.jpg"}},[r("img",{attrs:{src:t(768),alt:"mysql"}})])]),s._v(" "),r("p",[s._v("​由于这个发送binlog的过程是异步的。主服务在向客户端反馈执行结果时，是不知道binlog是否同步成功了的。这时候如果主服务宕机了，而从服务还没有备份到新执行的binlog，那就有可能会丢数据。")]),s._v(" "),r("p",[s._v("那怎么解决这个问题呢，这就要靠MySQL的半同步复制机制来保证数据安全")]),s._v(" "),r("p",[s._v("半同步复制机制是一种介于异步复制和全同步复制之前的机制。主库在执行完客户端提交的事务后，并不是立即返回客户端响应，而是等待至少一个从库接收并写到relay log中，才会返回给客户端。MySQL在等待确认时，默认会等10秒，"),r("strong",[s._v("如果超过10秒没有收到ack，就会降级成为异步复制")])]),s._v(" "),r("p",[r("a",{attrs:{"data-fancybox":"",title:"mysql",href:"./image/mysql40.jpg"}},[r("img",{attrs:{src:t(310),alt:"mysql"}})])]),s._v(" "),r("p",[s._v("这种半同步复制相比异步复制，能够有效的提高数据的安全性。但是这种安全性也不是绝对的，他只保证事务提交后的binlog至少传输到了一个从库，并且并不保证从库应用这个事务的binlog是成功的。另一方面，半同步复制机制也会造成一定程度的延迟，这个延迟时间最少是一个TCP/IP请求往返的时间。整个服务的性能是会有所下降的。而当从服务出现问题时，主服务需要等待的时间就会更长，要等到从服务的服务恢复或者请求超时才能给用户响应。")]),s._v(" "),r("h2",{attrs:{id:"_2-6-mysql主从半同步复制搭建"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-mysql主从半同步复制搭建"}},[s._v("#")]),s._v(" 2.6 Mysql主从半同步复制搭建")]),s._v(" "),r("h3",{attrs:{id:"_2-6-1-master安装semisync-master模块"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-1-master安装semisync-master模块"}},[s._v("#")]),s._v(" 2.6.1 Master安装semisync_master模块")]),s._v(" "),r("div",{staticClass:"language-sql line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 加载lib，所有主从节点都要配置")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 主库：install plugin rpl_semi_sync_master soname 'semisync_master.so';")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 从库：install plugin rpl_semi_sync_slave soname 'semisync_slave.so';         ")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 可以一起装。建议一起装，因为会有主从切换的情景。")]),s._v("\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" install plugin rpl_semi_sync_master "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("soname")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'semisync_master.so'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" variables "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rpl_semi%'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------------------+------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name                             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------------------+------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_master_enabled              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFF")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_master_timeout              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_master_trace_level          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_master_wait_for_slave_count "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_master_wait_no_slave        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_master_wait_point           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" AFTER_SYNC "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_slave_enabled               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFF")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_slave_trace_level           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------------------+------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- set global rpl_semi_sync_master_enabled = {0|1};   # 1：启用，0：禁止")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- set global rpl_semi_sync_master_timeout = 10000;       # 单位为ms")]),s._v("\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" rpl_semi_sync_master_enabled"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--再次查看 ")]),s._v("\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" variables "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rpl_semi%'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------------------+------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name                             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------------------+------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_master_enabled              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_master_timeout              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_master_trace_level          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_master_wait_for_slave_count "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_master_wait_no_slave        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_master_wait_point           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" AFTER_SYNC "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_slave_enabled               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFF")]),s._v("        "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_slave_trace_level           "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-------------------------------------------+------------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- 查看，确保所有节点都成功加载。")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("-- show plugins;")]),s._v("\n\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br"),r("span",{staticClass:"line-number"},[s._v("31")]),r("br"),r("span",{staticClass:"line-number"},[s._v("32")]),r("br"),r("span",{staticClass:"line-number"},[s._v("33")]),r("br"),r("span",{staticClass:"line-number"},[s._v("34")]),r("br"),r("span",{staticClass:"line-number"},[s._v("35")]),r("br"),r("span",{staticClass:"line-number"},[s._v("36")]),r("br"),r("span",{staticClass:"line-number"},[s._v("37")]),r("br"),r("span",{staticClass:"line-number"},[s._v("38")]),r("br"),r("span",{staticClass:"line-number"},[s._v("39")]),r("br"),r("span",{staticClass:"line-number"},[s._v("40")]),r("br"),r("span",{staticClass:"line-number"},[s._v("41")]),r("br"),r("span",{staticClass:"line-number"},[s._v("42")]),r("br"),r("span",{staticClass:"line-number"},[s._v("43")]),r("br"),r("span",{staticClass:"line-number"},[s._v("44")]),r("br"),r("span",{staticClass:"line-number"},[s._v("45")]),r("br"),r("span",{staticClass:"line-number"},[s._v("46")]),r("br"),r("span",{staticClass:"line-number"},[s._v("47")]),r("br")])]),r("ol",[r("li",[r("p",[s._v("第一行是通过扩展库来安装半同步复制模块，需要指定扩展库的文件名。")])]),s._v(" "),r("li",[r("p",[s._v("第二行查看系统全局参数，rpl_semi_sync_master_timeout就是半同步复制时等待应答的最长等待时间，默认是10秒，可以根据情况自行调整。")])])]),s._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[s._v("重要参数")]),s._v(" "),r("ol",[r("li",[r("strong",[s._v("rpl_semi_sync_master_enabled")]),s._v("   （主库）是否启动半同步")]),s._v(" "),r("li",[r("strong",[s._v("rpl_semi_sync_master_timeout")]),s._v("    等待多时毫秒后变成异步复制，默认是10000ms")]),s._v(" "),r("li",[r("strong",[s._v("rpl_semi_sync_master_wait_point")]),s._v(" 5.7默认AFTER_SYNC（增强版半同步复制，无损复制模式），在得到slave的应答后再commit，可选值AFTER_COMMIT，在master提交后同步数据给slave，然后master等待slave应答，应答成功返回客户端。")])])]),s._v(" "),r("hr"),s._v(" "),r("ol",{attrs:{start:"3"}},[r("li",[s._v("第三行则是打开半同步复制的开关。")])]),s._v(" "),r("p",[s._v("在第二行查看系统参数时，最后的一个参数rpl_semi_sync_master_wait_point其实表示一种半同步复制的方式。")]),s._v(" "),r("p",[s._v("半同步复制有两种方式，一种是我们现在看到的这种默认的AFTER_SYNC方式。这种方式下，主库把日志写入binlog，并且复制给从库，然后开始等待从库的响应。从库返回成功后，主库再提交事务，接着给客户端返回一个成功响应。")]),s._v(" "),r("p",[s._v("而另一种方式是叫做"),r("strong",[s._v("AFTER_COMMIT方式")]),s._v("。他不是默认的。这种方式，在主库写入binlog后，等待binlog复制到从库，主库就提交自己的本地事务，再等待从库返回给自己一个成功响应，然后主库再给客户端返回响应。")]),s._v(" "),r("h3",{attrs:{id:"_2-6-2-slave安装smeisync-slave模块"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-2-slave安装smeisync-slave模块"}},[s._v("#")]),s._v(" 2.6.2 Slave安装smeisync_slave模块")]),s._v(" "),r("div",{staticClass:"language-sql line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[s._v("mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" install plugin rpl_semi_sync_slave "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("soname")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'semisync_slave.so'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" variables "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rpl_semi_sync_slave%'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------------------+-------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name                   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------------------+-------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_slave_enabled     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFF")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_slave_trace_level "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------------------+-------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" rpl_semi_sync_slave_enabled "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("on")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" variables "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v("'rpl_semi%'")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------------------+-------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name                   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------------------+-------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_slave_enabled     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" rpl_semi_sync_slave_trace_level "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("---------------------------------+-------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" warning "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.00")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" stop slave"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nmysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("start")]),s._v(" slave"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nQuery OK"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" affected "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br"),r("span",{staticClass:"line-number"},[s._v("26")]),r("br"),r("span",{staticClass:"line-number"},[s._v("27")]),r("br"),r("span",{staticClass:"line-number"},[s._v("28")]),r("br"),r("span",{staticClass:"line-number"},[s._v("29")]),r("br"),r("span",{staticClass:"line-number"},[s._v("30")]),r("br")])]),r("p",[r("strong",[s._v("slave端的安装过程基本差不多，不过要注意下安装完slave端的半同步插件后，需要重启下slave服务")])]),s._v(" "),r("h4",{attrs:{id:"再去master节点查看-发现-rpl-semi-sync-master-clients-1"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#再去master节点查看-发现-rpl-semi-sync-master-clients-1"}},[s._v("#")]),s._v(" 再去Master节点查看，发现 Rpl_semi_sync_master_clients=1")]),s._v(" "),r("div",{staticClass:"language-sql line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sql"}},[r("code",[s._v("mysql"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("show")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("global")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("status")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("like")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token string"}},[s._v('"%sync%"')]),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------------------------------+-------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Variable_name                              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("Value")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------------------------------+-------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Innodb_data_fsyncs                         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Innodb_data_pending_fsyncs                 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Innodb_os_log_fsyncs                       "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Innodb_os_log_pending_fsyncs               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_clients               "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_net_avg_wait_time     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_net_wait_time         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_net_waits             "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_no_times              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_no_tx                 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_status                "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("ON")]),s._v("    "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_timefunc_failures     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_tx_avg_wait_time      "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_tx_wait_time          "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_tx_waits              "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_wait_pos_backtraverse "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_wait_sessions         "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_master_yes_tx                "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("     "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" Rpl_semi_sync_slave_status                 "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("OFF")]),s._v("   "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),r("span",{pre:!0,attrs:{class:"token comment"}},[s._v("--------------------------------------------+-------+")]),s._v("\n"),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("rows")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token operator"}},[s._v("in")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("set")]),s._v(" "),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),r("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.01")]),s._v(" sec"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[s._v("1")]),r("br"),r("span",{staticClass:"line-number"},[s._v("2")]),r("br"),r("span",{staticClass:"line-number"},[s._v("3")]),r("br"),r("span",{staticClass:"line-number"},[s._v("4")]),r("br"),r("span",{staticClass:"line-number"},[s._v("5")]),r("br"),r("span",{staticClass:"line-number"},[s._v("6")]),r("br"),r("span",{staticClass:"line-number"},[s._v("7")]),r("br"),r("span",{staticClass:"line-number"},[s._v("8")]),r("br"),r("span",{staticClass:"line-number"},[s._v("9")]),r("br"),r("span",{staticClass:"line-number"},[s._v("10")]),r("br"),r("span",{staticClass:"line-number"},[s._v("11")]),r("br"),r("span",{staticClass:"line-number"},[s._v("12")]),r("br"),r("span",{staticClass:"line-number"},[s._v("13")]),r("br"),r("span",{staticClass:"line-number"},[s._v("14")]),r("br"),r("span",{staticClass:"line-number"},[s._v("15")]),r("br"),r("span",{staticClass:"line-number"},[s._v("16")]),r("br"),r("span",{staticClass:"line-number"},[s._v("17")]),r("br"),r("span",{staticClass:"line-number"},[s._v("18")]),r("br"),r("span",{staticClass:"line-number"},[s._v("19")]),r("br"),r("span",{staticClass:"line-number"},[s._v("20")]),r("br"),r("span",{staticClass:"line-number"},[s._v("21")]),r("br"),r("span",{staticClass:"line-number"},[s._v("22")]),r("br"),r("span",{staticClass:"line-number"},[s._v("23")]),r("br"),r("span",{staticClass:"line-number"},[s._v("24")]),r("br"),r("span",{staticClass:"line-number"},[s._v("25")]),r("br")])]),r("hr"),s._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[s._v("重要参数")]),s._v(" "),r("ol",[r("li",[s._v("Rpl_semi_sync_master_clients         支持和注册半同步复制的已连Slave数")]),s._v(" "),r("li",[s._v("Rpl_semi_sync_master_no_times     master关闭半同步复制的次数")]),s._v(" "),r("li",[s._v("Rpl_semi_sync_master_no_tx           master没有收到slave的回复而提交的次数，可以理解为master等待超时的次数，即半同步模式不成功提交数量")]),s._v(" "),r("li",[s._v("Rpl_semi_sync_master_status          ON是活动状态（半同步），OFF是非活动状态（异步），用于表示主服务器使用的是异步复制模式，还是半同步复制模式")]),s._v(" "),r("li",[s._v("Rpl_semi_sync_master_tx_avg_wait_time      master花在每个事务上的平均等待时间")]),s._v(" "),r("li",[s._v("Rpl_semi_sync_master_tx_waits         master等待成功的次数，即master没有等待超时的次数，也就是成功提交的次数")]),s._v(" "),r("li",[s._v("Rpl_semi_sync_master_yes_tx          master成功接收到slave的回复的次数，即半同步模式成功提交数量。")])])])])}),[],!1,null,null,null);a.default=e.exports},310:function(s,a,t){s.exports=t.p+"assets/img/mysql40.ed965d48.jpg"},766:function(s,a,t){s.exports=t.p+"assets/img/mysql37.7f44cce8.jpg"},767:function(s,a,t){s.exports=t.p+"assets/img/mysql38.16792161.jpg"},768:function(s,a,t){s.exports=t.p+"assets/img/mysql39.5078caf6.jpg"}}]);