(window.webpackJsonp=window.webpackJsonp||[]).push([[104],{1180:function(s,a,e){s.exports=e.p+"assets/img/image-20200928110456495.03ce46bb.png"},1181:function(s,a,e){s.exports=e.p+"assets/img/image-20200928110543829.779f4ab6.png"},1182:function(s,a,e){s.exports=e.p+"assets/img/k8s06.5c307892.jpg"},1183:function(s,a,e){s.exports=e.p+"assets/img/image-20201113204158884.08b38b00.png"},1604:function(s,a,e){"use strict";e.r(a);var t=e(26),n=Object(t.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_2-kubeadm方式搭建k8s集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-kubeadm方式搭建k8s集群"}},[s._v("#")]),s._v(" 2. kubeadm方式搭建K8S集群")]),s._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#_2-1-搭建k8s环境平台规划"}},[s._v("2.1 搭建k8s环境平台规划")]),t("ul",[t("li",[t("a",{attrs:{href:"#_2-1-1单master集群"}},[s._v("2.1.1单master集群")])]),t("li",[t("a",{attrs:{href:"#_2-1-2-多master集群"}},[s._v("2.1.2 多master集群")])])])]),t("li",[t("a",{attrs:{href:"#_2-2-服务器硬件配置要求"}},[s._v("2.2 服务器硬件配置要求")]),t("ul",[t("li",[t("a",{attrs:{href:"#_2-2-1-测试环境"}},[s._v("2.2.1 测试环境")])]),t("li",[t("a",{attrs:{href:"#_2-2-2-生产环境"}},[s._v("2.2.2 生产环境")])]),t("li",[t("a",{attrs:{href:"#_2-2-3-kubeadm"}},[s._v("2.2.3 kubeadm")])]),t("li",[t("a",{attrs:{href:"#_2-2-4-二进制包"}},[s._v("2.2.4 二进制包")])])])]),t("li",[t("a",{attrs:{href:"#_2-3-kubeadm部署集群"}},[s._v("2.3 Kubeadm部署集群")]),t("ul",[t("li",[t("a",{attrs:{href:"#_2-3-1-安装要求"}},[s._v("2.3.1 安装要求")])]),t("li",[t("a",{attrs:{href:"#_2-3-2-kubeadm搭建k8s集群"}},[s._v("2.3.2 Kubeadm搭建K8S集群")])]),t("li",[t("a",{attrs:{href:"#_2-3-3-系统参数调整"}},[s._v("2.3.3 系统参数调整")])]),t("li",[t("a",{attrs:{href:"#_2-3-4-安装docker"}},[s._v("2.3.4 安装Docker")])]),t("li",[t("a",{attrs:{href:"#_2-3-5-添加kubernetes软件源"}},[s._v("2.3.5 添加kubernetes软件源")])]),t("li",[t("a",{attrs:{href:"#_2-3-6-安装kubeadm-kubelet-kubectl"}},[s._v("2.3.6 安装kubeadm/kubelet/kubectl")])]),t("li",[t("a",{attrs:{href:"#_2-3-6-部署k8s-master-master节点"}},[s._v("2.3.6 部署K8s Master[master节点]")])]),t("li",[t("a",{attrs:{href:"#_2-3-7-加入k8s-node-slave节点"}},[s._v("2.3.7 加入K8s Node[Slave节点]")])]),t("li",[t("a",{attrs:{href:"#_2-3-7-部署cni网络插件-master"}},[s._v("2.3.7 部署CNI网络插件[Master]")])]),t("li",[t("a",{attrs:{href:"#_2-3-8-测试kubernetes集群-master"}},[s._v("2.3.8 测试kubernetes集群[Master]")])])])]),t("li",[t("a",{attrs:{href:"#_2-4-安装部署错误汇总"}},[s._v("2.4 安装部署错误汇总")]),t("ul",[t("li",[t("a",{attrs:{href:"#错误一"}},[s._v("错误一")])]),t("li",[t("a",{attrs:{href:"#错误二"}},[s._v("错误二")])]),t("li",[t("a",{attrs:{href:"#错误三"}},[s._v("错误三")])]),t("li",[t("a",{attrs:{href:"#错误四"}},[s._v("错误四")])]),t("li",[t("a",{attrs:{href:"#错误五"}},[s._v("错误五")])]),t("li",[t("a",{attrs:{href:"#错误六"}},[s._v("错误六")])]),t("li",[t("a",{attrs:{href:"#错误七"}},[s._v("错误七")])])])])])]),t("p"),s._v(" "),t("h2",{attrs:{id:"_2-1-搭建k8s环境平台规划"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-搭建k8s环境平台规划"}},[s._v("#")]),s._v(" 2.1 搭建k8s环境平台规划")]),s._v(" "),t("h3",{attrs:{id:"_2-1-1单master集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-1单master集群"}},[s._v("#")]),s._v(" 2.1.1单master集群")]),s._v(" "),t("p",[s._v("单个master节点，然后管理多个node节点")]),s._v(" "),t("p",[t("img",{attrs:{src:e(1180),alt:"image-20200928110456495"}})]),s._v(" "),t("h3",{attrs:{id:"_2-1-2-多master集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-2-多master集群"}},[s._v("#")]),s._v(" 2.1.2 多master集群")]),s._v(" "),t("p",[s._v("多个master节点，管理多个node节点，同时中间多了一个负载均衡的过程")]),s._v(" "),t("p",[t("img",{attrs:{src:e(1181),alt:"image-20200928110543829"}})]),s._v(" "),t("h2",{attrs:{id:"_2-2-服务器硬件配置要求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-服务器硬件配置要求"}},[s._v("#")]),s._v(" 2.2 服务器硬件配置要求")]),s._v(" "),t("h3",{attrs:{id:"_2-2-1-测试环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-1-测试环境"}},[s._v("#")]),s._v(" 2.2.1 测试环境")]),s._v(" "),t("p",[s._v("master：2核  4G  20G")]),s._v(" "),t("p",[s._v("node：   4核  8G  40G")]),s._v(" "),t("h3",{attrs:{id:"_2-2-2-生产环境"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-2-生产环境"}},[s._v("#")]),s._v(" 2.2.2 生产环境")]),s._v(" "),t("p",[s._v("master：8核  16G  100G")]),s._v(" "),t("p",[s._v("node：   16核  64G  200G")]),s._v(" "),t("p",[s._v("目前生产部署Kubernetes集群主要有两种方式")]),s._v(" "),t("h3",{attrs:{id:"_2-2-3-kubeadm"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-3-kubeadm"}},[s._v("#")]),s._v(" 2.2.3 kubeadm")]),s._v(" "),t("p",[s._v("kubeadm是一个K8S部署工具，提供kubeadm init 和 kubeadm join，用于快速部署Kubernetes集群")]),s._v(" "),t("p",[s._v("官网地址："),t("a",{attrs:{href:"https://kubernetes.io/zh/docs/setup/production-environment/tools/kubeadm/install-kubeadm/",target:"_blank",rel:"noopener noreferrer"}},[s._v("点我传送"),t("OutboundLink")],1)]),s._v(" "),t("h3",{attrs:{id:"_2-2-4-二进制包"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-4-二进制包"}},[s._v("#")]),s._v(" 2.2.4 二进制包")]),s._v(" "),t("p",[s._v("从github下载发行版的二进制包，手动部署每个组件，组成Kubernetes集群。")]),s._v(" "),t("p",[s._v("Kubeadm降低部署门槛，但屏蔽了很多细节，遇到问题很难排查。如果想更容易可控，推荐使用二进制包部署Kubernetes集群，虽然手动部署麻烦点，期间可以学习很多工作原理，也利于后期维护。")]),s._v(" "),t("hr"),s._v(" "),t("h2",{attrs:{id:"_2-3-kubeadm部署集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-kubeadm部署集群"}},[s._v("#")]),s._v(" 2.3 Kubeadm部署集群")]),s._v(" "),t("p",[s._v("kubeadm 是官方社区推出的一个用于快速部署kubernetes 集群的工具，这个工具能通过两条指令完成一个kubernetes 集群的部署：")]),s._v(" "),t("ul",[t("li",[s._v("创建一个Master 节点kubeadm init")]),s._v(" "),t("li",[s._v("将Node 节点加入到当前集群中$ kubeadm join <Master 节点的IP 和端口>")])]),s._v(" "),t("p",[s._v("kubeadm是官方社区推出的一个用于快速部署kubernetes集群的工具。")]),s._v(" "),t("p",[s._v("这个工具能通过两条指令完成一个kubernetes集群的部署：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建一个 Master 节点")]),s._v("\nkubeadm init\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将一个 Node 节点加入到当前集群中")]),s._v("\nkubeadm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("Master节点的IP和端口 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_2-3-1-安装要求"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-1-安装要求"}},[s._v("#")]),s._v(" 2.3.1 安装要求")]),s._v(" "),t("p",[s._v("在开始之前，部署Kubernetes集群机器需要满足以下几个条件")]),s._v(" "),t("ul",[t("li",[s._v("一台或多台机器，操作系统为Centos7.X")]),s._v(" "),t("li",[s._v("硬件配置：2GB或更多GAM，2个CPU或更多CPU，硬盘30G")]),s._v(" "),t("li",[s._v("集群中所有机器之间网络互通")]),s._v(" "),t("li",[s._v("可以访问外网，需要拉取镜像")]),s._v(" "),t("li",[s._v("禁止swap分区")])]),s._v(" "),t("table",[t("thead",[t("tr",[t("th",[s._v("角色")]),s._v(" "),t("th",[s._v("IP")])])]),s._v(" "),t("tbody",[t("tr",[t("td",[s._v("master")]),s._v(" "),t("td",[s._v("192.168.222.3")])]),s._v(" "),t("tr",[t("td",[s._v("node1")]),s._v(" "),t("td",[s._v("192.168.222.4")])]),s._v(" "),t("tr",[t("td",[s._v("node2")]),s._v(" "),t("td",[s._v("192.168.222.5")])])])]),s._v(" "),t("h3",{attrs:{id:"_2-3-2-kubeadm搭建k8s集群"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-2-kubeadm搭建k8s集群"}},[s._v("#")]),s._v(" 2.3.2 Kubeadm搭建K8S集群")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("使用kubeadm方式搭建K8s集群主要分为以下几步")]),s._v(" "),t("ul",[t("li",[t("p",[s._v("准备三台虚拟机，同时安装操作系统CentOS 7.x")])]),s._v(" "),t("li",[t("p",[s._v("对三个安装之后的操作系统进行初始化操作")])]),s._v(" "),t("li",[t("p",[s._v("在三个节点安装 docker kubelet kubeadm kubectl")])]),s._v(" "),t("li",[t("p",[s._v("在master节点执行kubeadm init命令初始化")])]),s._v(" "),t("li",[t("p",[s._v("在node节点上执行 kubeadm join命令，把node节点添加到当前集群")])]),s._v(" "),t("li",[t("p",[s._v("配置CNI网络插件，用于节点之间的连通【失败了可以多试几次】")])]),s._v(" "),t("li",[t("p",[s._v("通过拉取一个nginx进行测试，能否进行外网测试")])])])]),s._v(" "),t("h3",{attrs:{id:"_2-3-3-系统参数调整"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-3-系统参数调整"}},[s._v("#")]),s._v(" 2.3.3 系统参数调整")]),s._v(" "),t("p",[s._v("然后开始在每台机器上执行下面的命令")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭防火墙")]),s._v("\nsystemctl stop firewalld\nsystemctl disable firewalld\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭selinux")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久关闭")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/enforcing/disabled/'")]),s._v(" /etc/selinux/config  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时关闭")]),s._v("\nsetenforce "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭swap")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时")]),s._v("\nswapoff -a \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久关闭")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -ri "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/.*swap.*/#&/'")]),s._v(" /etc/fstab\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据规划设置主机名【master节点上操作】")]),s._v("\nhostnamectl set-hostname k8smaster\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据规划设置主机名【node1节点操作】")]),s._v("\nhostnamectl set-hostname k8snode1\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据规划设置主机名【node2节点操作】")]),s._v("\nhostnamectl set-hostname k8snode2\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在master添加hosts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/hosts "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n192.168.222.3 k8smaster\n192.168.222.4 k8snode1\n192.168.222.5 k8snode2\nEOF")]),s._v("\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将桥接的IPv4流量传递到iptables的链")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/sysctl.d/k8s.conf "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nEOF")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生效")]),s._v("\nsysctl --system  \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 时间同步")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" ntpdate -y\nntpdate time.windows.com\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br")])]),t("h4",{attrs:{id:"所有节点安装docker-kubeadm-kubelet-kubernetes默认cri-容器运行时-为docker-因此先安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#所有节点安装docker-kubeadm-kubelet-kubernetes默认cri-容器运行时-为docker-因此先安装docker"}},[s._v("#")]),s._v(" 所有节点安装Docker/kubeadm/kubelet ，Kubernetes默认CRI（容器运行时）为Docker，因此先安装Docker")]),s._v(" "),t("ul",[t("li",[s._v("以下三步每台服务器都要执行")])]),s._v(" "),t("h3",{attrs:{id:"_2-3-4-安装docker"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-4-安装docker"}},[s._v("#")]),s._v(" 2.3.4 安装Docker")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("/etc/yum.repos.d/docker.repo"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[docker-ce-edge]\nname=Docker CE Edge - \\"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basearch")]),s._v("\nbaseurl=https://mirrors.aliyun.com/docker-ce/linux/centos/7/\\"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$basearch")]),s._v("/edge\nenabled=1\ngpgcheck=1\ngpgkey=https://mirrors.aliyun.com/docker-ce/linux/centos/gpg\nEOF")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("ul",[t("li",[s._v("然后yum方式安装docker")])]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum安装")]),s._v("\nyum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看docker版本")]),s._v("\ndocker --version  \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 启动docker")]),s._v("\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" docker\nsystemctl start docker\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("配置docker的镜像源")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" /etc/docker/daemon.json "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('EOF\n{\n  "registry-mirrors": ["https://b9pmyelo.mirror.aliyuncs.com"]\n}\nEOF')]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("然后重启docker")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("systemctl restart docker\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_2-3-5-添加kubernetes软件源"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-5-添加kubernetes软件源"}},[s._v("#")]),s._v(" 2.3.5 添加kubernetes软件源")]),s._v(" "),t("p",[s._v("然后我们还需要配置一下yum的k8s软件源")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/yum.repos.d/kubernetes.repo "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("EOF\n[kubernetes]\nname=Kubernetes\nbaseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled=1\ngpgcheck=0\nrepo_gpgcheck=0\ngpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("h3",{attrs:{id:"_2-3-6-安装kubeadm-kubelet-kubectl"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-6-安装kubeadm-kubelet-kubectl"}},[s._v("#")]),s._v(" 2.3.6 安装kubeadm/kubelet/kubectl")]),s._v(" "),t("p",[s._v("由于版本更新频繁，这里指定版本号部署：")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装kubelet、kubeadm、kubectl，同时指定版本")]),s._v("\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -y kubelet-1.18.0 kubeadm-1.18.0 kubectl-1.18.0\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置开机启动")]),s._v("\nsystemctl "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("enable")]),s._v(" kubelet\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("hr"),s._v(" "),t("h3",{attrs:{id:"_2-3-6-部署k8s-master-master节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-6-部署k8s-master-master节点"}},[s._v("#")]),s._v(" 2.3.6 部署K8s Master[master节点]")]),s._v(" "),t("ul",[t("li",[s._v("在   192.168.222.3  执行，也就是master节点")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("kubeadm init --apiserver-advertise-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.3 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.18.0 --service-cidr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.0/12  --pod-network-cidr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.0/16\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("由于默认拉取镜像地址k8s.gcr.io国内无法访问，这里指定阿里云镜像仓库地址，【执行上述命令会比较慢，因为后台其实已经在拉取镜像了】，我们 docker images 命令即可查看已经拉取的镜像")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8smaster ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker images")]),s._v("\nREPOSITORY                                                        TAG                 IMAGE ID            CREATED             SIZE\nregistry.aliyuncs.com/google_containers/kube-proxy                v1.18.0             43940c34f24f        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" months ago       117MB\nregistry.aliyuncs.com/google_containers/kube-apiserver            v1.18.0             74060cea7f70        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" months ago       173MB\nregistry.aliyuncs.com/google_containers/kube-controller-manager   v1.18.0             d3e55153f52f        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" months ago       162MB\nregistry.aliyuncs.com/google_containers/kube-scheduler            v1.18.0             a31f78c7c8ce        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" months ago       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("95")]),s._v(".3MB\nregistry.aliyuncs.com/google_containers/pause                     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.2")]),s._v("                 80d28bedfe5d        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" months ago       683kB\nregistry.aliyuncs.com/google_containers/coredns                   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.6")]),s._v(".7               67da37a9a360        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" months ago       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("43")]),s._v(".8MB\nregistry.aliyuncs.com/google_containers/etcd                      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.4")]),s._v(".3-0             303ce5db0e90        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" years ago         288MB\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ul",[t("li",[s._v("当我们出现下面的情况时，表示kubernetes的镜像已经安装成功")])]),s._v(" "),t("div",{staticClass:"language-log line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('[kubelet-finalize] Updating "/etc/kubernetes/kubelet.conf" to point to a rotatable kubelet client certificate and key\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nYou should now deploy a pod network to the cluster.\nRun "kubectl apply -f [podnetwork].yaml" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.222.3:6443 --token xcl63i.8ucjiwg0js5dsln2 \\\n    --discovery-token-ca-cert-hash sha256:7edd0241a5af6d3dec25e674018d95191f66afd6ecda2ef5ce02b2d328665ab5 \n\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("ul",[t("li",[s._v("使用kubectl工具 【master节点操作】")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -g"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ul",[t("li",[s._v("执行完成后，我们使用下面命令，查看我们正在运行的节点")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8smaster ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get nodes")]),s._v("\nNAME        STATUS     ROLES    AGE   VERSION\nk8smaster   NotReady   master   37m   v1.18.0\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("p",[s._v("能够看到，目前有一个master节点已经运行了，但是还处于未准备状态")]),s._v(" "),t("p",[s._v("下面我们还需要在Node节点执行其它的命令，将node1和node2加入到我们的master节点上")]),s._v(" "),t("h3",{attrs:{id:"_2-3-7-加入k8s-node-slave节点"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-7-加入k8s-node-slave节点"}},[s._v("#")]),s._v(" 2.3.7 加入K8s Node[Slave节点]")]),s._v(" "),t("p",[s._v("下面我们需要到 node1 和 node2服务器，执行下面的代码向集群添加新节点")]),s._v(" "),t("ul",[t("li",[s._v("执行在kubeadm init输出的kubeadm join命令：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubeadm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.3:6443 --token xcl63i.8ucjiwg0js5dsln2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --discovery-token-ca-cert-hash sha256:7edd0241a5af6d3dec25e674018d95191f66afd6ecda2ef5ce02b2d328665ab5 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[t("strong",[s._v("注意，以下的命令是在master初始化完成后，每个人的都不一样！！！需要复制自己生成的")])]),s._v(" "),t("ul",[t("li",[s._v("默认token有效期为24小时，当过期之后，该token就不可用了。这时就需要重新创建token，操作如下：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#主节点执行")]),s._v("\nkubeadm token create --print-join-command\n\nkubeadm token create\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看")]),s._v("\nkubeadm token list\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#2. 生成一个永不过期的 token")]),s._v("\n\nkubeadm token create --ttl "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("ul",[t("li",[s._v("当我们把两个节点都加入进来后，我们就可以去Master节点 执行下面命令查看情况")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8smaster ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get nodes")]),s._v("\nNAME        STATUS     ROLES    AGE   VERSION\nk8s-node1   NotReady   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   10m   v1.18.0\nk8smaster   NotReady   master   37m   v1.18.0\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_2-3-7-部署cni网络插件-master"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-7-部署cni网络插件-master"}},[s._v("#")]),s._v(" 2.3.7 部署CNI网络插件[Master]")]),s._v(" "),t("ul",[t("li",[s._v("上面的状态还是NotReady，下面我们需要网络插件，来进行联网访问")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载网络插件配置")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8smaster ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml")]),s._v("\n--2021-12-17 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":02:31--  https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n正在解析主机 raw.githubusercontent.com "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("raw.githubusercontent.com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("185.199")]),s._v(".109.133, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("185.199")]),s._v(".110.133, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("185.199")]),s._v(".111.133, "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n正在连接 raw.githubusercontent.com "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("raw.githubusercontent.com"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("185.199")]),s._v(".109.133"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(":443"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(". 已连接。\n无法建立 SSL 连接。\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ul",[t("li",[s._v("默认镜像地址无法访问，sed命令修改为docker hub镜像仓库。")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加")]),s._v("\nkubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##①首先下载v0.13.1-rc2-amd64 镜像")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##参考博客：https://www.cnblogs.com/pyxuexi/p/14288591.html")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##② 导入镜像，命令，，特别提示，3个机器都需要导入，3个机器都需要导入，3个机器都需要导入，3个机器都需要导入，重要的事情说3遍。不然抱错。如果没有操作，报错后，需要删除节点，重置，在导入镜像，重新加入才行。本地就是这样操作成功的！")]),s._v("\ndocker load "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" flanneld-v0.13.1-rc2-amd64.docker\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#####下载本地，替换将image: quay.io/coreos/flannel:v0.13.1-rc2 替换为 image: quay.io/coreos/flannel:v0.13.1-rc2-amd64")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8s-node1 ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker load < flanneld-v0.13.1-rc2-amd64.docker")]),s._v("\n-bash: flanneld-v0.13.1-rc2-amd64.docker: 没有那个文件或目录\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("ul",[t("li",[s._v("查看状态 【kube-system是k8s中的最小单元】")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看状态 【kube-system是k8s中的最小单元】")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8smaster ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pods -n kube-system")]),s._v("\nNAME                                READY   STATUS    RESTARTS   AGE\ncoredns-7ff77c879f-qxvdq            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          107m\ncoredns-7ff77c879f-xjdns            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          107m\netcd-k8smaster                      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          108m\nkube-apiserver-k8smaster            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          108m\nkube-controller-manager-k8smaster   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          108m\nkube-flannel-ds-jjvlz               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          43m\nkube-flannel-ds-rvjwz               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          43m\nkube-flannel-ds-v85kl               "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          43m\nkube-proxy-7bcgd                    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          56m\nkube-proxy-rph7z                    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("          81m\nkube-proxy-wrs8q                    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          107m\nkube-scheduler-k8smaster            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          108m\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8smaster ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get node")]),s._v("\nNAME        STATUS   ROLES    AGE    VERSION\nk8s-node1   Ready    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   82m    v1.18.0\nk8s-node2   Ready    "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("   56m    v1.18.0\nk8smaster   Ready    master   108m   v1.18.0\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br")])]),t("ul",[t("li",[s._v("如果上述操作完成后，还存在某个节点处于NotReady状态，可以在Master将该节点删除")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# master节点将该节点删除")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##20210223 yan 查阅资料添加###kubectl drain k8snode1 --delete-local-data --force --ignore-daemonsets")]),s._v("\n\nkubectl delete node k8snode1\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 然后到k8snode1节点进行重置")]),s._v("\n kubeadm reset\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重置完后在加入")]),s._v("\nkubeadm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.3:6443 --token xcl63i.8ucjiwg0js5dsln2 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --discovery-token-ca-cert-hash sha256:7edd0241a5af6d3dec25e674018d95191f66afd6ecda2ef5ce02b2d328665ab5 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("h3",{attrs:{id:"_2-3-8-测试kubernetes集群-master"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-8-测试kubernetes集群-master"}},[s._v("#")]),s._v(" 2.3.8 测试kubernetes集群[Master]")]),s._v(" "),t("p",[s._v("我们都知道K8S是容器化技术，它可以联网去下载镜像，用容器的方式进行启动")]),s._v(" "),t("ul",[t("li",[s._v("在Kubernetes集群中创建一个pod，验证是否正常运行：")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载nginx 【会联网拉取nginx镜像】")]),s._v("\nkubectl create deployment nginx --image"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("nginx\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看状态")]),s._v("\nkubectl get pod\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[s._v("如果我们出现Running状态的时候，表示已经成功运行了")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8smaster ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod")]),s._v("\nNAME                    READY   STATUS    RESTARTS   AGE\nnginx-f89759699-xffhv   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          17m\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[s._v("下面我们就需要将端口暴露出去，让其它外界能够访问")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 暴露端口")]),s._v("\nkubectl expose deployment nginx --port"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(" --type"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("NodePort\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看一下对外的端口")]),s._v("\nkubectl get pod,svc\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8smaster ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubectl get pod,svc")]),s._v("\nNAME                        READY   STATUS    RESTARTS   AGE\npod/nginx-f89759699-xffhv   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("/1     Running   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("          18m\n\nNAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("S"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("        AGE\nservice/kubernetes   ClusterIP   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.1       "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("443")]),s._v("/TCP        112m\nservice/nginx        NodePort    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.104")]),s._v(".215.38   "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("none"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v(":32307/TCP   17m\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("ul",[t("li",[s._v("我们到我们的宿主机浏览器上，访问如下地址\n[http://192.168.222.3:32307/]")])]),s._v(" "),t("p",[t("a",{attrs:{"data-fancybox":"",title:"K8s 设计架构",href:"./images/k8s06.jpg"}},[t("img",{attrs:{src:e(1182),alt:"K8s 设计架构"}})])]),s._v(" "),t("hr"),s._v(" "),t("p",[t("img",{attrs:{src:e(1183),alt:"image-20201113204158884"}})]),s._v(" "),t("h2",{attrs:{id:"_2-4-安装部署错误汇总"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-安装部署错误汇总"}},[s._v("#")]),s._v(" 2.4 安装部署错误汇总")]),s._v(" "),t("h3",{attrs:{id:"错误一"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误一"}},[s._v("#")]),s._v(" 错误一")]),s._v(" "),t("p",[s._v("在执行Kubernetes  init方法的时候，出现这个问题")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("error execution phase preflight: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Some fatal errors occurred:\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ERROR NumCPU"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": the number of available CPUs "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" is "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("less")]),s._v(" than the required "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("是因为VMware设置的核数为1，而K8S需要的最低核数应该是2，调整核数重启系统即可")]),s._v(" "),t("h3",{attrs:{id:"错误二"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误二"}},[s._v("#")]),s._v(" 错误二")]),s._v(" "),t("p",[s._v("我们在给node1节点使用 kubernetes join命令的时候，出现以下错误")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("error execution phase preflight: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Some fatal errors occurred:\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ERROR Swap"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": running with swap on is not supported. Please disable swap\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("错误原因是我们需要关闭swap")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭swap")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时")]),s._v("\nswapoff -a \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -ri "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/.*swap.*/#&/'")]),s._v(" /etc/fstab\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"错误三"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误三"}},[s._v("#")]),s._v(" 错误三")]),s._v(" "),t("p",[s._v("在给node1节点使用 kubernetes join命令的时候，出现以下错误")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("The HTTP call equal to "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'curl -sSL http://localhost:10248/healthz'")]),s._v(" failed with error: Get http://localhost:10248/healthz: dial tcp "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("::1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(":10248: connect: connection refused\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("解决方法，首先需要到 master 节点，创建一个文件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建文件夹")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" /etc/systemd/system/kubelet.service.d\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 创建文件")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vim")]),s._v(" /etc/systemd/system/kubelet.service.d/10-kubeadm.conf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 添加如下内容")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("Environment")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"KUBELET_SYSTEM_PODS_ARGS=--pod-manifest-path=/etc/kubernetes/manifests --allow-privileged=true --fail-swap-on=false"')]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 重置")]),s._v("\nkubeadm reset\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("p",[s._v("然后删除刚刚创建的配置目录")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后 在master重新初始化")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubeadm init --apiserver-advertise-address"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("202.193")]),s._v(".57.11 --image-repository registry.aliyuncs.com/google_containers --kubernetes-version v1.18.0 --service-cidr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.96")]),s._v(".0.0/12  --pod-network-cidr"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.244")]),s._v(".0.0/16\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("初始完成后，我们再到 node1节点，执行 kubeadm join命令，加入到master")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubeadm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("202.193")]),s._v(".57.11:6443 --token c7a7ou.z00fzlb01d76r37s "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n    --discovery-token-ca-cert-hash sha256:9c3f3cc3f726c6ff8bdff14e46b1a856e3b8a4cbbe30cab185f6c5ee453aeea5\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("添加完成后，我们使用下面命令，查看节点是否成功添加")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubectl get nodes\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"错误四"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误四"}},[s._v("#")]),s._v(" 错误四")]),s._v(" "),t("p",[s._v("我们再执行查看节点的时候，  kubectl get nodes 会出现问题")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Unable to connect to the server: x509: certificate signed by unknown authority "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("possibly because of "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"crypto/rsa: verification error"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" trying to verify candidate authority certificate "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"kubernetes"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("这是因为我们之前创建的配置文件还存在，也就是这些配置")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -g"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("我们需要做的就是把配置文件删除，然后重新执行一下")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rm")]),s._v(" -rf "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后再次创建一下即可")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("mkdir")]),s._v(" -p "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cp")]),s._v(" -i /etc/kubernetes/admin.conf "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("chown")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -u"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(":")]),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("id")]),s._v(" -g"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v(")")])]),s._v(" "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$HOME")]),s._v("/.kube/config\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("这个问题主要是因为我们在执行 kubeadm reset 的时候，没有把 $HOME/.kube 给移除掉，再次创建时就会出现问题了")]),s._v(" "),t("h3",{attrs:{id:"错误五"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误五"}},[s._v("#")]),s._v(" 错误五")]),s._v(" "),t("p",[s._v("安装的时候，出现以下错误")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("Another app is currently holding the yum lock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" waiting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" it to exit"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("是因为yum上锁占用，解决方法")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum -y "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" docker-ce\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"错误六"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误六"}},[s._v("#")]),s._v(" 错误六")]),s._v(" "),t("p",[s._v("在使用下面命令，添加node节点到集群上的时候")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("kubeadm "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("join")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.3:6443 --token jkcz0t.3c40t0bqqz5g8wsb  --discovery-token-ca-cert-hash sha256:bc494eeab6b7bac64c0861da16084504626e5a95ba7ede7b9c2dc7571ca4c9e5\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后出现了这个错误")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@k8smaster ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# kubeadm join 192.168.222.3:6443 --token jkcz0t.3c40t0bqqz5g8wsb     --discovery-token-ca-cert-hash sha256:bc494eeab6b7bac64c0861da16084504626e5a95ba7ede7b9c2dc7571ca4c9e5")]),s._v("\nW1117 06:55:11.220907   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11230")]),s._v(" join.go:346"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" WARNING: JoinControlPane.controlPlane settings will be ignored when control-plane flag is not set.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Running pre-flight checks\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("WARNING IsDockerSystemdCheck"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": detected "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"cgroupfs"')]),s._v(" as the Docker cgroup driver. The recommended driver is "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"systemd"')]),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v(" Please follow the guide at https://kubernetes.io/docs/setup/cri/\nerror execution phase preflight: "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" Some fatal errors occurred:\n\t"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("ERROR FileContent--proc-sys-net-ipv4-ip_forward"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": /proc/sys/net/ipv4/ip_forward contents are not "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" to "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("preflight"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" If you know what you are doing, you can "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),s._v(" a check non-fatal with "),t("span",{pre:!0,attrs:{class:"token variable"}},[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")]),s._v("--ignore-preflight-errors"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v("."),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("`")])]),s._v("\nTo see the stack trace of this error execute with --v"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" or higher\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("出于安全考虑，Linux系统"),t("strong",[s._v("默认是禁止数据包转发")]),s._v("的。所谓"),t("strong",[s._v("转发即当主机拥有多于一块的网卡时，其中一块收到数据包，根据数据包的目的ip地址将包发往本机另一网卡，该网卡根据路由表继续发送数据包")]),s._v("。这通常就是路由器所要实现的功能。也就是说  "),t("strong",[s._v("/proc/sys/net/ipv4/ip_forward")]),s._v(" 文件的值不支持转发")]),s._v(" "),t("ul",[t("li",[s._v("0：禁止")]),s._v(" "),t("li",[s._v("1：转发")])]),s._v(" "),t("p",[s._v("所以我们需要将值修改成1即可")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'1'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /proc/sys/net/ipv4/ip_forward\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("修改完成后，重新执行命令即可")]),s._v(" "),t("h3",{attrs:{id:"错误七"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#错误七"}},[s._v("#")]),s._v(" 错误七")]),s._v(" "),t("p",[s._v("使用kubeadm部署K8S的时候出现了这样的问题，因为使用的是虚拟机复制，Node是Master的复制，\nkubeadm 默认使用主机名作为节点名，当您从主服务器克隆工作程序时，它们具有相同的主机名。\n解决方案：\n1.给node一个新的hostname通过hostnamectl或其他工具\n2.在集群加入Node时使用–node-name来标识一下")]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v('error execution phase kubelet-start: a Node with name "k8smaster" and status "Ready" already exists in the cluster. You must delete the existing Node or change the name of this new joining Node\n\n\n[root@k8smaster ~]# hostnamectl set-hostname k8s-node1\n[root@k8smaster ~]# kubeadm reset\n')])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])])])}),[],!1,null,null,null);a.default=n.exports}}]);