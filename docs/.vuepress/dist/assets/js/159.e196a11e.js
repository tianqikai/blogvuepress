(window.webpackJsonp=window.webpackJsonp||[]).push([[159],{1107:function(s,a,t){"use strict";t.r(a);var n=t(26),e=Object(n.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_5-docker安装mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-docker安装mysql"}},[s._v("#")]),s._v(" 5 Docker安装mysql")]),s._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#_5-1-docker下载mysql镜像"}},[s._v("5.1 Docker下载mysql镜像")])]),t("li",[t("a",{attrs:{href:"#_5-2-docker启动mysql"}},[s._v("5.2 docker启动mysql")])]),t("li",[t("a",{attrs:{href:"#_5-3-查看mysql服务进程是否存在"}},[s._v("5.3 查看mysql服务进程是否存在")])]),t("li",[t("a",{attrs:{href:"#_5-4-配置mysql"}},[s._v("5.4 配置mysql")]),t("ul",[t("li",[t("a",{attrs:{href:"#_5-4-1-修改配置文件-my-cnf"}},[s._v("5.4.1 修改配置文件 my.cnf")])]),t("li",[t("a",{attrs:{href:"#_5-4-2-进入mysql容器-并登陆mysql"}},[s._v("5.4.2 进入mysql容器，并登陆mysql")])]),t("li",[t("a",{attrs:{href:"#_5-4-3-开启远程访问权限"}},[s._v("5.4.3 开启远程访问权限")])])])]),t("li",[t("a",{attrs:{href:"#_5-5-docker重启mysql使配置生效"}},[s._v("5.5 Docker重启mysql使配置生效")])]),t("li",[t("a",{attrs:{href:"#_5-6-docker安装mysql网络不通"}},[s._v("5.6 Docker安装mysql网络不通")])])])]),t("p"),s._v(" "),t("h2",{attrs:{id:"_5-1-docker下载mysql镜像"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-1-docker下载mysql镜像"}},[s._v("#")]),s._v(" 5.1 Docker下载mysql镜像")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下载mysql 5.7")]),s._v("\ndocker pull mysql:5.7\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不加版本号，下载最新版本")]),s._v("\ndocker pull mysql\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看下载镜像")]),s._v("\ndocker images\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"_5-2-docker启动mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-2-docker启动mysql"}},[s._v("#")]),s._v(" 5.2 docker启动mysql")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("docker run --name mysqlserver5.7 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("$PWD")]),s._v("/logs:/logs  "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /mydata/mysql/log:/var/log/mysql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /mydata/mysql/data:/var/lib/mysql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-v /mydata/mysql/conf:/etc/mysql "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-e "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("MYSQL_ROOT_PASSWORD")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12345")]),s._v("@tqk "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-i -p "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3366")]),s._v(":3306 "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("\\")]),s._v("\n-d mysql:5.7 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("参数介绍")]),s._v(" "),t("p",[t("font",{attrs:{color:"red"}},[t("strong",[s._v("-p 3366:3306")])]),s._v("：将容器的3366端口映射到主机的3366端口"),t("br"),s._v(" "),t("font",{attrs:{color:"red"}},[t("strong",[s._v("--name")])]),s._v("：给容器命名"),t("br"),s._v(" "),t("font",{attrs:{color:"red"}},[t("strong",[s._v("-v /mydata/mysql/conf:/etc/mysql")])]),s._v("：将配置文件挂载到主机/mydata/.."),t("br"),s._v(" "),t("font",{attrs:{color:"red"}},[t("strong",[s._v("-e MYSQL_ROOT_PASSWORD=12345@tqk")])]),s._v("：初始化root用户的密码为12345@tqk")],1)]),s._v(" "),t("h2",{attrs:{id:"_5-3-查看mysql服务进程是否存在"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-3-查看mysql服务进程是否存在"}},[s._v("#")]),s._v(" 5.3 查看mysql服务进程是否存在")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM-16-5-centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker ps")]),s._v("\nCONTAINER ID   IMAGE       COMMAND                  CREATED         STATUS         PORTS                                         NAMES\n7757c9c35824   mysql:5.7   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"docker-entrypoint.s…"')]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" seconds ago   Up "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" seconds   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3306")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33060")]),s._v("/tcp, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:3366-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3366")]),s._v("/tcp   mysqlserver5.7\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("h2",{attrs:{id:"_5-4-配置mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-配置mysql"}},[s._v("#")]),s._v(" 5.4 配置mysql")]),s._v(" "),t("h3",{attrs:{id:"_5-4-1-修改配置文件-my-cnf"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-1-修改配置文件-my-cnf"}},[s._v("#")]),s._v(" 5.4.1 修改配置文件 my.cnf")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /mydata/mysql/conf/my.cnf\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("##添加内容##")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("client"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndefault-character-set"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\ndefault-character-set"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("mysqld"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("init_connect")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SET collation_connection = utf8_unicode_ci'")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("init_connect")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'SET NAMES utf8'")]),s._v("\ncharacter-set-server"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8\ncollation-server"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("utf8_unicode_ci\nskip-character-set-client-handshake\nskip-name-resolve\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Esc")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"_5-4-2-进入mysql容器-并登陆mysql"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-2-进入mysql容器-并登陆mysql"}},[s._v("#")]),s._v(" 5.4.2 进入mysql容器，并登陆mysql")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("docker "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exec")]),s._v(" -it mysqlserver5.7 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("bash")]),s._v("\nmysql -u root -p\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("h3",{attrs:{id:"_5-4-3-开启远程访问权限"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-4-3-开启远程访问权限"}},[s._v("#")]),s._v(" 5.4.3 开启远程访问权限")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("use mysql"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("select")]),s._v(" host,user from user"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nALTER "),t("span",{pre:!0,attrs:{class:"token environment constant"}},[s._v("USER")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'root'")]),s._v("@"),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'%'")]),s._v(" IDENTIFIED WITH mysql_native_password BY "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'12345@tqk'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\nflush privileges"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("### 退出docker容器")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("exit")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("h2",{attrs:{id:"_5-5-docker重启mysql使配置生效"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-5-docker重启mysql使配置生效"}},[s._v("#")]),s._v(" 5.5 Docker重启mysql使配置生效")]),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[s._v("docker restart mysqlserver5.7\n\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# docker开机自启动mysql")]),s._v("\ndocker update mysqlserver5.7 --restart"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis")]),s._v("\ndocker update redis --restart"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("always\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("h2",{attrs:{id:"_5-6-docker安装mysql网络不通"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_5-6-docker安装mysql网络不通"}},[s._v("#")]),s._v(" 5.6 Docker安装mysql网络不通")]),s._v(" "),t("p",[t("strong",[s._v("用docker创建MySQL无法访问的问题（WARNING: IPv4 forwarding is disabled. Networking will not work）")])]),s._v(" "),t("hr"),s._v(" "),t("div",{staticClass:"language-sh line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-sh"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看内核参数 net.ipv4.ip_forward=0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("cat")]),s._v(" /etc/sysctl.conf"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" forward\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 修改内核参数")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("vi")]),s._v(" /etc/sysctl.conf\nnet.ipv4.ip_forward"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#改成")]),s._v("\nnet.ipv4.ip_forward"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启network服务")]),s._v("\nsystemctl restart network\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启docker服务")]),s._v("\nsystemctl restart docker\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#重启iptables（可有可无，我的是腾讯云没有执行）")]),s._v("\nsystemctl restart iptables\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#上述步骤还是无法解决问题时，执行完上述步骤，重新安装MySQL")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br")])]),t("p",[s._v('gyp ERR! stack Error : can\'t find python executable "python",you can set the PYTHON env variable.')]),s._v(" "),t("p",[s._v("https://blog.csdn.net/caicsama/article/details/103679242?utm_medium=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.no_search_link&depth_1-utm_source=distribute.pc_relevant.none-task-blog-2%7Edefault%7EBlogCommendFromMachineLearnPai2%7Edefault-1.no_search_link")])])}),[],!1,null,null,null);a.default=e.exports}}]);