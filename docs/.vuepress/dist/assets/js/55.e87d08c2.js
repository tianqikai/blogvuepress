(window.webpackJsonp=window.webpackJsonp||[]).push([[55],{1039:function(t,s,a){"use strict";a.r(s);var r=a(26),e=Object(r.a)({},(function(){var t=this,s=t.$createElement,r=t._self._c||s;return r("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[r("h1",{attrs:{id:"_4-docker镜像"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-docker镜像"}},[t._v("#")]),t._v(" 4. Docker镜像")]),t._v(" "),r("p"),r("div",{staticClass:"table-of-contents"},[r("ul",[r("li",[r("a",{attrs:{href:"#_4-1-docker镜像是什么"}},[t._v("4.1 Docker镜像是什么")])]),r("li",[r("a",{attrs:{href:"#_4-2-unionfs-联合文件系统"}},[t._v("4.2 UnionFS(联合文件系统)")])]),r("li",[r("a",{attrs:{href:"#_4-3-docker镜像加载原理"}},[t._v("4.3 Docker镜像加载原理")]),r("ul",[r("li",[r("a",{attrs:{href:"#_4-3-1-分层的镜像"}},[t._v("4.3.1 分层的镜像")])]),r("li",[r("a",{attrs:{href:"#分层的镜像"}},[t._v("分层的镜像")])]),r("li",[r("a",{attrs:{href:"#_4-3-2-为什么docker纪念馆想要采用这种分层结构"}},[t._v("4.3.2 为什么Docker纪念馆想要采用这种分层结构")])]),r("li",[r("a",{attrs:{href:"#_4-3-3-特点"}},[t._v("4.3.3 特点")])])])]),r("li",[r("a",{attrs:{href:"#_4-3-docker迁移与备份"}},[t._v("4.3 Docker迁移与备份")]),r("ul",[r("li",[r("a",{attrs:{href:"#_4-3-1-案例演示"}},[t._v("4.3.1 案例演示")])])])])])]),r("p"),t._v(" "),r("h2",{attrs:{id:"_4-1-docker镜像是什么"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-docker镜像是什么"}},[t._v("#")]),t._v(" 4.1 Docker镜像是什么")]),t._v(" "),r("p",[t._v("镜像是一种轻量级、可执行的独立软件包，用来打包软件运行环境和基于运行环境开发的软件，它包含运行某个软件所需的有内容，包括代码、运行时、库、环境变量和配置文件。")]),t._v(" "),r("h2",{attrs:{id:"_4-2-unionfs-联合文件系统"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-unionfs-联合文件系统"}},[t._v("#")]),t._v(" 4.2 UnionFS(联合文件系统)")]),t._v(" "),r("p",[r("strong",[t._v("UnionFS (联合文件系统)：")]),t._v(" Union文件系统(UnionFS)是一一种分层、轻量级并且高性能的文件系统，它支持对文件系统的修作为一 次提交来一层层的叠加，同时可以将不同目录挂载到同一个虚拟文件系统下(unite several directories into a singlevirtualfilesystem)。Union文件系统是Docker镜像的基础。镜像可以通过分层来进行继承，基于基础镜像(没有父镜像)可以制作各种具.体的应用镜像。")]),t._v(" "),r("p",[r("strong",[t._v("特性:")]),t._v(" 一次同时加载多个文件系统，但从外面看起来，只能看到一个文件系统，联合加载会把各层文件系统叠加起来，这样最终的文\n件系统会包含所有底层的文件和目录")]),t._v(" "),r("h2",{attrs:{id:"_4-3-docker镜像加载原理"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-docker镜像加载原理"}},[t._v("#")]),t._v(" 4.3 Docker镜像加载原理")]),t._v(" "),r("p",[r("strong",[t._v("Docker镜像加载原理:")])]),t._v(" "),r("p",[r("strong",[t._v("docker")]),t._v("的镜像实际上由一层一层的文件系统组成，这种层级的文件系统"),r("strong",[t._v("UnionFS（联合文件系统）")])]),t._v(" "),r("p",[r("strong",[t._v("botfs(boot file system)"),r("strong",[t._v("主要包含")]),t._v("bootloader")]),t._v("和"),r("strong",[t._v("kernel")]),t._v(", "),r("strong",[t._v("bootloader")]),t._v("主要是引导加载"),r("strong",[t._v("kernel（内核）")]),t._v(", "),r("strong",[t._v("Linux")]),t._v("刚启动时会加载bootfs文件系统，在"),r("strong",[t._v("Docker")]),t._v("镜像的最底层是"),r("strong",[t._v("bootfs")]),t._v("。这一层与我们典型的"),r("strong",[t._v("Linux/Unix")]),t._v("系统是一样的，包含"),r("font",{attrs:{color:"red"}},[r("strong",[t._v("boot加载器和内核")])]),t._v("。当boot加载完成之后整个内核就都在内存中了，此时内存的使用权己由bootfs转交给内核，此时系统也会卸载bootfs。")],1),t._v(" "),r("p",[r("strong",[t._v("rootfs (root file system)，"),r("strong",[t._v("在")]),t._v("bootfs")]),t._v("之 上。 包含的就是典型Linux系统中的**/dev, /proc, /bin, /etc"),r("strong",[t._v("等标准目录和文件。"),r("strong",[t._v("rootfs")]),t._v("就 是各种不同的操作系统发行版，比如")]),t._v("Ubuntu**，"),r("strong",[t._v("Centos")]),t._v("等等。")]),t._v(" "),r("p",[r("img",{attrs:{src:a(772),alt:"UnionFS 联合文件系统"}})]),t._v(" "),r("p",[t._v("平时我们安装的虚拟机的Centos都是好几个G ，为什么docker这里才要200m")]),t._v(" "),r("p",[r("img",{attrs:{src:a(773),alt:"CENTOS"}})]),t._v(" "),r("p",[t._v("对于一个精简的"),r("strong",[t._v("OS(操作系统), rootfs")]),t._v("可以很小，只需要包括最基本的命令、工具和程序库就可以了，因为底层直接用"),r("strong",[t._v("Host（宿主机）"),r("strong",[t._v("的")]),t._v("kernel（内核）")]),t._v(",只需要提供rootfs就行了。由此可见对于不同的"),r("strong",[t._v("linux")]),t._v("发行版, "),r("strong",[t._v("bootfs")]),t._v("基本是一致的, "),r("strong",[t._v("rootfs")]),t._v("会有差别，因此不同的发行版可以公用"),r("strong",[t._v("bootfs")]),t._v("。")]),t._v(" "),r("h3",{attrs:{id:"_4-3-1-分层的镜像"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-分层的镜像"}},[t._v("#")]),t._v(" 4.3.1 分层的镜像")]),t._v(" "),r("p",[r("img",{attrs:{src:a(774),alt:"分层的镜像"}})]),t._v(" "),r("h3",{attrs:{id:"分层的镜像"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#分层的镜像"}},[t._v("#")]),t._v(" 分层的镜像")]),t._v(" "),r("p",[r("img",{attrs:{src:a(775),alt:""}})]),t._v(" "),r("h3",{attrs:{id:"_4-3-2-为什么docker纪念馆想要采用这种分层结构"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-2-为什么docker纪念馆想要采用这种分层结构"}},[t._v("#")]),t._v(" 4.3.2 为什么Docker纪念馆想要采用这种分层结构")]),t._v(" "),r("p",[t._v("最大的一个好处就是-"),r("strong",[t._v("共享资源")]),t._v("\n比如:"),r("strong",[t._v("有多个镜像都从相同的base镜像构建而来")]),t._v("，那么宿主机只需在磁盘上保存一份"),r("strong",[t._v("base")]),t._v("镜像,\n同时内存中也只需加载一份"),r("strong",[t._v("base")]),t._v("镜像，就可以为所有容器服务了。而且镜像的每一层都可以被共享。")]),t._v(" "),r("h3",{attrs:{id:"_4-3-3-特点"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-3-特点"}},[t._v("#")]),t._v(" 4.3.3 特点")]),t._v(" "),r("p",[t._v("Docker镜像都是只读的，当容器启动时，一个新的可写层被加载到"),r("strong",[t._v("镜像的顶部")]),t._v("，这一层通常被称为"),r("strong",[t._v("容器层")]),t._v("，容器层之下都叫"),r("strong",[t._v("镜像层")])]),t._v(" "),r("h2",{attrs:{id:"_4-3-docker迁移与备份"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-docker迁移与备份"}},[t._v("#")]),t._v(" 4.3 Docker迁移与备份")]),t._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[t._v("Commit命令模板")]),t._v(" "),r("p",[r("strong",[t._v("docker commit 容器名称 镜像名称")])]),t._v(" "),r("p",[t._v("docker commit 提交"),r("strong",[t._v("容器副本")]),t._v("使之称为一个新的镜像")]),t._v(" "),r("p",[t._v('docker commit -m="提交的描述信息" -a="作者" 容器ID 要创建的目标镜像名:[标签名]')])]),t._v(" "),r("hr"),t._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[t._v("镜像备份")]),t._v(" "),r("p",[t._v("我们可以通过以下命令将镜像保存为tar 文件")]),t._v(" "),r("p",[t._v("docker save -o tqk/tomcat02.tar tqk/tomcat02")])]),t._v(" "),r("hr"),t._v(" "),r("div",{staticClass:"custom-block tip"},[r("p",{staticClass:"custom-block-title"},[t._v("镜像恢复与迁移")]),t._v(" "),r("p",[t._v("首先我们先删除掉tqk/tomcat02镜像 然后执行此命令进行恢复")]),t._v(" "),r("p",[t._v("docker load -i tqk/tomcat02.tar -i 输入的文件")]),t._v(" "),r("p",[t._v("执行后再次查看镜像，可以看到镜像已经恢复")])]),t._v(" "),r("h3",{attrs:{id:"_4-3-1-案例演示"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-案例演示"}},[t._v("#")]),t._v(" 4.3.1 案例演示")]),t._v(" "),r("h4",{attrs:{id:"_4-3-1-1-从hub上下载tomcat镜像到本地并成功运行"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-1-从hub上下载tomcat镜像到本地并成功运行"}},[t._v("#")]),t._v(" 4.3.1.1 从Hub上下载tomcat镜像到本地并成功运行")]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@TXYUN-NO2 ~"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker run -id --name tomcat01 -p 8888:8080 tomcat:8.5.0")]),t._v("\n\n-p主机端口：docker容器端口\n-P:随机分配端口\ni:交互\nt:终端\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br"),r("span",{staticClass:"line-number"},[t._v("2")]),r("br"),r("span",{staticClass:"line-number"},[t._v("3")]),r("br"),r("span",{staticClass:"line-number"},[t._v("4")]),r("br"),r("span",{staticClass:"line-number"},[t._v("5")]),r("br"),r("span",{staticClass:"line-number"},[t._v("6")]),r("br")])]),r("p",[r("a",{attrs:{"data-fancybox":"",title:"案例演示",href:"./image/docker03.jpg"}},[t._v("![案例演示]​(./image/docker03.jpg)")])]),t._v(" "),r("h4",{attrs:{id:"_4-3-1-2-故意删除上一步镜像生产tomcat容器的文档"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-2-故意删除上一步镜像生产tomcat容器的文档"}},[t._v("#")]),t._v(" 4.3.1.2 故意删除上一步镜像生产tomcat容器的文档")]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("root@TXYUN-NO2 ~"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# docker exec -it  tomcat01 /bin/bash")]),t._v("\nroot@3b6f52c4060c:/usr/local/tomcat"),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# cd webapps/")]),t._v("\nroot@3b6f52c4060c:/usr/local/tomcat/webapps"),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls")]),t._v("\nROOT  docs  examples  host-manager  manager\nroot@3b6f52c4060c:/usr/local/tomcat/webapps"),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# rm -rf docs")]),t._v("\nroot@3b6f52c4060c:/usr/local/tomcat/webapps"),r("span",{pre:!0,attrs:{class:"token comment"}},[t._v("# ls -lrt")]),t._v("\ntotal "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("16")]),t._v("\ndrwxr-x--- "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" May  "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("2016")]),t._v(" manager\ndrwxr-x--- "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" May  "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("2016")]),t._v(" host-manager\ndrwxr-x--- "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),t._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" May  "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("2016")]),t._v(" examples\ndrwxr-x--- "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),t._v(" root root "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("4096")]),t._v(" May  "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),t._v("  "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("2016")]),t._v(" ROOT\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br"),r("span",{staticClass:"line-number"},[t._v("2")]),r("br"),r("span",{staticClass:"line-number"},[t._v("3")]),r("br"),r("span",{staticClass:"line-number"},[t._v("4")]),r("br"),r("span",{staticClass:"line-number"},[t._v("5")]),r("br"),r("span",{staticClass:"line-number"},[t._v("6")]),r("br"),r("span",{staticClass:"line-number"},[t._v("7")]),r("br"),r("span",{staticClass:"line-number"},[t._v("8")]),r("br"),r("span",{staticClass:"line-number"},[t._v("9")]),r("br"),r("span",{staticClass:"line-number"},[t._v("10")]),r("br"),r("span",{staticClass:"line-number"},[t._v("11")]),r("br")])]),r("h4",{attrs:{id:"_4-3-1-3-也即当前的tomcat运行实例是一个没有文档内容的容器-以他为模板commit一个没有doc的tomcat新镜像-tqk-tomcat02"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-3-也即当前的tomcat运行实例是一个没有文档内容的容器-以他为模板commit一个没有doc的tomcat新镜像-tqk-tomcat02"}},[t._v("#")]),t._v(" 4.3.1.3 也即当前的tomcat运行实例是一个没有文档内容的容器，以他为模板commit一个没有doc的tomcat新镜像 tqk/tomcat02")]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[t._v("docker commit -m"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"提交的描述信息"')]),t._v(" -a"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"作者"')]),t._v(" 容器ID 要创建的目标镜像名:"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("[")]),t._v("标签名"),r("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n\ndocker commit -m"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"yyds"')]),t._v(" -a"),r("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),r("span",{pre:!0,attrs:{class:"token string"}},[t._v('"tianqikai"')]),t._v(" tomcat01 tqk/tomcat02:1.0\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br"),r("span",{staticClass:"line-number"},[t._v("2")]),r("br"),r("span",{staticClass:"line-number"},[t._v("3")]),r("br")])]),r("h4",{attrs:{id:"_4-3-1-4-启动我们的新镜像并和原来的对比"}},[r("a",{staticClass:"header-anchor",attrs:{href:"#_4-3-1-4-启动我们的新镜像并和原来的对比"}},[t._v("#")]),t._v(" 4.3.1.4 启动我们的新镜像并和原来的对比")]),t._v(" "),r("div",{staticClass:"language-sh line-numbers-mode"},[r("pre",{pre:!0,attrs:{class:"language-sh"}},[r("code",[t._v("\ndocker run -d -p "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("7777")]),t._v(":8080 tomcat:8.5.0\ndocker run -d -p "),r("span",{pre:!0,attrs:{class:"token number"}},[t._v("9999")]),t._v(":8080 tqk/tomcat02:1.0\n")])]),t._v(" "),r("div",{staticClass:"line-numbers-wrapper"},[r("span",{staticClass:"line-number"},[t._v("1")]),r("br"),r("span",{staticClass:"line-number"},[t._v("2")]),r("br"),r("span",{staticClass:"line-number"},[t._v("3")]),r("br")])]),r("p",[t._v("​启动atuigu/tomcat02 没有doc")]),t._v(" "),r("p",[t._v("​启动原来tomcat他有doc")])])}),[],!1,null,null,null);s.default=e.exports},772:function(t,s,a){t.exports=a.p+"assets/img/Snipaste_2020-10-03_13-38-28.2155c42f.png"},773:function(t,s,a){t.exports=a.p+"assets/img/QQ20201003133908.90f83fe8.png"},774:function(t,s,a){t.exports=a.p+"assets/img/Snipaste_2020-10-03_13-40-06.083d76cc.png"},775:function(t,s,a){t.exports=a.p+"assets/img/Snipaste_2020-10-03_14-02-22.bdb7aa2b.png"}}]);