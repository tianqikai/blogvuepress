(window.webpackJsonp=window.webpackJsonp||[]).push([[36],{1507:function(s,t,a){"use strict";a.r(t);var n=a(26),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h1",{attrs:{id:"_4-gateway限流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-gateway限流"}},[s._v("#")]),s._v(" 4. Gateway限流")]),s._v(" "),n("h2",{attrs:{id:"_4-1-网关限流简介及算法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-1-网关限流简介及算法"}},[s._v("#")]),s._v(" 4.1 网关限流简介及算法")]),s._v(" "),n("p",[s._v("顾名思义，限流就是限制流量，就像你宽带包有 1 个 G 的流量，用完了就没了。通过限流，我们可以很好地控制系统的"),n("font",{attrs:{color:"red"}},[n("strong",[s._v("QPS")])]),s._v("，从而达到保护系统的目的")],1),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("为什么需要限流?")]),s._v(" "),n("p",[s._v("比如 Web 服务、对外 API，这种类型的服务有以下几种可能导致机器被拖垮：")]),s._v(" "),n("ol",[n("li",[s._v("用户增长过快（好事）")]),s._v(" "),n("li",[s._v("因为某个热点事件（微博热搜）")]),s._v(" "),n("li",[s._v("竞争对象爬虫")]),s._v(" "),n("li",[s._v("恶意的请求"),n("br"),s._v("\n这些情况都是无法预知的，不知道什么时候会有 10 倍甚至 20 倍的流量打进来，如果真碰上这种情况，扩容是根本来不及的。")])])]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("限流算法")]),s._v(" "),n("p",[n("font",{attrs:{color:"red"}},[n("strong",[s._v("计数器算法")])]),n("br"),s._v(" "),n("font",{attrs:{color:"red"}},[n("strong",[s._v("漏桶（Leaky Bucket）算法")])]),n("br"),s._v(" "),n("font",{attrs:{color:"red"}},[n("strong",[s._v("令牌桶（Token Bucket）算法")])])],1)]),s._v(" "),n("h3",{attrs:{id:"计数器算法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#计数器算法"}},[s._v("#")]),s._v(" 计数器算法")]),s._v(" "),n("p",[s._v("计数器算法是限流算法里最简单也是最容易实现的一种算法。比如我们规定，对于 A 接口来说，我们 1 分钟的\n访问次数不能超过 100 个。那么我们可以这么做：在一开始的时候，我们可以设置一个计数器 counter，每当一个请\n求过来的时候，counter 就加 1，如果 counter 的值大于 100 并且该请求与第一个请求的间隔时间还在 1 分钟之\n内，触发限流；如果该请求与第一个请求的间隔时间大于 1 分钟，重置 counter 重新计数，具体算法的示意图如\n下：\n"),n("a",{attrs:{"data-fancybox":"",title:"计数器算法",href:"./image/jishuqisuanfa1.jpg"}},[n("img",{attrs:{src:a(855),alt:"计数器算法"}})]),s._v("\n这个算法虽然简单，但是有一个十分致命的问题，那就是临界问题，我们看下图：")]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"计数器算法",href:"./image/jishuqisuanfa2.jpg"}},[n("img",{attrs:{src:a(856),alt:"计数器算法"}})]),s._v("\n从上图中我们可以看到，假设有一个恶意用户，他在 0:59 时，瞬间发送了 100 个请求，并且 1:00 又瞬间发送\n了 100 个请求，那么其实这个用户在 1 秒里面，瞬间发送了 200 个请求。我们刚才规定的是 1 分钟最多 100 个请\n求，也就是每秒钟最多 1.7 个请求，用户通过在时间窗口的重置节点处突发请求， 可以瞬间超过我们的速率限制。\n用户有可能通过算法的这个漏洞，瞬间压垮我们的应用。")]),s._v(" "),n("p",[s._v("还有资料浪费的问题存在，我们的预期想法是希望 100 个请求可以均匀分散在这一分钟内，假设 30s 以内我们\n就请求上限了，那么剩余的半分钟服务器就会处于闲置状态，比如下图：\n"),n("a",{attrs:{"data-fancybox":"",title:"计数器算法",href:"./image/jishuqisuanfa3.jpg"}},[n("img",{attrs:{src:a(857),alt:"计数器算法"}})])]),s._v(" "),n("h3",{attrs:{id:"漏桶算法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#漏桶算法"}},[s._v("#")]),s._v(" 漏桶算法")]),s._v(" "),n("p",[s._v("漏桶算法其实也很简单，可以粗略的认为就是注水漏水的过程，往桶中以任意速率流入水，以一定速率流出水，当水超过桶流量则丢弃，因为桶容量是不变的，保证了整体的速率。")]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"漏桶算法",href:"./image/loutong.jpg"}},[n("img",{attrs:{src:a(858),alt:"漏桶算法"}})])]),s._v(" "),n("h4",{attrs:{id:"漏桶算法是使用队列机制实现的"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#漏桶算法是使用队列机制实现的"}},[s._v("#")]),s._v(" 漏桶算法是使用队列机制实现的")]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"漏桶算法",href:"./image/loutong2.jpg"}},[n("img",{attrs:{src:a(859),alt:"漏桶算法"}})])]),s._v(" "),n("p",[n("strong",[s._v("漏桶算法主要用途在于保护它人（服务），假设入水量很大，而出水量较慢，则会造成网关的资源堆积可能导致网关瘫痪。而目标服务可能是可以处理大量请求的，但是漏桶算法出水量缓慢反而造成服务那边的资源浪费")])]),s._v(" "),n("h3",{attrs:{id:"令牌桶算法"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#令牌桶算法"}},[s._v("#")]),s._v(" 令牌桶算法")]),s._v(" "),n("p",[s._v("令牌桶算法是对漏桶算法的一种改进，漏桶算法能够限制请求调用的速率，而令牌桶算法能够在限制调用的平均\n速率的同时还允许一定程度的突发调用。在令牌桶算法中，存在一个桶，用来存放固定数量的令牌。算法中存在一种\n机制，以一定的速率往桶中放令牌。每次请求调用需要先获取令牌，只有拿到令牌，才有机会继续执行，否则选择选\n择等待可用的令牌、或者直接拒绝。放令牌这个动作是持续不断的进行，如果桶中令牌数达到上限，就丢弃令牌。")]),s._v(" "),n("p",[s._v("场景大概是这样的：桶中一直有大量的可用令牌，这时进来的请求可以直接拿到令牌执行，比如设置 QPS 为\n100/s，那么限流器初始化完成一秒后，桶中就已经有 100 个令牌了，等服务启动完成对外提供服务时，该限\n流器可以抵挡瞬时的 100 个请求。当桶中没有令牌时，请求会进行等待，最后相当于以一定的速率执行。")]),s._v(" "),n("div",{staticClass:"custom-block tip"},[n("p",{staticClass:"custom-block-title"},[s._v("Spring Cloud Gateway 内部使用的就是该算法：")]),s._v(" "),n("ol",[n("li",[s._v("所有的请求在处理之前都需要拿到一个可用的令牌才会被处理；")]),s._v(" "),n("li",[s._v("根据限流大小，设置按照一定的速率往桶里添加令牌；")]),s._v(" "),n("li",[s._v("桶设置最大的放置令牌限制，当桶满时、新添加的令牌就被丢弃或者拒绝；")]),s._v(" "),n("li",[s._v("请求到达后首先要获取令牌桶中的令牌，拿着令牌才可以进行其他的业务逻辑，处理完业务逻辑之后，将令牌直接删除；")]),s._v(" "),n("li",[s._v("令牌桶有最低限额，当桶中的令牌达到最低限额的时候，请求处理完之后将不会删除令牌，以此保证足够的限流。")])])]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"令牌桶算法",href:"./image/lingpaitong.jpg"}},[n("img",{attrs:{src:a(860),alt:"令牌桶算法"}})]),s._v(" "),n("strong",[s._v("漏桶算法主要用途在于保护它人，而令牌桶算法主要目的在于保护自己，将请求压力交由目标服务处理。假设突然进来很多请求，只要拿到令牌这些请求会瞬时被处理调用目标服务。")])]),s._v(" "),n("h2",{attrs:{id:"_4-2-gateway-常用限流方式"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#_4-2-gateway-常用限流方式"}},[s._v("#")]),s._v(" 4.2 Gateway 常用限流方式")]),s._v(" "),n("p",[s._v("Spring Cloud Gateway 官方提供了 RequestRateLimiterGatewayFilterFactory 过滤器工厂，使用 Redis和 Lua 脚本实现了令牌桶的方式。")]),s._v(" "),n("p",[s._v("官网文档：https://cloud.spring.io/spring-cloud-static/spring-cloud-gateway/2.2.1.RELEASE/reference/html/#the-redis-ratelimiter 具体实现逻辑在 RequestRateLimiterGatewayFilterFactory 类中， Lua 脚本在如下图所示的源码文件夹中：")]),s._v(" "),n("h3",{attrs:{id:"添加依赖"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#添加依赖"}},[s._v("#")]),s._v(" 添加依赖")]),s._v(" "),n("div",{staticClass:"language-xml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-xml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- spring data redis reactive 依赖 --\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.springframework.boot"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("spring-boot-starter-data-redis-reactive"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("\x3c!-- commons-pool2 对象池依赖 --\x3e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("org.apache.commons"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("groupId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("<")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("commons-pool2"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("artifactId")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token tag"}},[n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("</")]),s._v("dependency")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")])]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("h3",{attrs:{id:"uri-限流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#uri-限流"}},[s._v("#")]),s._v(" URI 限流")]),s._v(" "),n("p",[n("strong",[s._v("配置限流过滤器和限流过滤器引用的 bean 对象")])]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("application")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" gateway"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应用名称")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateway")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("locator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否与服务发现组件进行结合，通过 serviceId 转发到具体服务实例。")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("                           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否开启基于服务发现的路由规则")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lower-case-service-id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否将服务名称转小写")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由规则")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由 ID，唯一")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" lb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lb:// 根据服务名称从注册中心获取服务请求地址")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("predicates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 断言（判断条件）")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配对应 URL 的请求，将匹配到的请求追加在目标 URI 之后")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Path=/order/"),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("**")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网关过滤器")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RequestRateLimiter\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-rate-limiter.replenishRate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 令牌桶每秒填充速率")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-rate-limiter.burstCapacity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 令牌桶总容量")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key-resolver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#{@pathKeyResolver}"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 SpEL 表达式按名称引用 bean")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis 缓存")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接超时时间")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 49.232.21.151   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis服务器地址")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis服务器端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    password: root            # Redis服务器密码")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("database")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选择哪个库，默认0库")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lettuce")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-active")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大连接数，默认 8")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-wait")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大连接阻塞等待时间，单位毫秒，默认 -1")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-idle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大空闲连接，默认 8")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("min-idle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最小空闲连接，默认 0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 Eureka Server 注册中心")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("eureka")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefer-ip-address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否使用 ip 地址注册")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instance-id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("spring.cloud.client.ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("server.port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip:port")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("client")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service-url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置服务注册中心地址")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("defaultZone")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8761/eureka/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8762/eureka/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br")])]),n("p",[n("strong",[s._v("编写限流规则配置类")])]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cloud"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("gateway"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("filter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("ratelimit"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("KeyResolver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Bean")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("org"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("springframework"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("annotation"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Configuration")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token namespace"}},[s._v("reactor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("core"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("publisher"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")])]),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Mono")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n * 限流规则配置类\n * @author Administrator\n */")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Configuration")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("class")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("KeyResolverConfiguration")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n    * 限流规则\n    *\n    * @return\n    */")]),s._v("\n         "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("KeyResolver")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("pathKeyResolver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/*\n        return new KeyResolver() {\n            @Override\n            public Mono<String> resolve(ServerWebExchange exchange) {\n                return Mono.just(exchange.getRequest().getPath().toString());\n            }\n        };\n         */")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// JDK 1.8")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" exchange "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Mono")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("just")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exchange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getURI")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getPath")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n   "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br")])]),n("p",[n("a",[s._v("http://localhost:9000/order/2")])]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"url限流",href:"./image/urlfilters.jpg"}},[n("img",{attrs:{src:a(861),alt:"url限流"}})])]),s._v(" "),n("h3",{attrs:{id:"ip-限流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ip-限流"}},[s._v("#")]),s._v(" IP 限流")]),s._v(" "),n("p",[n("strong",[s._v("配置限流过滤器和限流过滤器引用的 bean 对象")])]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("application")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" gateway"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应用名称")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateway")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("locator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否与服务发现组件进行结合，通过 serviceId 转发到具体服务实例。")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("                           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否开启基于服务发现的路由规则")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lower-case-service-id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否将服务名称转小写")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由规则")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" product"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由 ID，唯一")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" lb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//product"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service         "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lb:// 根据服务名称从注册中心获取服务请求地址")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("predicates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 断言（判断条件）")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配对应 URI 的请求，将匹配到的请求追加在目标 URI 之后")]),s._v("\n             "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Path=/product/"),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("**")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" /api"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway/"),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("**")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网关过滤器")]),s._v("\n             "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 /api-gateway/product/1 重写为 /product/1")]),s._v("\n             "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" RewritePath=/api"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway("),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("<segment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("."),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*)")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" $\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("segment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由 ID，唯一")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" lb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lb:// 根据服务名称从注册中心获取服务请求地址")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("predicates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 断言（判断条件）")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配对应 URL 的请求，将匹配到的请求追加在目标 URI 之后")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Path=/order/"),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("**")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网关过滤器")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RequestRateLimiter\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-rate-limiter.replenishRate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 令牌桶每秒填充速率")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-rate-limiter.burstCapacity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 令牌桶总容量")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key-resolver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#{@ipKeyResolver}"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 SpEL 表达式按名称引用 bean")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis 缓存")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接超时时间")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 49.232.21.151   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis服务器地址")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis服务器端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    password: root            # Redis服务器密码")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("database")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选择哪个库，默认0库")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lettuce")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-active")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大连接数，默认 8")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-wait")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大连接阻塞等待时间，单位毫秒，默认 -1")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-idle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大空闲连接，默认 8")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("min-idle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最小空闲连接，默认 0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 Eureka Server 注册中心")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("eureka")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefer-ip-address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否使用 ip 地址注册")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instance-id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("spring.cloud.client.ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("server.port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip:port")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("client")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service-url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置服务注册中心地址")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("defaultZone")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8761/eureka/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8762/eureka/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br")])]),n("p",[n("strong",[s._v("编写限流规则配置类")])]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 根据 IP 限流\n     *\n     * @return\n     */")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("KeyResolver")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("ipKeyResolver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" exchange "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Mono")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("just")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exchange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRemoteAddress")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getHostName")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[n("a",[s._v("http://localhost:9000/order/1")])]),s._v(" "),n("p",[n("a",{attrs:{"data-fancybox":"",title:"IP限流",href:"./image/IPfilter.jpg"}},[n("img",{attrs:{src:a(862),alt:"IP限流"}})])]),s._v(" "),n("h3",{attrs:{id:"参数-限流"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#参数-限流"}},[s._v("#")]),s._v(" 参数 限流")]),s._v(" "),n("p",[n("strong",[s._v("配置限流过滤器和限流过滤器引用的 bean 对象")])]),s._v(" "),n("div",{staticClass:"language-yml line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-yml"}},[n("code",[n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("spring")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("application")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" gateway"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("server "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 应用名称")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("cloud")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("gateway")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("discovery")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("locator")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否与服务发现组件进行结合，通过 serviceId 转发到具体服务实例。")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("enabled")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("                           "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否开启基于服务发现的路由规则")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lower-case-service-id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否将服务名称转小写")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由规则")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("routes")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" product"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由 ID，唯一")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" lb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//product"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service         "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lb:// 根据服务名称从注册中心获取服务请求地址")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("predicates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 断言（判断条件）")]),s._v("\n              "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配对应 URI 的请求，将匹配到的请求追加在目标 URI 之后")]),s._v("\n             "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Path=/product/"),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("**")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" /api"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway/"),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("**")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                                 "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网关过滤器")]),s._v("\n             "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 将 /api-gateway/product/1 重写为 /product/1")]),s._v("\n             "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" RewritePath=/api"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("gateway("),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("<segment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(">")]),s._v("/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("?")]),s._v("."),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("*)")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" $\\"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("segment"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 路由 ID，唯一")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("uri")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" lb"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//order"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("service        "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# lb:// 根据服务名称从注册中心获取服务请求地址")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("predicates")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 断言（判断条件）")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 匹配对应 URL 的请求，将匹配到的请求追加在目标 URI 之后")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" Path=/order/"),n("span",{pre:!0,attrs:{class:"token important"}},[s._v("**")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("filters")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 网关过滤器")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" RequestRateLimiter\n              "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("args")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-rate-limiter.replenishRate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 令牌桶每秒填充速率")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis-rate-limiter.burstCapacity")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 令牌桶总容量")]),s._v("\n                "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("key-resolver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"#{@parameterKeyResolver}"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 使用 SpEL 表达式按名称引用 bean")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# redis 缓存")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("redis")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("timeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("            "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 连接超时时间")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("host")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" 49.232.21.151   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis服务器地址")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("6379")]),s._v("                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Redis服务器端口")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#    password: root            # Redis服务器密码")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("database")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("                "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 选择哪个库，默认0库")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("lettuce")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("pool")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-active")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1024")]),s._v("   "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大连接数，默认 8")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-wait")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("10000")]),s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大连接阻塞等待时间，单位毫秒，默认 -1")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("max-idle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("200")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最大空闲连接，默认 8")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("min-idle")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("          "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 最小空闲连接，默认 0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("server")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("port")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("9000")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 配置 Eureka Server 注册中心")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("eureka")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instance")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("prefer-ip-address")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean important"}},[s._v("true")]),s._v("       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 是否使用 ip 地址注册")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("instance-id")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" $"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("spring.cloud.client.ip"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("address"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("$"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("server.port"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ip:port")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("client")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("service-url")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("                  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 设置服务注册中心地址")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("defaultZone")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8761/eureka/"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("http"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("//localhost"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v("8762/eureka/\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br")])]),n("p",[n("strong",[s._v("编写限流规则配置类")])]),s._v(" "),n("div",{staticClass:"language-java line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-java"}},[n("code",[s._v("    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("/**\n     * 根据参数限流\n     *\n     * @return\n     */")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token annotation punctuation"}},[s._v("@Bean")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("public")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("KeyResolver")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("parameterKeyResolver")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" exchange "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("->")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Mono")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("just")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("exchange"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getQueryParams")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getFirst")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userId"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br")])]),n("p",[n("a",[s._v("http://localhost:9000/order/1?userId=123 ")]),s._v(" "),n("a",{attrs:{"data-fancybox":"",title:"IP限流",href:"./image/parameter.jpg"}},[n("img",{attrs:{src:a(863),alt:"IP限流"}})])])])}),[],!1,null,null,null);t.default=e.exports},855:function(s,t,a){s.exports=a.p+"assets/img/jishuqisuanfa1.f173e8dd.jpg"},856:function(s,t,a){s.exports=a.p+"assets/img/jishuqisuanfa2.5732142c.jpg"},857:function(s,t,a){s.exports=a.p+"assets/img/jishuqisuanfa3.0e3b5f05.jpg"},858:function(s,t,a){s.exports=a.p+"assets/img/loutong.bc2f7f25.jpg"},859:function(s,t,a){s.exports=a.p+"assets/img/loutong2.5c6f48e7.jpg"},860:function(s,t,a){s.exports=a.p+"assets/img/lingpaitong.6c301e00.jpg"},861:function(s,t,a){s.exports=a.p+"assets/img/urlfilters.6ef64ef4.jpg"},862:function(s,t,a){s.exports=a.p+"assets/img/IPfilter.9b0c9869.jpg"},863:function(s,t,a){s.exports=a.p+"assets/img/parameter.67ce0430.jpg"}}]);