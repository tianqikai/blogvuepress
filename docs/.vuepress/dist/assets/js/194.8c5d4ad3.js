(window.webpackJsonp=window.webpackJsonp||[]).push([[194],{1248:function(s,a,n){s.exports=n.p+"assets/img/network12.ee137d1d.png"},1624:function(s,a,n){"use strict";n.r(a);var t=n(26),e=Object(t.a)({},(function(){var s=this,a=s.$createElement,t=s._self._c||a;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"_2-dns-domain-name-system-域名管理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-dns-domain-name-system-域名管理"}},[s._v("#")]),s._v(" 2. DNS（domain name system）域名管理")]),s._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#_2-2-dns的作用"}},[s._v("2.2 DNS的作用")])]),t("li",[t("a",{attrs:{href:"#_2-3-域"}},[s._v("2.3 域")])]),t("li",[t("a",{attrs:{href:"#_2-4-dns工作原理"}},[s._v("2.4 DNS工作原理")])]),t("li",[t("a",{attrs:{href:"#_2-5-搭建dns服务器"}},[s._v("2.5 搭建DNS服务器")]),t("ul",[t("li",[t("a",{attrs:{href:"#_2-5-1-bind"}},[s._v("2.5.1 Bind")])]),t("li",[t("a",{attrs:{href:"#_2-5-2-系统环境准备"}},[s._v("2.5.2 系统环境准备")])]),t("li",[t("a",{attrs:{href:"#_2-5-3-安装bind"}},[s._v("2.5.3 安装bind")])]),t("li",[t("a",{attrs:{href:"#_2-5-4-查看bind的相关文件"}},[s._v("2.5.4 查看bind的相关文件")])]),t("li",[t("a",{attrs:{href:"#_2-5-5-查看bind的主配置文件"}},[s._v("2.5.5 查看bind的主配置文件")])]),t("li",[t("a",{attrs:{href:"#_2-5-6-查看域配置文件-named-rfc1912-zones"}},[s._v("2.5.6 查看域配置文件 - named.rfc1912.zones")])]),t("li",[t("a",{attrs:{href:"#_2-5-7-查看某个具体的域的配置文件"}},[s._v("2.5.7 查看某个具体的域的配置文件")])]),t("li",[t("a",{attrs:{href:"#_2-5-8-实验前提前抛出一个问题"}},[s._v("2.5.8 实验前提前抛出一个问题")])]),t("li",[t("a",{attrs:{href:"#_2-5-9-实验-搭建dns正向解析服务"}},[s._v("2.5.9 实验：搭建DNS正向解析服务")])]),t("li",[t("a",{attrs:{href:"#_2-5-10-实验-搭建dns反向解析服务"}},[s._v("2.5.10 实验：搭建DNS反向解析服务")])])])]),t("li",[t("a",{attrs:{href:"#_2-6-搭建主从dns服务"}},[s._v("2.6 搭建主从DNS服务")]),t("ul",[t("li",[t("a",{attrs:{href:"#_2-6-1-搭建时间同步服务器-ntp"}},[s._v("2.6.1 搭建时间同步服务器-ntp")])]),t("li",[t("a",{attrs:{href:"#_2-6-2-登陆10-4-7-0所在的其他网段的机器-验证如下"}},[s._v("2.6.2 登陆10.4.7.0所在的其他网段的机器，验证如下")])]),t("li",[t("a",{attrs:{href:"#_2-6-3-开始搭建"}},[s._v("2.6.3 开始搭建")])]),t("li",[t("a",{attrs:{href:"#_2-6-4-在master上的操作"}},[s._v("2.6.4 在master上的操作")])]),t("li",[t("a",{attrs:{href:"#_2-6-5-在slave上的设置"}},[s._v("2.6.5 在slave上的设置")])]),t("li",[t("a",{attrs:{href:"#_2-6-6-客户端的设置"}},[s._v("2.6.6 客户端的设置")])])])])])]),t("p"),s._v(" "),t("h2",{attrs:{id:"_2-2-dns的作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-dns的作用"}},[s._v("#")]),s._v(" 2.2 DNS的作用")]),s._v(" "),t("p",[s._v("TCP/IP网络协议要求想要互联的机器要有唯一的IP地址，因为"),t("code",[s._v("TCP/IP")]),s._v("协议是基于"),t("code",[s._v("IP地址通信的")]),s._v("。")]),s._v(" "),t("p",[s._v("但是"),t("code",[s._v("ip地址")]),s._v("是一大长串数据，也不好记。所以就衍生出一个叫主机识别码的东西来。这个"),t("code",[s._v("主机识别码")]),s._v("和ip地址一样，都是唯一存在的。比如："),t("code",[s._v("www.qq.com就是一个主机识别码")]),s._v("。")]),s._v(" "),t("p",[s._v("有"),t("code",[s._v("TCP/IP")]),s._v("这道坎，主机识别码就不能独立存在，我们需要一个机制，可以帮我们将"),t("code",[s._v("主机识别码转换成ip地址")]),s._v("，"),t("strong",[s._v("DNS系统")]),s._v("扮演的就是这个角色。")]),s._v(" "),t("h2",{attrs:{id:"_2-3-域"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-域"}},[s._v("#")]),s._v(" 2.3 域")]),s._v(" "),t("p",[s._v("域名是分层的")]),s._v(" "),t("p",[s._v("比如山东农业大学的域名是："),t("code",[s._v("www.sdau.edu.cn")])]),s._v(" "),t("p",[s._v("其实cn后面还有个. 表示根域名服务器，但是都省略了")]),s._v(" "),t("p",[s._v("其中的cn表示中国，edu表示教育，sdau是山东农业大学的名字。这样大家看到这个域名时，即使不知道它具体是哪所高校，但是起码知道它代表一所学校。")]),s._v(" "),t("p",[s._v("sdau.edu.cn 还可以继续往下分，如www.sdau.edu.cn、paper.sdau.edu.cn  、family.sdau.edu.cn等等")]),s._v(" "),t("h2",{attrs:{id:"_2-4-dns工作原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-dns工作原理"}},[s._v("#")]),s._v(" 2.4 DNS工作原理")]),s._v(" "),t("p",[s._v("一说DNS服务器大家都感觉云里雾里，感觉"),t("code",[s._v("DNS服务器")]),s._v("很高大上的样子。")]),s._v(" "),t("div",{staticClass:"custom-block tip"},[t("p",{staticClass:"custom-block-title"},[s._v("DNS的查询顺序")]),s._v(" "),t("ol",[t("li",[s._v("本地hosts文件")]),s._v(" "),t("li",[s._v("本地DNS缓存")]),s._v(" "),t("li",[s._v("本地DNS服务器")]),s._v(" "),t("li",[s._v("发起迭代查询")])])]),s._v(" "),t("p",[s._v("它确实是台服务器，确切的说是专门运行着有域名解析功能的某个软件的服务器（比如后文中的bind软件），既然是个软件，那软件启动后肯定得监听某个端口，这个端口")]),s._v(" "),t("p",[s._v("讲一下当我们在浏览器输入："),t("code",[s._v("www.baidu.com")]),s._v("时，它时如何找到域名对应的ip地址的！")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("首先浏览器会缓存域名、ip的对应关系。")])]),s._v(" "),t("li",[t("p",[s._v("浏览器中没缓存，就会查找电脑本地的hosts文件，这里面会配置域名和ip的对应关系。")])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM_0_15_centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/hosts")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 VM_0_15_centos VM_0_15_centos\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 localhost.localdomain localhost\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1 localhost4.localdomain4 localhost4\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("122.51")]),s._v(".144.197 tianqikai.club\n\n\n\n::1 VM_0_15_centos VM_0_15_centos\n::1 localhost.localdomain localhost\n::1 localhost6.localdomain6 localhost6\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("如果本地hosts文件中也没有域名对应的ip地址，我们的主机就会像它的dns服务器发起询问。wifi网络中然后点击高级，查看当前我的mac的DNS服务器地址")])]),s._v(" "),t("p",[t("a",{attrs:{"data-fancybox":"",title:"同一个局域网中不同主机的互联",href:"./images/network12.png"}},[t("img",{attrs:{src:n(1248),alt:"同一个局域网中不同主机的互联"}})])]),s._v(" "),t("blockquote",[t("p",[s._v("在linux中都可以通过如下的命令查询dns服务器的位置")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@VM_0_15_centos ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/resolv.conf")]),s._v("\noptions timeout:1 rotate\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" generated by /usr/sbin/dhclient-script\nnameserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("183.60")]),s._v(".83.19\nnameserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("183.60")]),s._v(".82.98\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("blockquote",[t("p",[s._v("在linux中都可以通过如下的命令对域名进行解析")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 会使用resolv.conf记录的dns服务器，对域名进行解析")]),s._v("\n~ % "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("nslookup")]),s._v(" baidu.com\nServer:  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.22")]),s._v(".1.253\nAddress: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("172.22")]),s._v(".1.253"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53")]),s._v("\n\nName: baidu.com\nAddress: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.181")]),s._v(".38.148\nName: baidu.com\nAddress: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("220.181")]),s._v(".38.251\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("免费的DNS服务器ip")])]),s._v(" "),t("div",{staticClass:"language- line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-text"}},[t("code",[s._v("ip\t公司\n8.8.8.8\t谷歌\n114.114.114.114\t百度\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("DNS服务器接受到域名解析的请求后，就会查询该域名对应的ip是多少，而且他本身也存在缓存机制，如果它确定自己不能找到域名对应的ip地址的话，就会将这个dns解析请求转发给根DNS服务器，根域名域名服务器会告诉我们的DNS服务器说：我知道 com.域名服务器的位置，你去问他吧！")])]),s._v(" "),t("p",[s._v("然后我们的DNS服务器找到com.域名服务器说：你知道www.baidu.com 对应的ip地址吗？ 然而com.服务器会说：我知道baidu.com.域名服务器在哪里，你去问他吧！")]),s._v(" "),t("p",[s._v("然后我们的DNS服务器找到baidu.com.域名服务器说：你知道www.baidu.cn 对应的ip地址吗？ baidu.com.服务器会说：www.com.com 的ip地址是 xxx.xxx.xxx.xxx")]),s._v(" "),t("h2",{attrs:{id:"_2-5-搭建dns服务器"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-搭建dns服务器"}},[s._v("#")]),s._v(" 2.5 搭建DNS服务器")]),s._v(" "),t("h3",{attrs:{id:"_2-5-1-bind"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-1-bind"}},[s._v("#")]),s._v(" 2.5.1 Bind")]),s._v(" "),t("p",[s._v("Bind是一款开源的DNS软件，全称：Berkeley Internet Name Domain 由美国加州大学伯克利分享开发、维护。")]),s._v(" "),t("p",[s._v("支持unix、window。BIND现在由互联网系统协会（Internet Systems Consortium）负责开发和维护。")]),s._v(" "),t("p",[s._v("那下文主要就是记录如何使用Bind软件搭建DNS服务以及搭建主从DNS服务。软件人家已经写好了，对使用者来说都很友好，只要改一改配置文件然后启动就OK（重点是理解那些参数都是啥意思）。")]),s._v(" "),t("p",[s._v("DNS域名解析会使用：udp/53")]),s._v(" "),t("p",[s._v("主从DNS服务之间的数据传输使用：tcp/53")]),s._v(" "),t("p",[s._v("其实如果你没有自建dns域名解析服务的需求，看到这里就可以结束了。如果以后可能会有这个记得收藏。")]),s._v(" "),t("h3",{attrs:{id:"_2-5-2-系统环境准备"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-2-系统环境准备"}},[s._v("#")]),s._v(" 2.5.2 系统环境准备")]),s._v(" "),t("ul",[t("li",[s._v("调整yum源,安装")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" epel-release -y\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("关闭SELinux、firewalld")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭防火墙，注意一定要关闭防火墙")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不然后面使用bind9自建dns时其他的服务器无法和自建的dns服务器通信～")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 不然etcd集群也没法搭建起来～")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭防火墙")]),s._v("\nsystemctl stop firewalld\nsystemctl disable firewalld\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭selinux")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久关闭")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -i "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/enforcing/disabled/'")]),s._v(" /etc/selinux/config  \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时关闭")]),s._v("\nsetenforce "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  \n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 关闭swap")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 临时")]),s._v("\nswapoff -a \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 永久关闭")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("sed")]),s._v(" -ri "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'s/.*swap.*/#&/'")]),s._v(" /etc/fstab\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根据规划设置主机名【dns01节点上操作】")]),s._v("\nhostnamectl set-hostname dns01\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 生效")]),s._v("\nsysctl --system  \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("ul",[t("li",[s._v("安装必要的工具")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("yum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("wget")]),s._v(" net-tools telnet tree nmap sysstat dos2unix bind-utils -y\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_2-5-3-安装bind"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-3-安装bind"}},[s._v("#")]),s._v(" 2.5.3 安装bind")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 安装bind执行命令：")]),s._v("\n\nyum "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v(" -y\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检测bind版本")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -qa "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 查看bind都有哪些文件")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("rpm")]),s._v(" -ql "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("bind")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 了解配置文件")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("man")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" xxx.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("h3",{attrs:{id:"_2-5-4-查看bind的相关文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-4-查看bind的相关文件"}},[s._v("#")]),s._v(" 2.5.4 查看bind的相关文件")]),s._v(" "),t("ul",[t("li",[s._v("通过如下命令可以找到Bind的主配置文件"),t("code",[s._v("named.conf")]),s._v("的位置")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 软件名叫bind，但是bin文件进程名称叫named")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ql bind | grep etc")]),s._v("\n/etc/logrotate.d/named "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志轮转的配置")]),s._v("\n/etc/named\n/etc/named.conf "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 主配置文件")]),s._v("\n/etc/named.iscdlv.key\n/etc/named.rfc1912.zones "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# zone文件，用于定义域")]),s._v("\n/etc/named.root.key\n/etc/rndc.conf\n/etc/rndc.key\n/etc/rwtab.d/named\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br")])]),t("ul",[t("li",[s._v("查看程序常用bin文件位置")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ql bind | grep sbin")]),s._v("\n/usr/sbin/named "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 程序启动文件")]),s._v("\n/usr/sbin/named-checkconf "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查配置文件语法（named.conf、named.rfc1912.zones）")]),s._v("\n/usr/sbin/named-checkzone "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 检查区域文件语法的命令")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br")])]),t("ul",[t("li",[s._v("查看服务的日志文件位置")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ql bind | grep named.log")]),s._v("\n/var/log/named.log\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("其他动态文件的位置")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ql bind | grep var")]),s._v("\n/var/log/named.log "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 日志文件")]),s._v("\n/var/named\n/var/named/data\n/var/named/dynamic\n/var/named/named.ca "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 根域名服务器配置（所有DNS服务器都知道根域名服务器在哪里）")]),s._v("\n/var/named/named.empty \n/var/named/named.localhost "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 正向解析区域文件的模版")]),s._v("\n/var/named/named.loopback "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 反向解析区域文件的模版")]),s._v("\n/var/named/slaves "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 从DNS服务器的下载文件的默认路径")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("h3",{attrs:{id:"_2-5-5-查看bind的主配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-5-查看bind的主配置文件"}},[s._v("#")]),s._v(" 2.5.5 查看bind的主配置文件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/named.conf")]),s._v("\n\noptions "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  /*\n   监听方式，服务监听指定ip的53号端口\n   服务器可能有多张网卡，any表示所有网卡监听53端口的DNS解析请求\n   todo 可以个实验：1、ip指定为本机ip。2、ip指定为同网段随便的ip\n  */\n listen-on port "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("53")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" any"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" /**/\n \n /*数据文件目录*/\n directory  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/named"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n /*DNS缓存位置*/\n dump-file  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/named/data/cache_dump.db"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n /*统计文件*/\n statistics-file "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/named/data/named_stats.txt"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n /*内存统计文件*/\n memstatistics-file "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/named/data/named_mem_stats.txt"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n recursing-file  "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/named/data/named.recursing"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n secroots-file   "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/named/data/named.secroots"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n \n /*\n  允许哪些client来查询dns服务，默认是localhost。\n  any表示所有人都能进行dns查询\n */\n allow-query     "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" localhost"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("any"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n /*是否递归*/\n recursion "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("yes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n /*DNS安全扩展机制，默认开启，直接关闭即可*/\n dnssec-enable no"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n dnssec-validation no"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n /* Path to ISC DLV key */\n bindkeys-file "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/named.root.key"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n managed-keys-directory "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/var/named/dynamic"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n pid-file "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/run/named/named.pid"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n session-keyfile "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/run/named/session.key"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\nlogging "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        channel default_debug "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n                "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"data/named.run"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n                severity dynamic"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n/*之所以全部DNS服务器都知道根域名服务器的位置，就是下面的配置在生效*/\nzone "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"."')]),s._v(" IN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" hint"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"named.ca"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n/*子配置文件*/\ninclude "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/named.rfc1912.zones"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\ninclude "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"/etc/named.root.key"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br")])]),t("ul",[t("li",[s._v("修改完主配置文件后使用如下命令检验是否改错了")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# named-checkconf")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("h3",{attrs:{id:"_2-5-6-查看域配置文件-named-rfc1912-zones"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-6-查看域配置文件-named-rfc1912-zones"}},[s._v("#")]),s._v(" 2.5.6 查看域配置文件 - named.rfc1912.zones")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/named.rfc1912.zones")]),s._v("\n\n// 正向模版，从域名"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("ip地址\n// localhost.localdomain 为域名\n// named.localhost为该域对应的配置文件，它位于/var/named/\n// allow-update表示是否允许slave更新master的区域文件\nzone "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"localhost.localdomain"')]),s._v(" IN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" \n "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"named.localhost"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n allow-update "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n// 反向模版，从ip地址"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v("域名\n// "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.0")]),s._v(".0.127 看着怪怪的，其实他是ip地址反过来写了。而且也要求反过来写\nzone "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"1.0.0.127.in-addr.arpa"')]),s._v(" IN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"named.loopback"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n allow-update "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("h3",{attrs:{id:"_2-5-7-查看某个具体的域的配置文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-7-查看某个具体的域的配置文件"}},[s._v("#")]),s._v(" 2.5.7 查看某个具体的域的配置文件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ll /var/named/")]),s._v("\n总用量 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v("\ndrwxrwx--- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" named named    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":05 data\ndrwxrwx--- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" named named    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":05 dynamic\n-rw-r----- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root  named "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2253")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2018")]),s._v(" named.ca\n-rw-r----- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root  named  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("152")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2009")]),s._v(" named.empty\n-rw-r----- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root  named  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("152")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("月  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2007")]),s._v(" named.localhost\n-rw-r----- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" root  named  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("168")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2009")]),s._v(" named.loopback\ndrwxrwx--- "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" named named    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("月  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("29")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":05 slaves\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("看一个正向解析的域的配置文件named.localhost")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /var/named/named.localhost")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TTL")]),s._v(" 1D "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 缓存的生命周期，默认1D表示1天")]),s._v("\n@ IN SOA @ rname.invalid. "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ()中是slave相关配置")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" serial "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 更新序列号，当这个文件有变动时，需要将这个序列号+1，然后slave会向master同步数据")]),s._v("\n     1D "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" refresh "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# slave从master中同步最新数据的时间间隔")]),s._v("\n     1H "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" retry "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# slave从master中下载数据失败之后，隔多久的时间再重试")]),s._v("\n     1W "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" expire "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# slave中区域文件的过期时间，w是周")]),s._v("\n     3H "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" minimum "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# salve上缓存的最小有效时间")]),s._v("\n NS @\n A "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n AAAA ::1\n \n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @：表示当前域，也就是 named.rfc1912.zones 中的zone的名称")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# IN：表示Internet，互联网")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# SOA：表示开始授权")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rname.invalid.  是邮箱地址，因为@符号有特殊含义，所以这里的邮箱使用.分隔")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# NS： 全称NameServer 表示DNS服务器")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# A：正向的Ipv4解析")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# AAAA：IPv6")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br")])]),t("ul",[t("li",[s._v("看一个反向解析的域的配置文件named.loopback")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /var/named/named.loopback")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TTL")]),s._v(" 1D\n@ IN SOA @ rname.invalid. "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n     "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" serial \n     1D "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" refresh\n     1H "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" retry\n     1W "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" expire\n     3H "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" minimum\n NS @\n A "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1\n AAAA ::1\n PTR localhost.\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 大部分参数和第一个文件相同")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# PTR表示反向解析")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("h3",{attrs:{id:"_2-5-8-实验前提前抛出一个问题"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-8-实验前提前抛出一个问题"}},[s._v("#")]),s._v(" 2.5.8 实验前提前抛出一个问题")]),s._v(" "),t("p",[s._v("可以通过下面的方式配置网卡的dns服务器的地址")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat >> /etc/sysconfig/network-scripts/ifcfg-eth0 << EOF")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("TYPE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Ethernet\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("BOOTPROTO")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("none\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEFROUTE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NAME")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eth0\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DEVICE")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("eth0\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("ONBOOT")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("yes\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("IPADDR")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.20\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("NETMASK")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("255.255")]),s._v(".255.0\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GATEWAY")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.2\n"),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DNS1")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.2\nEOF\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("比如网卡配置文件中指定的dns服务器地址是:192.168.222.2")]),s._v(" "),t("ul",[t("li",[s._v("另外系统上还运行着NetworkManager进程，它的作用之一将DHCP中获取的DNS信息写入/etc/resolv.conf")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ps -elf | grep NetworkManager")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" S root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6172")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("137970")]),s._v(" poll_s 08:18 ?       00:00:00 /usr/sbin/NetworkManager --no-daemon\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" S root       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7237")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7080")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80")]),s._v("   "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" - "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("28181")]),s._v(" pipe_w 09:00 pts/0    00:00:00 "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("grep")]),s._v(" --color"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("auto NetworkManager\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("p",[s._v("也就是将我们设置的dns服务器地址，更新进下面的文件")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cat /etc/resolv.conf")]),s._v("\nnameserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.2\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("那么问题来了：")]),s._v(" "),t("p",[s._v("我们本机的ip是192.168.222.20，然后我们在本机自建的dns服务时又需要指定dns服务的ip地址，那既然本机就是dns服务器，那指定的dns服务的地址肯定是本机的ip地址192.168.222.20，那这和NetworkManager更新入/etc/resolv.conf的ip地址是不同的。")]),s._v(" "),t("p",[s._v("而且通过nslookup ${域名} 进行域名解析时，它会去使用/etc/resolv.conf里面的dns去解析域名，而不是我们自己在本机搭建的dns服务。")]),s._v(" "),t("p",[s._v("如果你非想用nsloopup验证我们自己的dns服务是否正常，可以使用如下命令")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# echo nameserver 192.168.222.20 >  /etc/resolv.conf")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("hr"),s._v(" "),t("h3",{attrs:{id:"_2-5-9-实验-搭建dns正向解析服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-9-实验-搭建dns正向解析服务"}},[s._v("#")]),s._v(" 2.5.9 实验：搭建DNS正向解析服务")]),s._v(" "),t("p",[s._v("实验目的：实现将www.tianqikai.com解析成192.168.222.3")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("修改/etc/named.conf中的监听方式为全网监听、允许所有人访问dns服务、关闭安全验证机制")])]),s._v(" "),t("li",[t("p",[s._v("修改子配置文件/etc/named.rfc1912.zones添加tianqikai.com域。注意这个tianqikai.com域也会往下分层，比如：www.tianqikai.com、wiki.tianqikai.com、family.tianqikai.com")])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost etc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/named.rfc1912.zones")]),s._v("\n\n// 添加如下配置\nzone "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tianqikai.com"')]),s._v(" IN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"named.tianqikai.zone"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        allow-update "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("创建named.tianqikai.zone配置文件，tianqikai.com域分层的详细逻辑就在这个named.tianqikai.zone配置文件中定义。")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost etc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ql bind |  grep named.localhost")]),s._v("\n/usr/share/doc/bind-9.11.4/sample/var/named/named.localhost\n/var/named/named.localhost\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost etc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp /var/named/named.localhost /var/named/named.tianqikai.zone")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 注意将named.tianqikai.zone文件的所属组改成named")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 否则会以为named无法使用root文件而导致DNS服务不能解析tianqikai.zone域")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# chown -R root:named named.tianqikai.zone")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost etc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /var/named/named.tianqikai.zone")]),s._v("\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br")])]),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 按需修改配置文件")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TTL")]),s._v(" 1D\n@       IN SOA tianqikai.com. rname.invalid. "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n                                        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" serial\n                                        1D      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" refresh\n                                        1H      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" retry\n                                        1W      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" expire\n                                        3H "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" minimum\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面这两行指定了dns服务器的nameServer是tianqikai.com、ip地址是192.168.222.20（它自己）")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dns1是自定义的dns服务的名称，叫啥都行")]),s._v("\n@       NS      dns1.tianqikai.com.\ndns1    A       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.20\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 在tianqikai.com域中添加一个www主机，A记录表示是一个正向解析。解析结果为192.168.222.3")]),s._v("\nwww   A    "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.3 \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("检查配置文件")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cd /etc")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost etc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ql bind | grep sbin/named")]),s._v("\n/usr/sbin/named\n/usr/sbin/named-checkconf\n/usr/sbin/named-checkzone\n/usr/sbin/named-compilezone\n/usr/sbin/named-journalprint\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost etc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# named-checkconf named.conf")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost etc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# named-checkconf named.rfc1912.zones")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# named-checkzone named.tianqikai.zone named.tianqikai.zone")]),s._v("\nzone named.tianqikai.zone/IN: loaded serial "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\nOK\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("开启服务")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" \n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ql bind | grep named")]),s._v("\n/etc/logrotate.d/named\n/etc/named\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n/usr/sbin/named\n/usr/sbin/named-checkconf\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sbin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start named")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost sbin"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable named")]),s._v("\nCreated symlink from /etc/systemd/system/multi-user.target.wants/named.service to /usr/lib/systemd/system/named.service.\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# netstat -luntp | grep 53")]),s._v("\ntcp        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.20:53       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25916")]),s._v("/named         \ntcp        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:53            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25916")]),s._v("/named         \ntcp        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:953           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*               LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25916")]),s._v("/named         \ntcp6       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ::1:53                  :::*                    LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25916")]),s._v("/named         \ntcp6       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ::1:953                 :::*                    LISTEN      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25916")]),s._v("/named         \nudp        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.20:53       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*                           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25916")]),s._v("/named         \nudp        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("127.0")]),s._v(".0.1:53            "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.0")]),s._v(".0.0:*                           "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25916")]),s._v("/named         \nudp6       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("      "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" ::1:53                  :::*                                "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25916")]),s._v("/named     \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("ol",{attrs:{start:"6"}},[t("li",[s._v("查看或修改本机的dns服务器地址+验证实验效果")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nslookup www.tianqikai.com")]),s._v("\nServer:\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.20\nAddress:\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.20"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53")]),s._v("\n\nName:\twww.tianqikai.com\nAddress: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.3\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# host www.tianqikai.com")]),s._v("\nwww.tianqikai.com has address "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.3\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br")])]),t("ul",[t("li",[s._v("通过dig命令验证")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dig @192.168.222.20 tianqikai.com")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" DiG "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.11")]),s._v(".4-P2-RedHat-9.11.4-26.P2.el7_9.8 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" @192.168.222.20 tianqikai.com\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" server found"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" global options: +cmd\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Got answer:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("HEADER"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),s._v(" opcode: QUERY, status: NOERROR, id: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18264")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" flags: qr aa rd ra"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" QUERY: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", ANSWER: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", AUTHORITY: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", ADDITIONAL: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" OPT PSEUDOSECTION:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" EDNS: version: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", flags:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" udp: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" QUESTION SECTION:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("tianqikai.com.\t\t\tIN\tA\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" AUTHORITY SECTION:\ntianqikai.com.\t\t"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10800")]),s._v("\tIN\tSOA\ttianqikai.com. rname.invalid. "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("604800")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10800")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Query time: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" msec\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" SERVER: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.20"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53(192.168.222.20)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" WHEN: 二 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(":39:09 CST "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" MSG SIZE  rcvd: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("91")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br")])]),t("ul",[t("li",[s._v("通过host命令查看")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# host www.tianqikai.com")]),s._v("\nwww.tianqikai.com has address "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.3\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_2-5-10-实验-搭建dns反向解析服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-10-实验-搭建dns反向解析服务"}},[s._v("#")]),s._v(" 2.5.10 实验：搭建DNS反向解析服务")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("修改/etc/named.conf中的监听方式为全网监听、允许所有人访问dns服务、关闭安全验证机制")])]),s._v(" "),t("li",[t("p",[s._v("修改子配置文件/etc/named.rfc1912.zones添加tianqikai.com域反向解析")])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/named.rfc1912.zones")]),s._v("\nzone "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"222.168.192.in-addr.arpa"')]),s._v(" IN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"named.tianqikai.loopback"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        allow-update "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("ol",{attrs:{start:"3"}},[t("li",[s._v("创建、编辑子配置文件named.tianqikai.loopback")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# cp -p named.loopback named.tianqikai.loopback")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi named.tianqikai.loopback")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$TTL")]),s._v(" 1D\n@       IN SOA  tianqikai.com. rname.invalid. "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n                                        "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("       "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" serial\n                                        1D      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" refresh\n                                        1H      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" retry\n                                        1W      "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" expire\n                                        3H "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" minimum\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 下面这两行也可以简写成一行：@       NS      dns1.tianqikai.com.")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 之所以能简写是因为dns1在正向解析配置中已经定义好了")]),s._v("\n@       NS      dns2.tianqikai.com.\ndns2    A       "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.20\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("       PTR     www.tianqikai.com. "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 3是222.168.192网段的最后一位，（192.168.222.2）")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("重启服务")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl  restart named")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ol",{attrs:{start:"5"}},[t("li",[s._v("验收")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# dig -x 192.168.222.2 @192.168.222.20")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" DiG "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.11")]),s._v(".4-P2-RedHat-9.11.4-26.P2.el7_9.5 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v(" -x "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.2 @192.168.222.20\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" global options: +cmd\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Got answer:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" -"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">>")]),s._v("HEADER"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<<-")]),s._v(" opcode: QUERY, status: NOERROR, id: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4572")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" flags: qr aa rd ra"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" QUERY: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", ANSWER: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", AUTHORITY: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(", ADDITIONAL: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" OPT PSEUDOSECTION:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" EDNS: version: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(", flags:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" udp: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" QUESTION SECTION:\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v(".168.192.in-addr.arpa. IN PTR\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" ANSWER SECTION:\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v(".168.192.in-addr.arpa. "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v(" IN PTR www.tianqikai.com.\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" AUTHORITY SECTION:\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1.168")]),s._v(".192.in-addr.arpa. "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("86400")]),s._v(" IN NS dns2.tianqikai.com.\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" Query time: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" msec\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" SERVER: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.20"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#53(192.168.222.20)")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" WHEN: 四 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("月 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" 08:57:51 CST "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2021")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" MSG SIZE  rcvd: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("98")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br")])]),t("p",[s._v("或者")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# nslookup 192.168.222.2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v(".168.192.in-addr.arpa name "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" www.tianqikai.com.\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost named"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# host 192.168.222.2")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.1")]),s._v(".168.192.in-addr.arpa domain name pointer www.tianqikai.com.\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h2",{attrs:{id:"_2-6-搭建主从dns服务"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-搭建主从dns服务"}},[s._v("#")]),s._v(" 2.6 搭建主从DNS服务")]),s._v(" "),t("p",[s._v("主从DNS服务其实就是在多台相同环境机器上，都安装好Bind软件，再按照一定的规则修改主从的配置文件。")]),s._v(" "),t("p",[s._v("要求主从DNS服务器的时间要相同，关于时间如何同步，可以参考下面的ntp")]),s._v(" "),t("h3",{attrs:{id:"_2-6-1-搭建时间同步服务器-ntp"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-1-搭建时间同步服务器-ntp"}},[s._v("#")]),s._v(" 2.6.1 搭建时间同步服务器-ntp")]),s._v(" "),t("p",[s._v("安装时间同步服务器")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# yum install -y ntp")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("修改配置文件ntp.conf")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ql ntp | grep conf")]),s._v("\n/etc/ntp.conf\n/etc/sysconfig/ntpd\n/usr/share/man/man5/ntp.conf.5.gz\n~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/ntp.conf")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("ul",[t("li",[s._v("启动")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ntp-server ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# rpm -ql ntp | grep bin")]),s._v("\n/usr/bin/ntpstat\n/usr/sbin/ntp-keygen\n/usr/sbin/ntpd\n/usr/sbin/ntpdc\n/usr/sbin/ntpq\n/usr/sbin/ntptime\n/usr/sbin/tickadj\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ntp-server ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl start ntpd")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@ntp-server ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# systemctl enable ntpd")]),s._v("\nCreated symlink from /etc/systemd/system/multi-user.target.wants/ntpd.service to /usr/lib/systemd/system/ntpd.service.\n\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("ul",[t("li",[s._v("在客户端验证时间同步服务器是否正常启动")])]),s._v(" "),t("h3",{attrs:{id:"_2-6-2-登陆10-4-7-0所在的其他网段的机器-验证如下"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-2-登陆10-4-7-0所在的其他网段的机器-验证如下"}},[s._v("#")]),s._v(" 2.6.2 登陆10.4.7.0所在的其他网段的机器，验证如下")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# ntpdate 10.4.7.9")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" Aug 08:37:47 ntpdate"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8399")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": adjust "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" server "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.4")]),s._v(".7.9 offset -0.017571 sec\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("ul",[t("li",[s._v("在主从机器上添加crontab定时任务同步时间")])]),s._v(" "),t("p",[s._v("参考之前的笔记：https://www.cnblogs.com/ZhuChangwu/p/11519940.html")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# crontab -e")]),s._v("\n*/2 * * * * ntpdate "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.4")]),s._v(".7.9 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" /dev/null\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("root@localhost ~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# crontab -l")]),s._v("\n*/2 * * * * ntpdate "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.4")]),s._v(".7.9 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&>")]),s._v(" /dev/null\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br")])]),t("h3",{attrs:{id:"_2-6-3-开始搭建"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-3-开始搭建"}},[s._v("#")]),s._v(" 2.6.3 开始搭建")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[s._v("dns-master：192.168.222.20\n\ndns-slave: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.21\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br")])]),t("h3",{attrs:{id:"_2-6-4-在master上的操作"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-4-在master上的操作"}},[s._v("#")]),s._v(" 2.6.4 在master上的操作")]),s._v(" "),t("ol",[t("li",[s._v("设置允许哪些slave向自己同步数据")])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 之前的配置如下")]),s._v("\nzone "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tianqikai.com"')]),s._v(" IN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"named.tianqikai.zone"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        allow-update "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("h1",{attrs:{id:"可以将allow-update-none-删掉"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#可以将allow-update-none-删掉"}},[s._v("#")]),s._v(" 可以将allow-update { none; };删掉")]),s._v(" "),t("h1",{attrs:{id:"也可以改写成-allow-update-192-168-222-21"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#也可以改写成-allow-update-192-168-222-21"}},[s._v("#")]),s._v(" 也可以改写成： allow-update { 192.168.222.21; };")]),s._v(" "),t("ol",{attrs:{start:"2"}},[t("li",[s._v("重启")])]),s._v(" "),t("h3",{attrs:{id:"_2-6-5-在slave上的设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-5-在slave上的设置"}},[s._v("#")]),s._v(" 2.6.5 在slave上的设置")]),s._v(" "),t("ol",[t("li",[t("p",[s._v("使用crontab时间同步服务器同步时间")])]),s._v(" "),t("li",[t("p",[s._v("修改/etc/named.conf配置文件（同master）")])]),s._v(" "),t("li",[t("p",[s._v("修改/etc/named.rfc1912.zones")])])]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# master的named.rfc1912.zones自定义正向zone配置如下")]),s._v("\n\nzone "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tianqikai.com"')]),s._v(" IN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" master"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"named.tianqikai.zone"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        allow-update "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" none"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 响应的slave的追加配置如下")]),s._v("\n~"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# vi /etc/named.rfc1912.zones")]),s._v("\n\nzone "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tianqikai.com"')]),s._v(" IN "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("type")]),s._v(" slave"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 因为slave的zone文件是从master中拉取过来的")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 所以slaves其实是个相对路径")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 全路径是：/var/named/slaves/named.tianqikai.zone , /var/named在named.conf中有定义")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("file")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"slaves/named.tianqikai.zone"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" \n        "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# 指定master位置")]),s._v("\n        masters "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.20"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br")])]),t("ol",{attrs:{start:"4"}},[t("li",[s._v("重启")])]),s._v(" "),t("h3",{attrs:{id:"_2-6-6-客户端的设置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-6-6-客户端的设置"}},[s._v("#")]),s._v(" 2.6.6 客户端的设置")]),s._v(" "),t("p",[s._v("为客户端设置两个dns服务。")]),s._v(" "),t("div",{staticClass:"language-bash line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-bash"}},[t("code",[t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" nameserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.20 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/resolv.conf\n"),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("echo")]),s._v(" nameserver "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("192.168")]),s._v(".222.21 "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" /etc/resolv.conf\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br")])]),t("p",[s._v("这样，当需要进行域名解析时，优先使用master。当master挂了后，客户端会使用备用的dns服务解析域名。")])])}),[],!1,null,null,null);a.default=e.exports}}]);